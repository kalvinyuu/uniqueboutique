(undo-tree-save-format-version . 1)
"739e18c779613e5d7184a7fc43e5768e2fe997f7"
[nil nil nil nil (26481 27219 773616 0) 0 nil]
([nil nil ((#("s" 0 1 (font-lock-multiline t fontified t)) . -1708) (undo-tree-id0 . -1) (undo-tree-id1 . -1) (undo-tree-id2 . -1) 1709 (t 26455 34580 15262 716000)) nil (26481 27219 773615 0) 0 nil])
([nil nil ((1708 . 1709)) nil (26481 27219 773595 0) 0 nil])
([nil nil ((#("// Check that the user trying to set the role is an admin" 0 3 (font-lock-multiline t face font-lock-comment-delimiter-face fontified t) 3 57 (font-lock-multiline t face font-lock-comment-face fontified t)) . 1527) (undo-tree-id16 . -57) (undo-tree-id17 . -57) (t 26481 27219 775532 81000)) nil (26481 27525 869502 0) 0 nil])
([nil nil ((1527 . 1532)) nil (26481 27525 869500 0) 0 nil])
([nil nil ((1532 . 1538)) nil (26481 27525 869500 0) 0 nil])
([nil nil ((#("i" 0 1 (face font-lock-variable-name-face font-lock-multiline t fontified t)) . -1535) (undo-tree-id13 . -1) (#("n" 0 1 (face font-lock-variable-name-face font-lock-multiline t fontified t)) . -1536) (undo-tree-id14 . -1) (#("t" 0 1 (face font-lock-variable-name-face font-lock-multiline t fontified t)) . -1537) (undo-tree-id15 . -1) 1538) nil (26481 27525 869499 0) 0 nil])
([nil nil ((1535 . 1541)) nil (26481 27525 869496 0) 0 nil])
([nil nil ((#("-" 0 1 (font-lock-multiline t fontified t)) . -1540) (undo-tree-id12 . -1) 1541) nil (26481 27525 869495 0) 0 nil])
([nil nil ((1540 . 1543)) nil (26481 27525 869494 0) 0 nil])
([nil nil ((#("w" 0 1 (font-lock-multiline t fontified t)) . -1542) (undo-tree-id11 . -1) 1543) nil (26481 27525 869493 0) 0 nil])
([nil nil ((1542 . 1551)) nil (26481 27525 869491 0) 0 nil])
([nil nil ((1551 . 1553)) nil (26481 27525 869490 0) 0 nil])
([nil nil ((1548 . 1559) (#("clerk" 0 5 (font-lock-multiline t fontified t)) . -1548) (undo-tree-id3 . -5) (undo-tree-id4 . -5) (undo-tree-id5 . -5) (undo-tree-id6 . -5) (undo-tree-id7 . -5) (undo-tree-id8 . -5) (undo-tree-id9 . -5) (undo-tree-id10 . -5) 1553) nil (26481 27525 869488 0) 0 nil])
([nil nil ((1559 . 1561)) nil (26481 27525 869474 0) 0 nil])
([nil nil ((#("	const res = await clerkClient.users.updateUser(
	    formData.get(\"id\") as string,
	    {
		publicMetadata: { role: formData.get(\"role\") },
	    }
	);" 0 1 (font-lock-multiline t fontified t) 1 6 (font-lock-multiline t face font-lock-keyword-face fontified t) 6 7 (font-lock-multiline t fontified t) 7 10 (face font-lock-variable-name-face font-lock-multiline t fontified t) 10 13 (font-lock-multiline t fontified t) 13 18 (font-lock-multiline t face font-lock-keyword-face fontified t) 18 37 (font-lock-multiline t fontified t) 37 47 (face font-lock-function-name-face font-lock-multiline t fontified t) 47 63 (font-lock-multiline t fontified t) 63 66 (font-lock-multiline t face font-lock-function-name-face fontified t) 66 67 (font-lock-multiline t fontified t) 67 71 (font-lock-multiline t face font-lock-string-face fontified t) 71 73 (font-lock-multiline t fontified t) 73 75 (font-lock-multiline t face font-lock-keyword-face fontified t) 75 76 (font-lock-multiline t fontified t) 76 82 (font-lock-multiline t face typescript-primitive-face fontified t) 82 126 (font-lock-multiline t fontified t) 126 129 (font-lock-multiline t face font-lock-function-name-face fontified t) 129 130 (font-lock-multiline t fontified t) 130 136 (font-lock-multiline t face font-lock-string-face fontified t) 136 151 (font-lock-multiline t fontified t)) . 1650) (undo-tree-id18 . -151) (undo-tree-id19 . -27) (undo-tree-id20 . -24) (undo-tree-id21 . -34) (undo-tree-id22 . -35) (undo-tree-id23 . -83) (undo-tree-id24 . -83) (undo-tree-id25 . -7) (undo-tree-id26 . -7) (undo-tree-id27 . -90) (undo-tree-id28 . -90) (undo-tree-id29 . -90) (undo-tree-id30 . -90) (undo-tree-id31 . -90) (undo-tree-id32 . -151) (undo-tree-id33 . -151) (undo-tree-id34 . -151) (undo-tree-id35 . -83) (undo-tree-id36 . -151) (t 26481 27525 872778 508000)) nil (26481 27568 53591 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 1780 . 1781) (nil fontified nil 1650 . 1781) (1650 . 1781)) nil (26481 27568 53570 0) 0 nil])
([nil nil ((#("    try {
    const res = await client.users.updateUser(formData.get('id') as string, {
      publicMetadata: { role: formData.get('role') },
	return { message: res.publicMetadata };
    } catch (err) {
	return { message: err };
    }
}" 0 4 (fontified t) 4 7 (face font-lock-keyword-face fontified t) 7 10 (fontified t) 10 14 (fontified t) 14 19 (face font-lock-keyword-face fontified t) 19 20 (fontified t) 20 23 (face font-lock-variable-name-face fontified t) 23 26 (fontified t) 26 31 (face font-lock-keyword-face fontified t) 31 45 (fontified t) 45 55 (face font-lock-function-name-face fontified t) 55 65 (fontified t) 65 68 (face font-lock-function-name-face fontified t) 68 69 (fontified t) 69 73 (face font-lock-string-face fontified t) 73 75 (fontified t) 75 77 (face font-lock-keyword-face fontified t) 77 78 (fontified t) 78 84 (face typescript-primitive-face fontified t) 84 86 (fontified t) 86 127 (font-lock-multiline t fontified t) 127 130 (font-lock-multiline t face font-lock-function-name-face fontified t) 130 131 (font-lock-multiline t fontified t) 131 137 (font-lock-multiline t face font-lock-string-face fontified t) 137 140 (font-lock-multiline t fontified t) 140 141 (font-lock-multiline t rear-nonsticky t fontified t) 141 143 (font-lock-multiline t fontified t) 143 149 (font-lock-multiline t face font-lock-keyword-face fontified t) 149 188 (font-lock-multiline t fontified t) 188 189 (fontified t) 189 194 (face font-lock-keyword-face fontified t) 194 201 (fontified t) 201 204 (font-lock-multiline t fontified t) 204 210 (font-lock-multiline t face font-lock-keyword-face fontified t) 210 234 (font-lock-multiline t fontified t) 234 235 (fontified t) 235 236 (fontified t)) . 1640) (undo-tree-id37 . -236) (undo-tree-id38 . -236) (undo-tree-id39 . -9) (undo-tree-id40 . -195) (undo-tree-id41 . -8) (undo-tree-id42 . -230) (undo-tree-id43 . -236) (undo-tree-id44 . -236) (undo-tree-id45 . -10) (undo-tree-id46 . -236) (t 26481 27568 56797 302000)) nil (26481 27595 446721 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 1879 . 1880) (nil fontified nil 1640 . 1880) (1640 . 1880)) nil (26481 27595 446704 0) 0 nil])
([nil nil ((#("
" 0 1 (fontified t)) . -745) (undo-tree-id47 . -1) (undo-tree-id48 . -1) (undo-tree-id49 . -1) (undo-tree-id50 . -1) (undo-tree-id51 . -1) (#("
" 0 1 (fontified t)) . -746) (undo-tree-id52 . -1) (undo-tree-id53 . -1) (undo-tree-id54 . -1) 747 (t 26481 27595 448146 967000)) nil (26486 51746 807663 0) 0 nil])
([nil nil ((#("i" 0 1 (font-lock-multiline t fontified t)) . -4326) (undo-tree-id56 . -1) (undo-tree-id57 . -1) (undo-tree-id58 . -1) (#("m" 0 1 (font-lock-multiline t fontified t)) . -4327) (undo-tree-id59 . -1) (undo-tree-id60 . -1) (undo-tree-id61 . -1) (#("a" 0 1 (font-lock-multiline t fontified t)) . -4328) (undo-tree-id62 . -1) (undo-tree-id63 . -1) (undo-tree-id64 . -1) (#("g" 0 1 (font-lock-multiline t fontified t)) . -4329) (undo-tree-id65 . -1) (undo-tree-id66 . -1) (undo-tree-id67 . -1) (#("e" 0 1 (font-lock-multiline t fontified t)) . -4330) (undo-tree-id68 . -1) (undo-tree-id69 . -1) (undo-tree-id70 . -1) (#("I" 0 1 (font-lock-multiline t fontified t)) . -4331) (undo-tree-id71 . -1) 4332 (t 26486 51746 810962 959000)) nil (26486 51770 75621 0) 0 nil])
([nil nil ((4326 . 4327)) nil (26486 51770 75610 0) 0 nil])
([nil nil ((#("g" 0 1 (font-lock-multiline t fontified t)) . -4326) (undo-tree-id55 . -1) 4327) nil (26486 51770 75608 0) 0 nil])
([nil nil ((4326 . 4327)) nil (26486 51770 75598 0) 0 nil])
([nil nil ((#("\"use server\"
import { z } from 'zod'
import { stripe } from '@/lib/stripe'
import { checkRole } from \"@/../utils/roles\";
import { clerkClient } from \"@clerk/nextjs/server\";
import { productCatalouge, images, orders, users } from '@/db/schema'; 
import { db }  from \"@/db/index\";
import { eq } from 'drizzle-orm';
import { S3Client, PutObjectCommand,   } from \"@aws-sdk/client-s3\"
import { getSignedUrl } from \"@aws-sdk/s3-request-presigner\"
import crypto from \"crypto\"
import {Orders} from \"@/app/types\"
import { format, Order } from \"@/app/zod\"

export async function authManage(email:string|null=null, name:string|null=null, authId:string ) {
	await db.insert(users).values({
	    email: email,
	    authId: authId,
	    authName: name
	})
}

export async function orderStatus(orderID: number) {
    const order = await db.select().from(orders).where(eq(orders.id, orderID))
	const parsedOrder = Order.parse(order)
	return parsedOrder.orderStatus
}

export async function updateOrderStatus(orderID: number) {
    const order = await db.query.orders.findFirst({
	where: eq(orders.id, orderID)
    })
    	const parsedOrder = Order.parse(order)
    if (parsedOrder.orderStatus == \"Your order has been shipped.\" ) {
	await db.update(orders).set({orderStatus: \"Your order has been received.\" })
	    .where(eq(orders.id, orderID))
    }
    else {
	await db.update(orders).set({orderStatus: \"Your order has been shipped.\" })
	    .where(eq(orders.id, orderID))
    }
}

export async function setRole(formData: FormData) {
    const client = await clerkClient()
    if (!checkRole(\"admin\")) {
	return { message: \"Not Authorized\" };
    }  
 try {
    const res = await client.users.updateUser(formData.get('id') as string, {
      publicMetadata: { role: formData.get('role') },
    })
    return { message: res.publicMetadata }
  } catch (err) {
    return { message: err }
  }
}

export async function createProduct(formData: FormData) {
    const info = format.parse({
        name: formData.get('name'),
        price: formData.get(\"price\"),
        imageLocation: formData.get('imageLocation'),
        category: formData.get('category'),
    });
    try {
        await db.insert(productCatalouge).values({
            name: info.name,
            imageLocation: info.imageLocation ,
            price: info.price,
            category: info.category ,
        });
        await stripe.products.create({
            name: info.name,
        });
        await stripe.prices.create({
            currency: 'gpp',
            unit_amount: Math.round(info.price * 100),
            product_data: {
                name: info.name,
            },
        });
        console.log('Product created successfully!');
    } catch (error) {
        console.error('Error creating product:', error);
    }
}


const s3Client = new S3Client({
    region: process.env.AWS_REGION!,
    credentials: {
	accessKeyId: process.env.AWS_ACCESS_KEY_ID!,
	secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY!,
    },
})

const allowedFileTypes = [
    \"image/jpeg\",
    \"image/png\",
]

const maxFileSize = 1048576 * 10 // 1 MB

const generateFileName = (bytes = 32) => crypto.randomBytes(bytes).toString(\"hex\")

type SignedURLResponse = Promise<
    | { failure?: undefined; success: { url: string; id: number } }
    | { failure: string; success?: undefined }
>

type GetSignedURLParams = {
    fileType: string
    fileSize: number
    checksum: string
}
export const getSignedURL = async ({
    fileType,
    fileSize,
    checksum,
}: GetSignedURLParams): SignedURLResponse => {


    if (!allowedFileTypes.includes(fileType)) {
	return { failure: \"File type not allowed\" }
    }

    if (fileSize > maxFileSize) {
	return { failure: \"File size too large\" }
    }

    const fileName = generateFileName()

    const putObjectCommand = new PutObjectCommand({
	Bucket: process.env.AWS_BUCKET_NAME,
	Key: fileName,
	ContentType: fileType,
	ContentLength: fileSize,
	ChecksumSHA256: checksum,
    })

    const url = await getSignedUrl(
	s3Client,
	putObjectCommand,
	{ expiresIn: 60 } // 60 seconds
    )

    console.log({ success: url })

    await db
	.insert(images)
	.values({
	    url: url.split(\"?\")[0],
	    width: 0,
	    height: 0,
	})
    const results = await db.select().from(images)
    
    return { success: { url, id: results[0].id } }
}
" 0 12 (face font-lock-string-face fontified t) 12 13 (fontified t) 13 19 (face font-lock-keyword-face fontified t) 19 26 (fontified t) 26 30 (face font-lock-keyword-face fontified t) 30 31 (fontified t) 31 36 (face font-lock-string-face fontified t) 36 37 (fontified t) 37 43 (face font-lock-keyword-face fontified t) 43 55 (fontified t) 55 59 (face font-lock-keyword-face fontified t) 59 60 (fontified t) 60 74 (face font-lock-string-face fontified t) 74 75 (fontified t) 75 81 (face font-lock-keyword-face fontified t) 81 96 (fontified t) 96 100 (face font-lock-keyword-face fontified t) 100 101 (fontified t) 101 119 (face font-lock-string-face fontified t) 119 121 (fontified t) 121 127 (face font-lock-keyword-face fontified t) 127 144 (fontified t) 144 148 (face font-lock-keyword-face fontified t) 148 149 (fontified t) 149 171 (face font-lock-string-face fontified t) 171 173 (fontified t) 173 179 (face font-lock-keyword-face fontified t) 179 224 (fontified t) 224 228 (face font-lock-keyword-face fontified t) 228 229 (fontified t) 229 242 (face font-lock-string-face fontified t) 242 245 (fontified t) 245 251 (face font-lock-keyword-face fontified t) 251 260 (fontified t) 260 264 (face font-lock-keyword-face fontified t) 264 265 (fontified t) 265 277 (face font-lock-string-face fontified t) 277 279 (fontified t) 279 285 (face font-lock-keyword-face fontified t) 285 293 (fontified t) 293 297 (face font-lock-keyword-face fontified t) 297 298 (fontified t) 298 311 (face font-lock-string-face fontified t) 311 313 (fontified t) 313 319 (face font-lock-keyword-face fontified t) 319 354 (fontified t) 354 358 (face font-lock-keyword-face fontified t) 358 359 (fontified t) 359 379 (face font-lock-string-face fontified t) 379 380 (fontified t) 380 386 (face font-lock-keyword-face fontified t) 386 404 (fontified t) 404 408 (face font-lock-keyword-face fontified t) 408 409 (fontified t) 409 440 (face font-lock-string-face fontified t) 440 441 (fontified t) 441 447 (face font-lock-keyword-face fontified t) 447 455 (fontified t) 455 459 (face font-lock-keyword-face fontified t) 459 460 (fontified t) 460 468 (face font-lock-string-face fontified t) 468 469 (fontified t) 469 475 (face font-lock-keyword-face fontified t) 475 485 (fontified t) 485 489 (face font-lock-keyword-face fontified t) 489 490 (fontified t) 490 503 (face font-lock-string-face fontified t) 503 504 (fontified t) 504 510 (face font-lock-keyword-face fontified t) 510 529 (fontified t) 529 533 (face font-lock-keyword-face fontified t) 533 534 (fontified t) 534 545 (face font-lock-string-face fontified t) 545 547 (fontified t) 547 553 (face font-lock-keyword-face fontified t) 553 554 (fontified t) 554 559 (face font-lock-keyword-face fontified t) 559 560 (fontified t) 560 568 (face font-lock-keyword-face fontified t) 568 569 (fontified t) 569 579 (face font-lock-function-name-face fontified t) 579 580 (fontified t) 580 585 (face font-lock-variable-name-face fontified t) 585 586 (fontified t) 586 592 (face typescript-primitive-face fontified t) 592 593 (fontified t) 593 597 (face font-lock-constant-face fontified t) 597 598 (fontified t) 598 602 (face font-lock-constant-face fontified t) 602 604 (fontified t) 604 608 (face font-lock-variable-name-face fontified t) 608 609 (fontified t) 609 615 (face typescript-primitive-face fontified t) 615 616 (fontified t) 616 620 (face font-lock-constant-face fontified t) 620 621 (fontified t) 621 625 (face font-lock-constant-face fontified t) 625 627 (fontified t) 627 633 (face font-lock-variable-name-face fontified t) 633 634 (fontified t) 634 640 (face typescript-primitive-face fontified t) 640 643 (fontified t) 643 644 (typescript--pstate ((nil 0 function 561 ("authManage") 744) (nil -2305843009213693952 toplevel nil nil nil)) font-lock-multiline t fontified t) 644 646 (font-lock-multiline t fontified t) 646 651 (font-lock-multiline t face font-lock-keyword-face fontified t) 651 655 (font-lock-multiline t fontified t) 655 661 (face font-lock-function-name-face font-lock-multiline t fontified t) 661 669 (font-lock-multiline t fontified t) 669 675 (face font-lock-function-name-face font-lock-multiline t fontified t) 675 742 (font-lock-multiline t fontified t) 742 743 (typescript--pend (nil 0 function 561 ("authManage") 744) font-lock-multiline t fontified t) 743 744 (fontified t) 744 745 (fontified t) 745 751 (face font-lock-keyword-face fontified t) 751 752 (fontified t) 752 757 (face font-lock-keyword-face fontified t) 757 758 (fontified t) 758 766 (face font-lock-keyword-face fontified t) 766 767 (fontified t) 767 778 (face font-lock-function-name-face fontified t) 778 779 (fontified t) 779 786 (face font-lock-variable-name-face fontified t) 786 788 (fontified t) 788 794 (face typescript-primitive-face fontified t) 794 796 (fontified t) 796 797 (typescript--pstate ((nil 0 function 759 ("orderStatus") 951) (((nil 0 function 561 ("authManage") 744)) -2305843009213693952 toplevel nil nil nil)) font-lock-multiline t fontified t) 797 802 (font-lock-multiline t fontified t) 802 807 (font-lock-multiline t face font-lock-keyword-face fontified t) 807 808 (font-lock-multiline t fontified t) 808 813 (face font-lock-variable-name-face font-lock-multiline t fontified t) 813 816 (font-lock-multiline t fontified t) 816 821 (font-lock-multiline t face font-lock-keyword-face fontified t) 821 825 (font-lock-multiline t fontified t) 825 831 (face font-lock-function-name-face font-lock-multiline t fontified t) 831 834 (font-lock-multiline t fontified t) 834 838 (font-lock-multiline t face font-lock-function-name-face fontified t) 838 839 (font-lock-multiline t fontified t) 839 845 (face font-lock-variable-name-face font-lock-multiline t fontified t) 845 847 (font-lock-multiline t fontified t) 847 852 (face font-lock-function-name-face font-lock-multiline t fontified t) 852 853 (font-lock-multiline t fontified t) 853 855 (face font-lock-function-name-face font-lock-multiline t fontified t) 855 863 (font-lock-multiline t fontified t) 863 865 (face font-lock-variable-name-face font-lock-multiline t fontified t) 865 867 (font-lock-multiline t fontified t) 867 874 (face font-lock-variable-name-face font-lock-multiline t fontified t) 874 878 (font-lock-multiline t fontified t) 878 883 (font-lock-multiline t face font-lock-keyword-face fontified t) 883 884 (font-lock-multiline t fontified t) 884 895 (face font-lock-variable-name-face font-lock-multiline t fontified t) 895 904 (font-lock-multiline t fontified t) 904 909 (face font-lock-function-name-face font-lock-multiline t fontified t) 909 918 (font-lock-multiline t fontified t) 918 924 (font-lock-multiline t face font-lock-keyword-face fontified t) 924 949 (font-lock-multiline t fontified t) 949 950 (typescript--pend (nil 0 function 759 ("orderStatus") 951) font-lock-multiline t fontified t) 950 952 (fontified t) 952 958 (face font-lock-keyword-face fontified t) 958 959 (fontified t) 959 964 (face font-lock-keyword-face fontified t) 964 965 (fontified t) 965 973 (face font-lock-keyword-face fontified t) 973 974 (fontified t) 974 991 (face font-lock-function-name-face fontified t) 991 992 (fontified t) 992 999 (face font-lock-variable-name-face fontified t) 999 1001 (fontified t) 1001 1007 (face typescript-primitive-face fontified t) 1007 1009 (fontified t) 1009 1010 (typescript--pstate ((nil 0 function 966 ("updateOrderStatus") 1467) (((nil 0 function 759 ("orderStatus") 951) (nil 0 function 561 ("authManage") 744)) -2305843009213693952 toplevel nil nil nil)) font-lock-multiline t fontified t) 1010 1015 (font-lock-multiline t fontified t) 1015 1020 (font-lock-multiline t face font-lock-keyword-face fontified t) 1020 1021 (font-lock-multiline t fontified t) 1021 1026 (face font-lock-variable-name-face font-lock-multiline t fontified t) 1026 1029 (font-lock-multiline t fontified t) 1029 1034 (font-lock-multiline t face font-lock-keyword-face fontified t) 1034 1051 (font-lock-multiline t fontified t) 1051 1060 (face font-lock-function-name-face font-lock-multiline t fontified t) 1060 1071 (font-lock-multiline t fontified t) 1071 1073 (face font-lock-function-name-face font-lock-multiline t fontified t) 1073 1106 (font-lock-multiline t fontified t) 1106 1111 (font-lock-multiline t face font-lock-keyword-face fontified t) 1111 1112 (font-lock-multiline t fontified t) 1112 1123 (face font-lock-variable-name-face font-lock-multiline t fontified t) 1123 1132 (font-lock-multiline t fontified t) 1132 1137 (face font-lock-function-name-face font-lock-multiline t fontified t) 1137 1149 (font-lock-multiline t fontified t) 1149 1151 (font-lock-multiline t face font-lock-keyword-face fontified t) 1151 1180 (font-lock-multiline t fontified t) 1180 1210 (font-lock-multiline t face font-lock-string-face fontified t) 1210 1216 (font-lock-multiline t fontified t) 1216 1221 (font-lock-multiline t face font-lock-keyword-face fontified t) 1221 1225 (font-lock-multiline t fontified t) 1225 1231 (face font-lock-function-name-face font-lock-multiline t fontified t) 1231 1240 (font-lock-multiline t fontified t) 1240 1243 (font-lock-multiline t face font-lock-function-name-face fontified t) 1243 1245 (font-lock-multiline t fontified t) 1245 1256 (face font-lock-variable-name-face font-lock-multiline t fontified t) 1256 1258 (font-lock-multiline t fontified t) 1258 1289 (font-lock-multiline t face font-lock-string-face fontified t) 1289 1299 (font-lock-multiline t fontified t) 1299 1304 (face font-lock-function-name-face font-lock-multiline t fontified t) 1304 1305 (font-lock-multiline t fontified t) 1305 1307 (face font-lock-function-name-face font-lock-multiline t fontified t) 1307 1339 (font-lock-multiline t fontified t) 1339 1343 (font-lock-multiline t face font-lock-keyword-face fontified t) 1343 1347 (font-lock-multiline t fontified t) 1347 1352 (font-lock-multiline t face font-lock-keyword-face fontified t) 1352 1356 (font-lock-multiline t fontified t) 1356 1362 (face font-lock-function-name-face font-lock-multiline t fontified t) 1362 1371 (font-lock-multiline t fontified t) 1371 1374 (font-lock-multiline t face font-lock-function-name-face fontified t) 1374 1376 (font-lock-multiline t fontified t) 1376 1387 (face font-lock-variable-name-face font-lock-multiline t fontified t) 1387 1389 (font-lock-multiline t fontified t) 1389 1419 (font-lock-multiline t face font-lock-string-face fontified t) 1419 1429 (font-lock-multiline t fontified t) 1429 1434 (face font-lock-function-name-face font-lock-multiline t fontified t) 1434 1435 (font-lock-multiline t fontified t) 1435 1437 (face font-lock-function-name-face font-lock-multiline t fontified t) 1437 1465 (font-lock-multiline t fontified t) 1465 1466 (typescript--pend (nil 0 function 966 ("updateOrderStatus") 1467) font-lock-multiline t fontified t) 1466 1468 (fontified t) 1468 1474 (face font-lock-keyword-face fontified t) 1474 1475 (fontified t) 1475 1480 (face font-lock-keyword-face fontified t) 1480 1481 (fontified t) 1481 1489 (face font-lock-keyword-face fontified t) 1489 1490 (fontified t) 1490 1497 (face font-lock-function-name-face fontified t) 1497 1498 (fontified t) 1498 1506 (face font-lock-variable-name-face fontified t) 1506 1508 (fontified t) 1508 1516 (face font-lock-type-face fontified t) 1516 1518 (fontified t) 1518 1519 (typescript--pstate ((nil 0 function 1482 ("setRole") 1878) (((nil 0 function 966 ("updateOrderStatus") 1467) (nil 0 function 759 ("orderStatus") 951) (nil 0 function 561 ("authManage") 744)) -2305843009213693952 toplevel nil nil nil)) font-lock-multiline t fontified t) 1519 1520 (font-lock-multiline t fontified t) 1520 1524 (font-lock-multiline t fontified t) 1524 1529 (font-lock-multiline t face font-lock-keyword-face fontified t) 1529 1530 (font-lock-multiline t fontified t) 1530 1536 (face font-lock-variable-name-face font-lock-multiline t fontified t) 1536 1539 (font-lock-multiline t fontified t) 1539 1544 (font-lock-multiline t face font-lock-keyword-face fontified t) 1544 1545 (font-lock-multiline t fontified t) 1545 1556 (face font-lock-function-name-face font-lock-multiline t fontified t) 1556 1558 (font-lock-multiline t fontified t) 1558 1559 (font-lock-multiline t fontified t) 1559 1563 (font-lock-multiline t fontified t) 1563 1565 (font-lock-multiline t face font-lock-keyword-face fontified t) 1565 1568 (font-lock-multiline t fontified t) 1568 1577 (face font-lock-function-name-face font-lock-multiline t fontified t) 1577 1578 (font-lock-multiline t fontified t) 1578 1585 (font-lock-multiline t face font-lock-string-face fontified t) 1585 1588 (font-lock-multiline t fontified t) 1588 1591 (font-lock-multiline t fontified t) 1591 1597 (font-lock-multiline t face font-lock-keyword-face fontified t) 1597 1609 (font-lock-multiline t fontified t) 1609 1625 (font-lock-multiline t face font-lock-string-face fontified t) 1625 1634 (font-lock-multiline t fontified t) 1634 1637 (font-lock-multiline t fontified t) 1637 1638 (font-lock-multiline t fontified t) 1638 1641 (font-lock-multiline t face font-lock-keyword-face fontified t) 1641 1642 (font-lock-multiline t fontified t) 1642 1648 (font-lock-multiline t fontified t) 1648 1653 (font-lock-multiline t face font-lock-keyword-face fontified t) 1653 1654 (font-lock-multiline t fontified t) 1654 1657 (face font-lock-variable-name-face font-lock-multiline t fontified t) 1657 1660 (font-lock-multiline t fontified t) 1660 1665 (font-lock-multiline t face font-lock-keyword-face fontified t) 1665 1679 (font-lock-multiline t fontified t) 1679 1689 (face font-lock-function-name-face font-lock-multiline t fontified t) 1689 1699 (font-lock-multiline t fontified t) 1699 1702 (font-lock-multiline t face font-lock-function-name-face fontified t) 1702 1703 (font-lock-multiline t fontified t) 1703 1707 (font-lock-multiline t face font-lock-string-face fontified t) 1707 1709 (font-lock-multiline t fontified t) 1709 1711 (font-lock-multiline t face font-lock-keyword-face fontified t) 1711 1712 (font-lock-multiline t fontified t) 1712 1718 (font-lock-multiline t face typescript-primitive-face fontified t) 1718 1761 (font-lock-multiline t fontified t) 1761 1764 (font-lock-multiline t face font-lock-function-name-face fontified t) 1764 1765 (font-lock-multiline t fontified t) 1765 1771 (font-lock-multiline t face font-lock-string-face fontified t) 1771 1787 (font-lock-multiline t fontified t) 1787 1793 (font-lock-multiline t face font-lock-keyword-face fontified t) 1793 1829 (font-lock-multiline t fontified t) 1829 1830 (font-lock-multiline t fontified t) 1830 1835 (font-lock-multiline t face font-lock-keyword-face fontified t) 1835 1842 (font-lock-multiline t fontified t) 1842 1848 (font-lock-multiline t fontified t) 1848 1854 (font-lock-multiline t face font-lock-keyword-face fontified t) 1854 1875 (font-lock-multiline t fontified t) 1875 1876 (font-lock-multiline t fontified t) 1876 1877 (typescript--pend (nil 0 function 1482 ("setRole") 1878) font-lock-multiline t fontified t rear-nonsticky t) 1877 1878 (fontified t) 1878 1879 (fontified t) 1879 1885 (face font-lock-keyword-face fontified t) 1885 1886 (fontified t) 1886 1891 (face font-lock-keyword-face fontified t) 1891 1892 (fontified t) 1892 1900 (face font-lock-keyword-face fontified t) 1900 1901 (fontified t) 1901 1914 (face font-lock-function-name-face fontified t) 1914 1915 (fontified t) 1915 1923 (face font-lock-variable-name-face fontified t) 1923 1925 (fontified t) 1925 1933 (face font-lock-type-face fontified t) 1933 1935 (fontified t) 1935 1936 (typescript--pstate ((nil 0 function 1893 ("createProduct") 2798) (((nil 0 function 1482 ("setRole") 1878) (nil 0 function 966 ("updateOrderStatus") 1467) (nil 0 function 759 ("orderStatus") 951) (nil 0 function 561 ("authManage") 744)) -2305843009213693952 toplevel nil nil nil)) font-lock-multiline t fontified t) 1936 1941 (font-lock-multiline t fontified t) 1941 1946 (font-lock-multiline t face font-lock-keyword-face fontified t) 1946 1947 (font-lock-multiline t fontified t) 1947 1951 (face font-lock-variable-name-face font-lock-multiline t fontified t) 1951 1961 (font-lock-multiline t fontified t) 1961 1966 (face font-lock-function-name-face font-lock-multiline t fontified t) 1966 1992 (font-lock-multiline t fontified t) 1992 1995 (font-lock-multiline t face font-lock-function-name-face fontified t) 1995 1996 (font-lock-multiline t fontified t) 1996 2002 (font-lock-multiline t face font-lock-string-face fontified t) 2002 2029 (font-lock-multiline t fontified t) 2029 2032 (font-lock-multiline t face font-lock-function-name-face fontified t) 2032 2033 (font-lock-multiline t fontified t) 2033 2040 (font-lock-multiline t face font-lock-string-face fontified t) 2040 2075 (font-lock-multiline t fontified t) 2075 2078 (font-lock-multiline t face font-lock-function-name-face fontified t) 2078 2079 (font-lock-multiline t fontified t) 2079 2094 (font-lock-multiline t face font-lock-string-face fontified t) 2094 2124 (font-lock-multiline t fontified t) 2124 2127 (font-lock-multiline t face font-lock-function-name-face fontified t) 2127 2128 (font-lock-multiline t fontified t) 2128 2138 (font-lock-multiline t face font-lock-string-face fontified t) 2138 2153 (font-lock-multiline t fontified t) 2153 2156 (font-lock-multiline t face font-lock-keyword-face fontified t) 2156 2167 (font-lock-multiline t fontified t) 2167 2172 (font-lock-multiline t face font-lock-keyword-face fontified t) 2172 2176 (font-lock-multiline t fontified t) 2176 2182 (face font-lock-function-name-face font-lock-multiline t fontified t) 2182 2201 (font-lock-multiline t fontified t) 2201 2207 (face font-lock-function-name-face font-lock-multiline t fontified t) 2207 2245 (font-lock-multiline t fontified t) 2245 2376 (fontified t font-lock-multiline t) 2376 2381 (fontified t font-lock-multiline t face font-lock-keyword-face) 2381 2398 (fontified t font-lock-multiline t) 2398 2404 (fontified t face font-lock-function-name-face font-lock-multiline t) 2404 2456 (fontified t font-lock-multiline t) 2456 2461 (fontified t font-lock-multiline t face font-lock-keyword-face) 2461 2476 (fontified t font-lock-multiline t) 2476 2482 (fontified t face font-lock-function-name-face font-lock-multiline t) 2482 2507 (fontified t font-lock-multiline t) 2507 2512 (fontified t font-lock-multiline t face font-lock-string-face) 2512 2539 (fontified t font-lock-multiline t) 2539 2543 (fontified t font-lock-multiline t face font-lock-type-face) 2543 2544 (fontified t font-lock-multiline t) 2544 2549 (fontified t face font-lock-function-name-face font-lock-multiline t) 2549 2665 (fontified t font-lock-multiline t) 2665 2672 (fontified t face font-lock-type-face font-lock-multiline t) 2672 2673 (fontified t font-lock-multiline t) 2673 2676 (fontified t face font-lock-function-name-face font-lock-multiline t) 2676 2677 (fontified t font-lock-multiline t) 2677 2708 (fontified t font-lock-multiline t face font-lock-string-face) 2708 2717 (fontified t font-lock-multiline t) 2717 2722 (fontified t font-lock-multiline t face font-lock-keyword-face) 2722 2741 (fontified t font-lock-multiline t) 2741 2748 (fontified t face font-lock-type-face font-lock-multiline t) 2748 2749 (fontified t font-lock-multiline t) 2749 2754 (fontified t face font-lock-function-name-face font-lock-multiline t) 2754 2755 (fontified t font-lock-multiline t) 2755 2780 (fontified t font-lock-multiline t face font-lock-string-face) 2780 2796 (fontified t font-lock-multiline t) 2796 2797 (typescript--pend (nil 0 function 1893 ("createProduct") 2798) fontified t font-lock-multiline t) 2797 2798 (fontified t) 2798 2800 (fontified t) 2800 2805 (face font-lock-keyword-face fontified t) 2805 2806 (fontified t) 2806 2814 (face font-lock-variable-name-face fontified t) 2814 2817 (fontified t) 2817 2820 (face font-lock-keyword-face fontified t) 2820 2821 (fontified t) 2821 2829 (face font-lock-type-face fontified t) 2829 2830 (fontified t) 2830 2981 (font-lock-multiline t fontified t) 2981 2988 (font-lock-multiline t fontified t) 2988 2996 (font-lock-multiline t fontified t) 2996 2999 (fontified t) 2999 3004 (face font-lock-keyword-face fontified t) 3004 3005 (fontified t) 3005 3021 (face font-lock-variable-name-face fontified t) 3021 3030 (fontified t) 3030 3042 (face font-lock-string-face fontified t) 3042 3048 (fontified t) 3048 3059 (face font-lock-string-face fontified t) 3059 3064 (fontified t) 3064 3069 (face font-lock-keyword-face fontified t) 3069 3070 (fontified t) 3070 3081 (face font-lock-variable-name-face fontified t) 3081 3097 (fontified t) 3097 3100 (face font-lock-comment-delimiter-face fontified t) 3100 3105 (face font-lock-comment-face fontified t) 3105 3106 (fontified t) 3106 3111 (face font-lock-keyword-face fontified t) 3111 3112 (fontified t) 3112 3128 (face font-lock-variable-name-face fontified t) 3128 3144 (fontified t) 3144 3146 (face font-lock-keyword-face fontified t) 3146 3154 (fontified t) 3154 3165 (face font-lock-function-name-face fontified t) 3165 3173 (fontified t) 3173 3181 (face font-lock-function-name-face fontified t) 3181 3182 (fontified t) 3182 3187 (face font-lock-string-face fontified t) 3187 3190 (fontified t) 3190 3194 (face font-lock-keyword-face fontified t) 3194 3195 (fontified t) 3195 3212 (face font-lock-type-face fontified t) 3212 3242 (fontified t) 3242 3251 (face font-lock-constant-face fontified t) 3251 3269 (fontified t) 3269 3275 (face typescript-primitive-face fontified t) 3275 3281 (fontified t) 3281 3287 (face typescript-primitive-face fontified t) 3287 3309 (fontified t) 3309 3315 (face typescript-primitive-face fontified t) 3315 3327 (fontified t) 3327 3336 (face font-lock-constant-face fontified t) 3336 3342 (fontified t) 3342 3346 (face font-lock-keyword-face fontified t) 3346 3347 (fontified t) 3347 3365 (face font-lock-type-face fontified t) 3365 3368 (fontified t) 3368 3378 (font-lock-multiline t fontified t) 3378 3384 (font-lock-multiline t fontified t) 3384 3390 (font-lock-multiline t face typescript-primitive-face fontified t) 3390 3391 (font-lock-multiline t fontified t) 3391 3405 (font-lock-multiline t fontified t) 3405 3411 (font-lock-multiline t face typescript-primitive-face fontified t) 3411 3426 (font-lock-multiline t fontified t) 3426 3432 (font-lock-multiline t face typescript-primitive-face fontified t) 3432 3434 (font-lock-multiline t fontified t) 3434 3435 (fontified t) 3435 3441 (face font-lock-keyword-face fontified t) 3441 3442 (fontified t) 3442 3447 (face font-lock-keyword-face fontified t) 3447 3448 (fontified t) 3448 3460 (face font-lock-variable-name-face fontified t) 3460 3463 (fontified t) 3463 3468 (face font-lock-keyword-face fontified t) 3468 3469 (fontified t) 3469 3470 (font-lock-multiline t fontified t) 3470 3476 (font-lock-multiline t fontified t) 3476 3484 (face font-lock-variable-name-face font-lock-multiline t fontified t) 3484 3490 (font-lock-multiline t fontified t) 3490 3498 (face font-lock-variable-name-face font-lock-multiline t fontified t) 3498 3504 (font-lock-multiline t fontified t) 3504 3512 (face font-lock-variable-name-face font-lock-multiline t fontified t) 3512 3514 (font-lock-multiline t fontified t) 3514 3515 (font-lock-multiline t fontified t) 3515 3517 (font-lock-multiline t fontified t) 3517 3535 (font-lock-multiline t face font-lock-variable-name-face fontified t) 3535 3536 (font-lock-multiline t fontified t) 3536 3538 (fontified t) 3538 3555 (face font-lock-type-face fontified t) 3555 3556 (fontified t) 3556 3558 (face font-lock-keyword-face fontified t) 3558 3559 (fontified t) 3559 3567 (font-lock-multiline t fontified t) 3567 3569 (font-lock-multiline t face font-lock-keyword-face fontified t) 3569 3589 (font-lock-multiline t fontified t) 3589 3597 (face font-lock-function-name-face font-lock-multiline t fontified t) 3597 3612 (font-lock-multiline t fontified t) 3612 3618 (font-lock-multiline t face font-lock-keyword-face fontified t) 3618 3630 (font-lock-multiline t fontified t) 3630 3653 (font-lock-multiline t face font-lock-string-face fontified t) 3653 3667 (font-lock-multiline t fontified t) 3667 3669 (font-lock-multiline t face font-lock-keyword-face fontified t) 3669 3698 (font-lock-multiline t fontified t) 3698 3704 (font-lock-multiline t face font-lock-keyword-face fontified t) 3704 3716 (font-lock-multiline t fontified t) 3716 3737 (font-lock-multiline t face font-lock-string-face fontified t) 3737 3751 (font-lock-multiline t fontified t) 3751 3756 (font-lock-multiline t face font-lock-keyword-face fontified t) 3756 3757 (font-lock-multiline t fontified t) 3757 3765 (face font-lock-variable-name-face font-lock-multiline t fontified t) 3765 3768 (font-lock-multiline t fontified t) 3768 3784 (face font-lock-function-name-face font-lock-multiline t fontified t) 3784 3792 (font-lock-multiline t fontified t) 3792 3797 (font-lock-multiline t face font-lock-keyword-face fontified t) 3797 3798 (font-lock-multiline t fontified t) 3798 3814 (face font-lock-variable-name-face font-lock-multiline t fontified t) 3814 3817 (font-lock-multiline t fontified t) 3817 3820 (font-lock-multiline t face font-lock-keyword-face fontified t) 3820 3821 (font-lock-multiline t fontified t) 3821 3837 (face font-lock-type-face font-lock-multiline t fontified t) 3837 3983 (font-lock-multiline t fontified t) 3983 3988 (font-lock-multiline t face font-lock-keyword-face fontified t) 3988 3989 (font-lock-multiline t fontified t) 3989 3992 (face font-lock-variable-name-face font-lock-multiline t fontified t) 3992 3995 (font-lock-multiline t fontified t) 3995 4000 (font-lock-multiline t face font-lock-keyword-face fontified t) 4000 4001 (font-lock-multiline t fontified t) 4001 4013 (face font-lock-function-name-face font-lock-multiline t fontified t) 4013 4026 (font-lock-multiline t fontified t) 4026 4064 (font-lock-multiline t fontified t) 4064 4067 (font-lock-multiline t face font-lock-comment-delimiter-face fontified t) 4067 4078 (font-lock-multiline t face font-lock-comment-face fontified t) 4078 4089 (font-lock-multiline t fontified t) 4089 4096 (face font-lock-type-face font-lock-multiline t fontified t) 4096 4097 (font-lock-multiline t fontified t) 4097 4100 (face font-lock-function-name-face font-lock-multiline t fontified t) 4100 4124 (font-lock-multiline t fontified t) 4124 4129 (font-lock-multiline t face font-lock-keyword-face fontified t) 4129 4135 (font-lock-multiline t fontified t) 4135 4141 (face font-lock-function-name-face font-lock-multiline t fontified t) 4141 4152 (font-lock-multiline t fontified t) 4152 4158 (face font-lock-function-name-face font-lock-multiline t fontified t) 4158 4175 (font-lock-multiline t fontified t) 4175 4180 (face font-lock-function-name-face font-lock-multiline t fontified t) 4180 4181 (font-lock-multiline t fontified t) 4181 4184 (font-lock-multiline t face font-lock-string-face fontified t) 4184 4229 (font-lock-multiline t fontified t) 4229 4234 (font-lock-multiline t face font-lock-keyword-face fontified t) 4234 4235 (font-lock-multiline t fontified t) 4235 4242 (face font-lock-variable-name-face font-lock-multiline t fontified t) 4242 4245 (font-lock-multiline t fontified t) 4245 4250 (font-lock-multiline t face font-lock-keyword-face fontified t) 4250 4254 (font-lock-multiline t fontified t) 4254 4260 (face font-lock-function-name-face font-lock-multiline t fontified t) 4260 4263 (font-lock-multiline t fontified t) 4263 4267 (font-lock-multiline t face font-lock-function-name-face fontified t) 4267 4268 (font-lock-multiline t fontified t) 4268 4274 (face font-lock-variable-name-face font-lock-multiline t fontified t) 4274 4285 (font-lock-multiline t fontified t) 4285 4291 (font-lock-multiline t face font-lock-keyword-face fontified t) 4291 4298 (font-lock-multiline t fontified t) 4298 4332 (font-lock-multiline t fontified t) 4332 4333 (font-lock-multiline t fontified t) 4333 4334 (fontified t)) . 1) (undo-tree-id72 . -4334) (undo-tree-id73 . -4015) (undo-tree-id74 . -4160) (undo-tree-id75 . -2367) (undo-tree-id76 . -2367) (undo-tree-id77 . -1722) (t 26486 51770 78158 744000)) nil (26492 43055 512124 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 6743 . 6744) (nil fontified nil 1 . 6744) (1 . 6744)) nil (26493 62564 913191 0) 0 nil])
([nil nil ((6744 . 6745)) ((#("
" 0 1 (fontified t)) . 6744)) (26493 62566 607368 0) 0 nil])
([nil nil ((#("\"use server\"

import { z } from 'zod'
import { stripe } from '@/lib/stripe'
import { checkRole } from \"@/../utils/roles\"
import { clerkClient } from \"@clerk/nextjs/server\"
import { productCatalouge, images, orders, users } from '@/db/schema'
import { db } from \"@/db/index\"
import { eq } from 'drizzle-orm'
import { S3Client, PutObjectCommand } from \"@aws-sdk/client-s3\"
import { getSignedUrl } from \"@aws-sdk/s3-request-presigner\"
import crypto from \"crypto\"
import { Orders } from \"@/app/types\"
import { format, Order } from \"@/app/zod\"

// Types
interface ActionResponse<T> {
    success: boolean
    data?: T
    error?: string
}

interface FileUploadResponse {
    url: string
    id: number
}

// Configuration
const s3Config = {
    client: new S3Client({
        region: process.env.AWS_REGION!,
        credentials: {
            accessKeyId: process.env.AWS_ACCESS_KEY_ID!,
            secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY!,
        },
    }),
    bucket: process.env.AWS_BUCKET_NAME!,
    allowedTypes: [\"image/jpeg\", \"image/png\"] as const,
    maxSize: 1048576 * 10, // 10 MB
}

// Utility Functions
const generateFileName = (bytes = 32) => crypto.randomBytes(bytes).toString(\"hex\")

async function handleDatabaseError(error: unknown): Promise<never> {
    console.error('Database error:', error)
    throw new Error('Database operation failed')
}

// User Management Actions
export async function authManage(
    email: string | null = null,
    name: string | null = null,
    authId: string
): Promise<ActionResponse<void>> {
    try {
        await db.insert(users).values({
            email,
            authId,
            authName: name
        })
        return { success: true }
    } catch (error) {
        return {
            success: false,
            error: 'Failed to create user'
        }
    }
}

export async function setRole(
    formData: FormData
): Promise<ActionResponse<unknown>> {
    if (!checkRole(\"admin\")) {
        return {
            success: false,
            error: \"Not Authorized\"
        }
    }

    try {
        const res = await clerkClient.users.updateUser(
            formData.get('id') as string,
            {
                publicMetadata: { role: formData.get('role') },
            }
        )
        return {
            success: true,
            data: res.publicMetadata
        }
    } catch (error) {
        return {
            success: false,
            error: 'Failed to update user role'
        }
    }
}

// Order Management Actions
export async function orderStatus(
    orderID: number
): Promise<ActionResponse<string>> {
    try {
        const order = await db
            .select()
            .from(orders)
            .where(eq(orders.id, orderID))
        
        const parsedOrder = Order.parse(order)
        return {
            success: true,
            data: parsedOrder.orderStatus
        }
    } catch (error) {
        return {
            success: false,
            error: 'Failed to fetch order status'
        }
    }
}

export async function updateOrderStatus(
    orderID: number
): Promise<ActionResponse<void>> {
    try {
        const order = await db.query.orders.findFirst({
            where: eq(orders.id, orderID)
        })
        
        if (!order) {
            return {
                success: false,
                error: 'Order not found'
            }
        }

        const parsedOrder = Order.parse(order)
        const newStatus = parsedOrder.orderStatus === \"Your order has been shipped.\"
            ? \"Your order has been received.\"
            : \"Your order has been shipped.\"

        await db.update(orders)
            .set({ orderStatus: newStatus })
            .where(eq(orders.id, orderID))

        return { success: true }
    } catch (error) {
        return {
            success: false,
            error: 'Failed to update order status'
        }
    }
}

// Product Management Actions
export async function createProduct(
    formData: FormData
): Promise<ActionResponse<void>> {
    try {
        const info = format.parse({
            name: formData.get('name'),
            price: formData.get(\"price\"),
            imageLocation: formData.get('imageLocation'),
            category: formData.get('category'),
        })

        await db.insert(productCatalouge).values({
            name: info.name,
            imageLocation: info.imageLocation,
            price: info.price,
            category: info.category,
        })

        const product = await stripe.products.create({
            name: info.name,
        })

        await stripe.prices.create({
            currency: 'gbp',
            unit_amount: Math.round(info.price * 100),
            product: product.id,
        })

        return { success: true }
    } catch (error) {
        return {
            success: false,
            error: 'Failed to create product'
        }
    }
}

// File Upload Actions
export async function computeSHA256(buffer: ArrayBuffer): Promise<string> {
    const hashBuffer = await crypto.subtle.digest(\"SHA-256\", buffer)
    const hashArray = Array.from(new Uint8Array(hashBuffer))
    return hashArray.map(b => b.toString(16).padStart(2, \"0\")).join(\"\")
}

export async function getSignedURL({
    fileType,
    fileSize,
    checksum,
}: {
    fileType: string
    fileSize: number
    checksum: string
}): Promise<ActionResponse<FileUploadResponse>> {
    // Validation
    if (!s3Config.allowedTypes.includes(fileType as any)) {
        return {
            success: false,
            error: \"File type not allowed\"
        }
    }

    if (fileSize > s3Config.maxSize) {
        return {
            success: false,
            error: \"File size too large\"
        }
    }

    try {
        const fileName = generateFileName()
        const putObjectCommand = new PutObjectCommand({
            Bucket: s3Config.bucket,
            Key: fileName,
            ContentType: fileType,
            ContentLength: fileSize,
            ChecksumSHA256: checksum,
        })

        const url = await getSignedUrl(
            s3Config.client,
            putObjectCommand,
            { expiresIn: 60 }
        )

        const baseUrl = url.split(\"?\")[0]
        
        // Store file info in database
        await db.insert(images).values({
            url: baseUrl,
            width: 0,
            height: 0,
        })

        const results = await db.select().from(images)
        
        return {
            success: true,
            data: {
                url,
                id: results[0].id
            }
        }
    } catch (error) {
        return {
            success: false,
            error: 'Failed to generate signed URL'
        }
    }
}
" 0 12 (face font-lock-string-face fontified t) 12 13 (fontified t) 13 14 (fontified t) 14 20 (face font-lock-keyword-face fontified t) 20 27 (fontified t) 27 31 (face font-lock-keyword-face fontified t) 31 32 (fontified t) 32 37 (face font-lock-string-face fontified t) 37 38 (fontified t) 38 44 (face font-lock-keyword-face fontified t) 44 56 (fontified t) 56 60 (face font-lock-keyword-face fontified t) 60 61 (fontified t) 61 75 (face font-lock-string-face fontified t) 75 76 (fontified t) 76 82 (face font-lock-keyword-face fontified t) 82 97 (fontified t) 97 101 (face font-lock-keyword-face fontified t) 101 102 (fontified t) 102 120 (face font-lock-string-face fontified t) 120 121 (fontified t) 121 127 (face font-lock-keyword-face fontified t) 127 144 (fontified t) 144 148 (face font-lock-keyword-face fontified t) 148 149 (fontified t) 149 171 (face font-lock-string-face fontified t) 171 172 (fontified t) 172 178 (face font-lock-keyword-face fontified t) 178 223 (fontified t) 223 227 (face font-lock-keyword-face fontified t) 227 228 (fontified t) 228 241 (face font-lock-string-face fontified t) 241 242 (fontified t) 242 248 (face font-lock-keyword-face fontified t) 248 256 (fontified t) 256 260 (face font-lock-keyword-face fontified t) 260 261 (fontified t) 261 273 (face font-lock-string-face fontified t) 273 274 (fontified t) 274 280 (face font-lock-keyword-face fontified t) 280 288 (fontified t) 288 292 (face font-lock-keyword-face fontified t) 292 293 (fontified t) 293 306 (face font-lock-string-face fontified t) 306 307 (fontified t) 307 313 (face font-lock-keyword-face fontified t) 313 345 (fontified t) 345 349 (face font-lock-keyword-face fontified t) 349 350 (fontified t) 350 370 (face font-lock-string-face fontified t) 370 371 (fontified t) 371 377 (face font-lock-keyword-face fontified t) 377 395 (fontified t) 395 399 (face font-lock-keyword-face fontified t) 399 400 (fontified t) 400 431 (face font-lock-string-face fontified t) 431 432 (fontified t) 432 438 (face font-lock-keyword-face fontified t) 438 446 (fontified t) 446 450 (face font-lock-keyword-face fontified t) 450 451 (fontified t) 451 459 (face font-lock-string-face fontified t) 459 460 (fontified t) 460 466 (face font-lock-keyword-face fontified t) 466 478 (fontified t) 478 482 (face font-lock-keyword-face fontified t) 482 483 (fontified t) 483 496 (face font-lock-string-face fontified t) 496 497 (fontified t) 497 503 (face font-lock-keyword-face fontified t) 503 522 (fontified t) 522 526 (face font-lock-keyword-face fontified t) 526 527 (fontified t) 527 538 (face font-lock-string-face fontified t) 538 539 (fontified t) 539 540 (fontified t) 540 543 (face font-lock-comment-delimiter-face fontified t) 543 549 (face font-lock-comment-face fontified t) 549 558 (face font-lock-keyword-face fontified t) 558 559 (fontified t) 559 573 (face font-lock-type-face fontified t) 573 574 (fontified t) 574 575 (face font-lock-type-face fontified t) 575 577 (fontified t) 577 592 (font-lock-multiline t fontified t) 592 599 (font-lock-multiline t face typescript-primitive-face fontified t) 599 625 (font-lock-multiline t fontified t) 625 631 (font-lock-multiline t face typescript-primitive-face fontified t) 631 632 (font-lock-multiline t fontified t) 632 633 (font-lock-multiline t fontified t) 633 634 (fontified t) 634 635 (fontified t) 635 644 (face font-lock-keyword-face fontified t) 644 645 (fontified t) 645 663 (face font-lock-type-face fontified t) 663 664 (fontified t) 664 675 (font-lock-multiline t fontified t) 675 681 (font-lock-multiline t face typescript-primitive-face fontified t) 681 690 (font-lock-multiline t fontified t) 690 696 (font-lock-multiline t face typescript-primitive-face fontified t) 696 697 (font-lock-multiline t fontified t) 697 698 (font-lock-multiline t fontified t) 698 699 (fontified t) 699 700 (fontified t) 700 703 (face font-lock-comment-delimiter-face fontified t) 703 717 (face font-lock-comment-face fontified t) 717 722 (face font-lock-keyword-face fontified t) 722 723 (fontified t) 723 731 (face font-lock-variable-name-face fontified t) 731 734 (fontified t) 734 748 (font-lock-multiline t fontified t) 748 751 (font-lock-multiline t face font-lock-keyword-face fontified t) 751 752 (font-lock-multiline t fontified t) 752 760 (face font-lock-type-face font-lock-multiline t fontified t) 760 1029 (font-lock-multiline t fontified t) 1029 1041 (font-lock-multiline t face font-lock-string-face fontified t) 1041 1043 (font-lock-multiline t fontified t) 1043 1054 (font-lock-multiline t face font-lock-string-face fontified t) 1054 1056 (font-lock-multiline t fontified t) 1056 1058 (font-lock-multiline t face font-lock-keyword-face fontified t) 1058 1059 (font-lock-multiline t fontified t) 1059 1064 (font-lock-multiline t face font-lock-keyword-face fontified t) 1064 1093 (font-lock-multiline t fontified t) 1093 1096 (font-lock-multiline t face font-lock-comment-delimiter-face fontified t) 1096 1102 (font-lock-multiline t face font-lock-comment-face fontified t) 1102 1103 (font-lock-multiline t fontified t) 1103 1104 (fontified t) 1104 1105 (fontified t) 1105 1108 (face font-lock-comment-delimiter-face fontified t) 1108 1126 (face font-lock-comment-face fontified t) 1126 1131 (face font-lock-keyword-face fontified t) 1131 1132 (fontified t) 1132 1148 (face font-lock-variable-name-face fontified t) 1148 1164 (fontified t) 1164 1166 (face font-lock-keyword-face fontified t) 1166 1174 (fontified t) 1174 1185 (face font-lock-function-name-face fontified t) 1185 1193 (fontified t) 1193 1201 (face font-lock-function-name-face fontified t) 1201 1202 (fontified t) 1202 1207 (face font-lock-string-face fontified t) 1207 1209 (fontified t) 1209 1210 (fontified t) 1210 1215 (face font-lock-keyword-face fontified t) 1215 1216 (fontified t) 1216 1224 (face font-lock-keyword-face fontified t) 1224 1225 (fontified t) 1225 1244 (face font-lock-function-name-face fontified t) 1244 1245 (fontified t) 1245 1250 (face font-lock-variable-name-face fontified t) 1250 1252 (fontified t) 1252 1259 (face typescript-primitive-face fontified t) 1259 1262 (fontified t) 1262 1269 (face font-lock-type-face fontified t) 1269 1270 (fontified t) 1270 1275 (face typescript-primitive-face fontified t) 1275 1277 (fontified t) 1277 1283 (font-lock-multiline t fontified t) 1283 1290 (face font-lock-type-face font-lock-multiline t fontified t) 1290 1291 (font-lock-multiline t fontified t) 1291 1296 (face font-lock-function-name-face font-lock-multiline t fontified t) 1296 1297 (font-lock-multiline t fontified t) 1297 1314 (font-lock-multiline t face font-lock-string-face fontified t) 1314 1323 (font-lock-multiline t fontified t) 1323 1327 (font-lock-multiline t fontified t) 1327 1332 (font-lock-multiline t face font-lock-keyword-face fontified t) 1332 1333 (font-lock-multiline t fontified t) 1333 1336 (font-lock-multiline t face font-lock-keyword-face fontified t) 1336 1337 (font-lock-multiline t fontified t) 1337 1342 (face font-lock-type-face font-lock-multiline t fontified t) 1342 1343 (font-lock-multiline t fontified t) 1343 1370 (font-lock-multiline t face font-lock-string-face fontified t) 1370 1373 (font-lock-multiline t fontified t) 1373 1375 (fontified t) 1375 1378 (face font-lock-comment-delimiter-face fontified t) 1378 1402 (face font-lock-comment-face fontified t) 1402 1408 (face font-lock-keyword-face fontified t) 1408 1409 (fontified t) 1409 1414 (face font-lock-keyword-face fontified t) 1414 1415 (fontified t) 1415 1423 (font-lock-multiline t face font-lock-keyword-face fontified t) 1423 1424 (font-lock-multiline t fontified t) 1424 1434 (face font-lock-function-name-face font-lock-multiline t fontified t) 1434 1440 (font-lock-multiline t fontified t) 1440 1445 (face font-lock-variable-name-face font-lock-multiline t fontified t) 1445 1447 (font-lock-multiline t fontified t) 1447 1453 (font-lock-multiline t face typescript-primitive-face fontified t) 1453 1456 (font-lock-multiline t fontified t) 1456 1460 (font-lock-multiline t face font-lock-constant-face fontified t) 1460 1463 (font-lock-multiline t fontified t) 1463 1467 (font-lock-multiline t face font-lock-constant-face fontified t) 1467 1473 (font-lock-multiline t fontified t) 1473 1477 (face font-lock-variable-name-face font-lock-multiline t fontified t) 1477 1479 (font-lock-multiline t fontified t) 1479 1485 (font-lock-multiline t face typescript-primitive-face fontified t) 1485 1488 (font-lock-multiline t fontified t) 1488 1492 (font-lock-multiline t face font-lock-constant-face fontified t) 1492 1495 (font-lock-multiline t fontified t) 1495 1499 (font-lock-multiline t face font-lock-constant-face fontified t) 1499 1500 (font-lock-multiline t fontified t) 1500 1501 (font-lock-multiline t fontified t) 1501 1505 (font-lock-multiline t fontified t) 1505 1511 (face font-lock-variable-name-face font-lock-multiline t fontified t) 1511 1513 (font-lock-multiline t fontified t) 1513 1519 (font-lock-multiline t face typescript-primitive-face fontified t) 1519 1521 (font-lock-multiline t fontified t) 1521 1523 (fontified t) 1523 1530 (face font-lock-type-face fontified t) 1530 1531 (fontified t) 1531 1545 (face font-lock-type-face fontified t) 1545 1546 (fontified t) 1546 1550 (face typescript-primitive-face fontified t) 1550 1553 (fontified t) 1553 1559 (font-lock-multiline t fontified t) 1559 1562 (font-lock-multiline t face font-lock-keyword-face fontified t) 1562 1573 (font-lock-multiline t fontified t) 1573 1578 (font-lock-multiline t face font-lock-keyword-face fontified t) 1578 1582 (font-lock-multiline t fontified t) 1582 1588 (face font-lock-function-name-face font-lock-multiline t fontified t) 1588 1596 (font-lock-multiline t fontified t) 1596 1602 (face font-lock-function-name-face font-lock-multiline t fontified t) 1602 1690 (font-lock-multiline t fontified t) 1690 1696 (font-lock-multiline t face font-lock-keyword-face fontified t) 1696 1708 (font-lock-multiline t fontified t) 1708 1712 (font-lock-multiline t face font-lock-constant-face fontified t) 1712 1721 (font-lock-multiline t fontified t) 1721 1726 (font-lock-multiline t face font-lock-keyword-face fontified t) 1726 1745 (font-lock-multiline t fontified t) 1745 1751 (font-lock-multiline t face font-lock-keyword-face fontified t) 1751 1775 (font-lock-multiline t fontified t) 1775 1780 (font-lock-multiline t face font-lock-constant-face fontified t) 1780 1801 (font-lock-multiline t fontified t) 1801 1824 (font-lock-multiline t face font-lock-string-face fontified t) 1824 1842 (font-lock-multiline t fontified t) 1842 1843 (fontified t) 1843 1844 (fontified t) 1844 1850 (face font-lock-keyword-face fontified t) 1850 1851 (fontified t) 1851 1856 (face font-lock-keyword-face fontified t) 1856 1857 (fontified t) 1857 1865 (font-lock-multiline t face font-lock-keyword-face fontified t) 1865 1866 (font-lock-multiline t fontified t) 1866 1873 (face font-lock-function-name-face font-lock-multiline t fontified t) 1873 1879 (font-lock-multiline t fontified t) 1879 1887 (face font-lock-variable-name-face font-lock-multiline t fontified t) 1887 1889 (font-lock-multiline t fontified t) 1889 1897 (font-lock-multiline t face font-lock-type-face fontified t) 1897 1899 (font-lock-multiline t fontified t) 1899 1901 (fontified t) 1901 1908 (face font-lock-type-face fontified t) 1908 1909 (fontified t) 1909 1923 (face font-lock-type-face fontified t) 1923 1924 (fontified t) 1924 1931 (face typescript-primitive-face fontified t) 1931 1934 (fontified t) 1934 1940 (font-lock-multiline t fontified t) 1940 1942 (font-lock-multiline t face font-lock-keyword-face fontified t) 1942 1945 (font-lock-multiline t fontified t) 1945 1954 (face font-lock-function-name-face font-lock-multiline t fontified t) 1954 1955 (font-lock-multiline t fontified t) 1955 1962 (font-lock-multiline t face font-lock-string-face fontified t) 1962 1975 (font-lock-multiline t fontified t) 1975 1981 (font-lock-multiline t face font-lock-keyword-face fontified t) 1981 2005 (font-lock-multiline t fontified t) 2005 2010 (font-lock-multiline t face font-lock-constant-face fontified t) 2010 2031 (font-lock-multiline t fontified t) 2031 2047 (font-lock-multiline t face font-lock-string-face fontified t) 2047 2069 (font-lock-multiline t fontified t) 2069 2072 (font-lock-multiline t face font-lock-keyword-face fontified t) 2072 2083 (font-lock-multiline t fontified t) 2083 2088 (font-lock-multiline t face font-lock-keyword-face fontified t) 2088 2089 (font-lock-multiline t fontified t) 2089 2092 (face font-lock-variable-name-face font-lock-multiline t fontified t) 2092 2095 (font-lock-multiline t fontified t) 2095 2100 (font-lock-multiline t face font-lock-keyword-face fontified t) 2100 2119 (font-lock-multiline t fontified t) 2119 2129 (face font-lock-function-name-face font-lock-multiline t fontified t) 2129 2152 (font-lock-multiline t fontified t) 2152 2155 (font-lock-multiline t face font-lock-function-name-face fontified t) 2155 2156 (font-lock-multiline t fontified t) 2156 2160 (font-lock-multiline t face font-lock-string-face fontified t) 2160 2162 (font-lock-multiline t fontified t) 2162 2164 (font-lock-multiline t face font-lock-keyword-face fontified t) 2164 2165 (font-lock-multiline t fontified t) 2165 2171 (font-lock-multiline t face typescript-primitive-face fontified t) 2171 2236 (font-lock-multiline t fontified t) 2236 2239 (font-lock-multiline t face font-lock-function-name-face fontified t) 2239 2240 (font-lock-multiline t fontified t) 2240 2246 (font-lock-multiline t face font-lock-string-face fontified t) 2246 2283 (font-lock-multiline t fontified t) 2283 2289 (font-lock-multiline t face font-lock-keyword-face fontified t) 2289 2313 (font-lock-multiline t fontified t) 2313 2317 (font-lock-multiline t face font-lock-constant-face fontified t) 2317 2372 (font-lock-multiline t fontified t) 2372 2377 (font-lock-multiline t face font-lock-keyword-face fontified t) 2377 2396 (font-lock-multiline t fontified t) 2396 2402 (font-lock-multiline t face font-lock-keyword-face fontified t) 2402 2426 (font-lock-multiline t fontified t) 2426 2431 (font-lock-multiline t face font-lock-constant-face fontified t) 2431 2452 (font-lock-multiline t fontified t) 2452 2480 (font-lock-multiline t face font-lock-string-face fontified t) 2480 2498 (font-lock-multiline t fontified t) 2498 2500 (fontified t) 2500 2503 (face font-lock-comment-delimiter-face fontified t) 2503 2528 (face font-lock-comment-face fontified t) 2528 2534 (face font-lock-keyword-face fontified t) 2534 2535 (fontified t) 2535 2540 (face font-lock-keyword-face fontified t) 2540 2541 (fontified t) 2541 2549 (font-lock-multiline t face font-lock-keyword-face fontified t) 2549 2550 (font-lock-multiline t fontified t) 2550 2561 (face font-lock-function-name-face font-lock-multiline t fontified t) 2561 2567 (font-lock-multiline t fontified t) 2567 2574 (face font-lock-variable-name-face font-lock-multiline t fontified t) 2574 2576 (font-lock-multiline t fontified t) 2576 2582 (font-lock-multiline t face typescript-primitive-face fontified t) 2582 2584 (font-lock-multiline t fontified t) 2584 2586 (fontified t) 2586 2593 (face font-lock-type-face fontified t) 2593 2594 (fontified t) 2594 2608 (face font-lock-type-face fontified t) 2608 2609 (fontified t) 2609 2615 (face typescript-primitive-face fontified t) 2615 2618 (fontified t) 2618 2624 (font-lock-multiline t fontified t) 2624 2627 (font-lock-multiline t face font-lock-keyword-face fontified t) 2627 2638 (font-lock-multiline t fontified t) 2638 2643 (font-lock-multiline t face font-lock-keyword-face fontified t) 2643 2644 (font-lock-multiline t fontified t) 2644 2649 (face font-lock-variable-name-face font-lock-multiline t fontified t) 2649 2652 (font-lock-multiline t fontified t) 2652 2657 (font-lock-multiline t face font-lock-keyword-face fontified t) 2657 2674 (font-lock-multiline t fontified t) 2674 2680 (face font-lock-function-name-face font-lock-multiline t fontified t) 2680 2696 (font-lock-multiline t fontified t) 2696 2700 (font-lock-multiline t face font-lock-function-name-face fontified t) 2700 2710 (font-lock-multiline t fontified t) 2710 2722 (font-lock-multiline t fontified t) 2722 2727 (face font-lock-function-name-face font-lock-multiline t fontified t) 2727 2728 (font-lock-multiline t fontified t) 2728 2730 (face font-lock-function-name-face font-lock-multiline t fontified t) 2730 2769 (font-lock-multiline t fontified t) 2769 2774 (font-lock-multiline t face font-lock-keyword-face fontified t) 2774 2775 (font-lock-multiline t fontified t) 2775 2786 (face font-lock-variable-name-face font-lock-multiline t fontified t) 2786 2795 (font-lock-multiline t fontified t) 2795 2800 (face font-lock-function-name-face font-lock-multiline t fontified t) 2800 2816 (font-lock-multiline t fontified t) 2816 2822 (font-lock-multiline t face font-lock-keyword-face fontified t) 2822 2823 (font-lock-multiline t fontified t) 2823 2846 (font-lock-multiline t fontified t) 2846 2850 (font-lock-multiline t face font-lock-constant-face fontified t) 2850 2910 (font-lock-multiline t fontified t) 2910 2915 (font-lock-multiline t face font-lock-keyword-face fontified t) 2915 2934 (font-lock-multiline t fontified t) 2934 2940 (font-lock-multiline t face font-lock-keyword-face fontified t) 2940 2964 (font-lock-multiline t fontified t) 2964 2969 (font-lock-multiline t face font-lock-constant-face fontified t) 2969 2990 (font-lock-multiline t fontified t) 2990 3001 (font-lock-multiline t face font-lock-string-face fontified t) 3001 3020 (font-lock-multiline t face font-lock-string-face fontified t) 3020 3021 (font-lock-multiline t fontified t) 3021 3038 (font-lock-multiline t fontified t) 3038 3039 (fontified t) 3039 3040 (fontified t) 3040 3046 (face font-lock-keyword-face fontified t) 3046 3047 (fontified t) 3047 3052 (face font-lock-keyword-face fontified t) 3052 3053 (fontified t) 3053 3061 (font-lock-multiline t face font-lock-keyword-face fontified t) 3061 3062 (font-lock-multiline t fontified t) 3062 3079 (face font-lock-function-name-face font-lock-multiline t fontified t) 3079 3085 (font-lock-multiline t fontified t) 3085 3092 (face font-lock-variable-name-face font-lock-multiline t fontified t) 3092 3094 (font-lock-multiline t fontified t) 3094 3100 (font-lock-multiline t face typescript-primitive-face fontified t) 3100 3102 (font-lock-multiline t fontified t) 3102 3104 (fontified t) 3104 3111 (face font-lock-type-face fontified t) 3111 3112 (fontified t) 3112 3126 (face font-lock-type-face fontified t) 3126 3127 (fontified t) 3127 3131 (face typescript-primitive-face fontified t) 3131 3134 (fontified t) 3134 3140 (font-lock-multiline t fontified t) 3140 3143 (font-lock-multiline t face font-lock-keyword-face fontified t) 3143 3154 (font-lock-multiline t fontified t) 3154 3159 (font-lock-multiline t face font-lock-keyword-face fontified t) 3159 3160 (font-lock-multiline t fontified t) 3160 3165 (face font-lock-variable-name-face font-lock-multiline t fontified t) 3165 3168 (font-lock-multiline t fontified t) 3168 3173 (font-lock-multiline t face font-lock-keyword-face fontified t) 3173 3190 (font-lock-multiline t fontified t) 3190 3199 (face font-lock-function-name-face font-lock-multiline t fontified t) 3199 3221 (font-lock-multiline t fontified t) 3221 3223 (face font-lock-function-name-face font-lock-multiline t fontified t) 3223 3272 (font-lock-multiline t fontified t) 3272 3274 (font-lock-multiline t face font-lock-keyword-face fontified t) 3274 3298 (font-lock-multiline t fontified t) 3298 3304 (font-lock-multiline t face font-lock-keyword-face fontified t) 3304 3332 (font-lock-multiline t fontified t) 3332 3337 (font-lock-multiline t face font-lock-constant-face fontified t) 3337 3343 (font-lock-multiline t fontified t) 3343 3362 (font-lock-multiline t fontified t) 3362 3379 (font-lock-multiline t face font-lock-string-face fontified t) 3379 3413 (font-lock-multiline t fontified t) 3413 3418 (font-lock-multiline t face font-lock-keyword-face fontified t) 3418 3419 (font-lock-multiline t fontified t) 3419 3430 (face font-lock-variable-name-face font-lock-multiline t fontified t) 3430 3439 (font-lock-multiline t fontified t) 3439 3444 (face font-lock-function-name-face font-lock-multiline t fontified t) 3444 3460 (font-lock-multiline t fontified t) 3460 3465 (font-lock-multiline t face font-lock-keyword-face fontified t) 3465 3466 (font-lock-multiline t fontified t) 3466 3475 (face font-lock-variable-name-face font-lock-multiline t fontified t) 3475 3506 (font-lock-multiline t fontified t) 3506 3536 (font-lock-multiline t face font-lock-string-face fontified t) 3536 3551 (font-lock-multiline t fontified t) 3551 3582 (font-lock-multiline t face font-lock-string-face fontified t) 3582 3597 (font-lock-multiline t fontified t) 3597 3627 (font-lock-multiline t face font-lock-string-face fontified t) 3627 3637 (font-lock-multiline t fontified t) 3637 3642 (font-lock-multiline t face font-lock-keyword-face fontified t) 3642 3646 (font-lock-multiline t fontified t) 3646 3652 (face font-lock-function-name-face font-lock-multiline t fontified t) 3652 3674 (font-lock-multiline t fontified t) 3674 3677 (font-lock-multiline t face font-lock-function-name-face fontified t) 3677 3719 (font-lock-multiline t fontified t) 3719 3724 (face font-lock-function-name-face font-lock-multiline t fontified t) 3724 3725 (font-lock-multiline t fontified t) 3725 3727 (face font-lock-function-name-face font-lock-multiline t fontified t) 3727 3758 (font-lock-multiline t fontified t) 3758 3764 (font-lock-multiline t face font-lock-keyword-face fontified t) 3764 3776 (font-lock-multiline t fontified t) 3776 3780 (font-lock-multiline t face font-lock-constant-face fontified t) 3780 3789 (font-lock-multiline t fontified t) 3789 3794 (font-lock-multiline t face font-lock-keyword-face fontified t) 3794 3813 (font-lock-multiline t fontified t) 3813 3819 (font-lock-multiline t face font-lock-keyword-face fontified t) 3819 3843 (font-lock-multiline t fontified t) 3843 3848 (font-lock-multiline t face font-lock-constant-face fontified t) 3848 3869 (font-lock-multiline t fontified t) 3869 3900 (font-lock-multiline t face font-lock-string-face fontified t) 3900 3918 (font-lock-multiline t fontified t) 3918 3919 (fontified t) 3920 3923 (face font-lock-comment-delimiter-face) 3923 3950 (face font-lock-comment-face) 3950 3956 (face font-lock-keyword-face) 3957 3962 (face font-lock-keyword-face) 3963 3971 (font-lock-multiline t face font-lock-keyword-face) 3971 3972 (font-lock-multiline t) 3972 3985 (face font-lock-function-name-face font-lock-multiline t) 3985 3991 (font-lock-multiline t) 3991 3999 (face font-lock-variable-name-face font-lock-multiline t) 3999 4001 (font-lock-multiline t) 4001 4009 (font-lock-multiline t face font-lock-type-face) 4009 4011 (font-lock-multiline t) 4013 4020 (face font-lock-type-face) 4021 4035 (face font-lock-type-face) 4036 4040 (face typescript-primitive-face) 4043 4049 (font-lock-multiline t) 4049 4052 (font-lock-multiline t face font-lock-keyword-face) 4052 4063 (font-lock-multiline t) 4063 4068 (font-lock-multiline t face font-lock-keyword-face) 4068 4069 (font-lock-multiline t) 4069 4073 (face font-lock-variable-name-face font-lock-multiline t) 4073 4083 (font-lock-multiline t) 4083 4088 (face font-lock-function-name-face font-lock-multiline t) 4088 4118 (font-lock-multiline t) 4118 4121 (font-lock-multiline t face font-lock-function-name-face) 4121 4122 (font-lock-multiline t) 4122 4128 (font-lock-multiline t face font-lock-string-face) 4128 4159 (font-lock-multiline t) 4159 4162 (font-lock-multiline t face font-lock-function-name-face) 4162 4163 (font-lock-multiline t) 4163 4170 (font-lock-multiline t face font-lock-string-face) 4170 4209 (font-lock-multiline t) 4209 4212 (font-lock-multiline t face font-lock-function-name-face) 4212 4213 (font-lock-multiline t) 4213 4228 (font-lock-multiline t face font-lock-string-face) 4228 4262 (font-lock-multiline t) 4262 4265 (font-lock-multiline t face font-lock-function-name-face) 4265 4266 (font-lock-multiline t) 4266 4276 (font-lock-multiline t face font-lock-string-face) 4276 4299 (font-lock-multiline t) 4299 4304 (font-lock-multiline t face font-lock-keyword-face) 4304 4308 (font-lock-multiline t) 4308 4314 (face font-lock-function-name-face font-lock-multiline t) 4314 4333 (font-lock-multiline t) 4333 4339 (face font-lock-function-name-face font-lock-multiline t) 4339 4506 (font-lock-multiline t) 4506 4511 (font-lock-multiline t face font-lock-keyword-face) 4511 4512 (font-lock-multiline t) 4512 4519 (face font-lock-variable-name-face font-lock-multiline t) 4519 4521 (font-lock-multiline t) 4521 4522 (font-lock-multiline t) 4522 4527 (font-lock-multiline t face font-lock-keyword-face) 4527 4539 (font-lock-multiline t) 4539 4544 (font-lock-multiline t) 4544 4550 (face font-lock-function-name-face font-lock-multiline t) 4550 4553 (font-lock-multiline t) 4553 4602 (font-lock-multiline t) 4602 4607 (font-lock-multiline t face font-lock-keyword-face) 4607 4622 (font-lock-multiline t) 4622 4628 (face font-lock-function-name-face font-lock-multiline t) 4628 4653 (font-lock-multiline t) 4653 4658 (font-lock-multiline t face font-lock-string-face) 4658 4685 (font-lock-multiline t) 4685 4689 (font-lock-multiline t face font-lock-type-face) 4689 4690 (font-lock-multiline t) 4690 4695 (face font-lock-function-name-face font-lock-multiline t) 4695 4768 (font-lock-multiline t) 4768 4774 (font-lock-multiline t face font-lock-keyword-face) 4774 4786 (font-lock-multiline t) 4786 4790 (font-lock-multiline t face font-lock-constant-face) 4790 4799 (font-lock-multiline t) 4799 4804 (font-lock-multiline t face font-lock-keyword-face) 4804 4823 (font-lock-multiline t) 4823 4829 (font-lock-multiline t face font-lock-keyword-face) 4829 4853 (font-lock-multiline t) 4853 4858 (font-lock-multiline t face font-lock-constant-face) 4858 4879 (font-lock-multiline t) 4879 4905 (font-lock-multiline t face font-lock-string-face) 4905 4922 (font-lock-multiline t) 4922 4923 (font-lock-multiline t) 4925 4928 (face font-lock-comment-delimiter-face) 4928 4948 (face font-lock-comment-face) 4948 4954 (face font-lock-keyword-face) 4955 4960 (face font-lock-keyword-face) 4961 4969 (face font-lock-keyword-face) 4970 4983 (face font-lock-function-name-face) 4984 4990 (face font-lock-variable-name-face) 4992 5003 (face font-lock-type-face) 5006 5013 (face font-lock-type-face) 5014 5020 (face typescript-primitive-face) 5022 5024 (font-lock-multiline t) 5024 5028 (font-lock-multiline t) 5028 5033 (font-lock-multiline t face font-lock-keyword-face) 5033 5034 (font-lock-multiline t) 5034 5044 (face font-lock-variable-name-face font-lock-multiline t) 5044 5047 (font-lock-multiline t) 5047 5052 (font-lock-multiline t face font-lock-keyword-face) 5052 5067 (font-lock-multiline t) 5067 5073 (face font-lock-function-name-face font-lock-multiline t) 5073 5074 (font-lock-multiline t) 5074 5083 (font-lock-multiline t face font-lock-string-face) 5083 5093 (font-lock-multiline t) 5093 5097 (font-lock-multiline t) 5097 5102 (font-lock-multiline t face font-lock-keyword-face) 5102 5103 (font-lock-multiline t) 5103 5112 (face font-lock-variable-name-face font-lock-multiline t) 5112 5121 (font-lock-multiline t) 5121 5125 (font-lock-multiline t face font-lock-function-name-face) 5125 5126 (font-lock-multiline t) 5126 5129 (font-lock-multiline t face font-lock-keyword-face) 5129 5130 (font-lock-multiline t) 5130 5140 (face font-lock-type-face font-lock-multiline t) 5140 5154 (font-lock-multiline t) 5154 5158 (font-lock-multiline t) 5158 5164 (font-lock-multiline t face font-lock-keyword-face) 5164 5175 (font-lock-multiline t) 5175 5178 (face font-lock-function-name-face font-lock-multiline t) 5178 5181 (font-lock-multiline t) 5181 5183 (face font-lock-keyword-face font-lock-multiline t) 5183 5186 (font-lock-multiline t) 5186 5194 (face font-lock-function-name-face font-lock-multiline t) 5194 5199 (font-lock-multiline t) 5199 5207 (face font-lock-function-name-face font-lock-multiline t) 5207 5211 (font-lock-multiline t) 5211 5214 (font-lock-multiline t face font-lock-string-face) 5214 5217 (font-lock-multiline t) 5217 5221 (face font-lock-function-name-face font-lock-multiline t) 5221 5222 (font-lock-multiline t) 5222 5224 (font-lock-multiline t face font-lock-string-face) 5224 5226 (font-lock-multiline t) 5226 5227 (font-lock-multiline t) 5229 5235 (face font-lock-keyword-face fontified t) 5235 5236 (fontified t) 5236 5241 (face font-lock-keyword-face fontified t) 5241 5242 (fontified t) 5242 5250 (face font-lock-keyword-face fontified t) 5250 5251 (fontified t) 5251 5263 (face font-lock-function-name-face font-lock-multiline t fontified t) 5263 5264 (font-lock-multiline t fontified t) 5264 5266 (font-lock-multiline t fontified t) 5266 5270 (font-lock-multiline t fontified t) 5270 5278 (face font-lock-variable-name-face font-lock-multiline t fontified t) 5278 5280 (font-lock-multiline t fontified t) 5280 5284 (font-lock-multiline t fontified t) 5284 5292 (face font-lock-variable-name-face font-lock-multiline t fontified t) 5292 5294 (font-lock-multiline t fontified t) 5294 5298 (font-lock-multiline t fontified t) 5298 5306 (face font-lock-variable-name-face font-lock-multiline t fontified t) 5306 5308 (font-lock-multiline t fontified t) 5308 5309 (font-lock-multiline t fontified t) 5309 5311 (font-lock-multiline t fontified t) 5311 5313 (font-lock-multiline t fontified t) 5313 5317 (font-lock-multiline t fontified t) 5317 5325 (face font-lock-variable-name-face font-lock-multiline t fontified t) 5325 5327 (font-lock-multiline t fontified t) 5327 5333 (font-lock-multiline t face typescript-primitive-face fontified t) 5333 5334 (font-lock-multiline t fontified t) 5334 5348 (font-lock-multiline t fontified t) 5348 5354 (font-lock-multiline t face typescript-primitive-face fontified t) 5354 5355 (font-lock-multiline t fontified t) 5355 5369 (font-lock-multiline t fontified t) 5369 5375 (font-lock-multiline t face typescript-primitive-face fontified t) 5375 5376 (font-lock-multiline t fontified t) 5376 5377 (font-lock-multiline t fontified t) 5377 5378 (font-lock-multiline t fontified t) 5378 5380 (fontified t) 5380 5387 (face font-lock-type-face fontified t) 5387 5388 (fontified t) 5388 5402 (face font-lock-type-face fontified t) 5402 5403 (fontified t) 5403 5421 (face font-lock-type-face fontified t) 5421 5424 (fontified t) 5424 5426 (font-lock-multiline t fontified t) 5426 5430 (font-lock-multiline t fontified t) 5430 5433 (font-lock-multiline t face font-lock-comment-delimiter-face fontified t) 5433 5444 (font-lock-multiline t face font-lock-comment-face fontified t) 5444 5448 (font-lock-multiline t fontified t) 5448 5450 (font-lock-multiline t face font-lock-keyword-face fontified t) 5450 5475 (font-lock-multiline t fontified t) 5475 5483 (face font-lock-function-name-face font-lock-multiline t fontified t) 5483 5493 (font-lock-multiline t fontified t) 5493 5495 (font-lock-multiline t face font-lock-keyword-face fontified t) 5495 5496 (font-lock-multiline t fontified t) 5496 5499 (font-lock-multiline t face typescript-primitive-face fontified t) 5499 5502 (font-lock-multiline t fontified t) 5502 5504 (font-lock-multiline t fontified t) 5504 5512 (font-lock-multiline t fontified t) 5512 5518 (font-lock-multiline t face font-lock-keyword-face fontified t) 5518 5519 (font-lock-multiline t fontified t) 5519 5521 (font-lock-multiline t fontified t) 5521 5542 (font-lock-multiline t fontified t) 5542 5547 (font-lock-multiline t face font-lock-constant-face fontified t) 5547 5549 (font-lock-multiline t fontified t) 5549 5568 (font-lock-multiline t fontified t) 5568 5591 (font-lock-multiline t face font-lock-string-face fontified t) 5591 5592 (font-lock-multiline t fontified t) 5592 5601 (font-lock-multiline t fontified t) 5601 5602 (font-lock-multiline t fontified t) 5602 5607 (font-lock-multiline t fontified t) 5607 5608 (font-lock-multiline t fontified t) 5608 5609 (font-lock-multiline t fontified t) 5609 5613 (font-lock-multiline t fontified t) 5613 5615 (font-lock-multiline t face font-lock-keyword-face fontified t) 5615 5646 (font-lock-multiline t fontified t) 5646 5648 (font-lock-multiline t fontified t) 5648 5656 (font-lock-multiline t fontified t) 5656 5662 (font-lock-multiline t face font-lock-keyword-face fontified t) 5662 5663 (font-lock-multiline t fontified t) 5663 5665 (font-lock-multiline t fontified t) 5665 5686 (font-lock-multiline t fontified t) 5686 5691 (font-lock-multiline t face font-lock-constant-face fontified t) 5691 5712 (font-lock-multiline t fontified t) 5712 5733 (font-lock-multiline t face font-lock-string-face fontified t) 5733 5743 (font-lock-multiline t fontified t) 5743 5749 (font-lock-multiline t fontified t) 5749 5755 (font-lock-multiline t fontified t) 5755 5758 (font-lock-multiline t face font-lock-keyword-face fontified t) 5758 5759 (font-lock-multiline t fontified t) 5759 5769 (font-lock-multiline t fontified t) 5769 5774 (font-lock-multiline t face font-lock-keyword-face fontified t) 5774 5775 (font-lock-multiline t fontified t) 5775 5783 (face font-lock-variable-name-face font-lock-multiline t fontified t) 5783 5786 (font-lock-multiline t fontified t) 5786 5802 (face font-lock-function-name-face font-lock-multiline t fontified t) 5802 5813 (font-lock-multiline t fontified t) 5813 5818 (font-lock-multiline t face font-lock-keyword-face fontified t) 5818 5819 (font-lock-multiline t fontified t) 5819 5835 (face font-lock-variable-name-face font-lock-multiline t fontified t) 5835 5838 (font-lock-multiline t fontified t) 5838 5841 (font-lock-multiline t face font-lock-keyword-face fontified t) 5841 5842 (font-lock-multiline t fontified t) 5842 5858 (face font-lock-type-face font-lock-multiline t fontified t) 5858 6055 (font-lock-multiline t fontified t) 6055 6060 (font-lock-multiline t face font-lock-keyword-face fontified t) 6060 6061 (font-lock-multiline t fontified t) 6061 6064 (face font-lock-variable-name-face font-lock-multiline t fontified t) 6064 6067 (font-lock-multiline t fontified t) 6067 6072 (font-lock-multiline t face font-lock-keyword-face fontified t) 6072 6073 (font-lock-multiline t fontified t) 6073 6085 (face font-lock-function-name-face font-lock-multiline t fontified t) 6085 6195 (font-lock-multiline t fontified t) 6195 6200 (font-lock-multiline t face font-lock-keyword-face fontified t) 6200 6201 (font-lock-multiline t fontified t) 6201 6208 (face font-lock-variable-name-face font-lock-multiline t fontified t) 6208 6215 (font-lock-multiline t fontified t) 6215 6220 (face font-lock-function-name-face font-lock-multiline t fontified t) 6220 6221 (font-lock-multiline t fontified t) 6221 6224 (font-lock-multiline t face font-lock-string-face fontified t) 6224 6246 (font-lock-multiline t fontified t) 6246 6249 (font-lock-multiline t face font-lock-comment-delimiter-face fontified t) 6249 6277 (font-lock-multiline t face font-lock-comment-face fontified t) 6277 6285 (font-lock-multiline t fontified t) 6285 6290 (font-lock-multiline t face font-lock-keyword-face fontified t) 6290 6294 (font-lock-multiline t fontified t) 6294 6300 (face font-lock-function-name-face font-lock-multiline t fontified t) 6300 6309 (font-lock-multiline t fontified t) 6309 6315 (face font-lock-function-name-face font-lock-multiline t fontified t) 6315 6409 (font-lock-multiline t fontified t) 6409 6414 (font-lock-multiline t face font-lock-keyword-face fontified t) 6414 6415 (font-lock-multiline t fontified t) 6415 6422 (face font-lock-variable-name-face font-lock-multiline t fontified t) 6422 6424 (font-lock-multiline t fontified t) 6424 6425 (font-lock-multiline t fontified t) 6425 6430 (font-lock-multiline t face font-lock-keyword-face fontified t) 6430 6434 (font-lock-multiline t fontified t) 6434 6440 (face font-lock-function-name-face font-lock-multiline t fontified t) 6440 6443 (font-lock-multiline t fontified t) 6443 6447 (font-lock-multiline t face font-lock-function-name-face fontified t) 6447 6448 (font-lock-multiline t fontified t) 6448 6454 (face font-lock-variable-name-face font-lock-multiline t fontified t) 6454 6473 (font-lock-multiline t fontified t) 6473 6479 (font-lock-multiline t face font-lock-keyword-face fontified t) 6479 6482 (font-lock-multiline t fontified t) 6482 6503 (font-lock-multiline t fontified t) 6503 6507 (font-lock-multiline t face font-lock-constant-face fontified t) 6507 6613 (font-lock-multiline t fontified t) 6613 6614 (font-lock-multiline t fontified t) 6614 6619 (font-lock-multiline t face font-lock-keyword-face fontified t) 6619 6628 (font-lock-multiline t fontified t) 6628 6638 (font-lock-multiline t fontified t) 6638 6644 (font-lock-multiline t face font-lock-keyword-face fontified t) 6644 6668 (font-lock-multiline t fontified t) 6668 6673 (font-lock-multiline t face font-lock-constant-face fontified t) 6673 6694 (font-lock-multiline t fontified t) 6694 6725 (font-lock-multiline t face font-lock-string-face fontified t) 6725 6726 (font-lock-multiline t fontified t) 6726 6741 (font-lock-multiline t fontified t) 6741 6742 (font-lock-multiline t fontified t) 6742 6743 (font-lock-multiline t fontified t rear-nonsticky t) 6743 6744 (fontified t)) . 1) (undo-tree-id129 . -5648) (undo-tree-id130 . -6743) (undo-tree-id131 . -5229) (undo-tree-id132 . -6742) (undo-tree-id133 . -6743) (undo-tree-id134 . -5229) (undo-tree-id135 . -6726) (undo-tree-id136 . -5229) (undo-tree-id137 . -5665) (undo-tree-id138 . -5229) (undo-tree-id139 . -5648) (undo-tree-id140 . -5229) (undo-tree-id141 . -5648)) ((1 . 6745)) (26493 62567 106323 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 2923 . 2924) (nil fontified nil 1 . 13) (nil fontified nil 13 . 14) (nil fontified nil 14 . 20) (nil fontified nil 20 . 27) (nil fontified nil 27 . 31) (nil fontified nil 31 . 32) (nil fontified nil 32 . 37) (nil fontified nil 37 . 38) (nil fontified nil 38 . 44) (nil fontified nil 44 . 56) (nil fontified nil 56 . 60) (nil fontified nil 60 . 61) (nil fontified nil 61 . 75) (nil fontified nil 75 . 76) (nil fontified nil 76 . 82) (nil fontified nil 82 . 97) (nil fontified nil 97 . 101) (nil fontified nil 101 . 102) (nil fontified nil 102 . 120) (nil fontified nil 120 . 122) (nil fontified nil 122 . 128) (nil fontified nil 128 . 145) (nil fontified nil 145 . 149) (nil fontified nil 149 . 150) (nil fontified nil 150 . 172) (nil fontified nil 172 . 174) (nil fontified nil 174 . 180) (nil fontified nil 180 . 225) (nil fontified nil 225 . 229) (nil fontified nil 229 . 230) (nil fontified nil 230 . 243) (nil fontified nil 243 . 246) (nil fontified nil 246 . 252) (nil fontified nil 252 . 261) (nil fontified nil 261 . 265) (nil fontified nil 265 . 266) (nil fontified nil 266 . 278) (nil fontified nil 278 . 280) (nil fontified nil 280 . 286) (nil fontified nil 286 . 294) (nil fontified nil 294 . 298) (nil fontified nil 298 . 299) (nil fontified nil 299 . 312) (nil fontified nil 312 . 314) (nil fontified nil 314 . 320) (nil fontified nil 320 . 352) (nil fontified nil 352 . 356) (nil fontified nil 356 . 357) (nil fontified nil 357 . 377) (nil fontified nil 377 . 378) (nil fontified nil 378 . 384) (nil fontified nil 384 . 402) (nil fontified nil 402 . 406) (nil fontified nil 406 . 407) (nil fontified nil 407 . 438) (nil fontified nil 438 . 439) (nil fontified nil 439 . 445) (nil fontified nil 445 . 453) (nil fontified nil 453 . 457) (nil fontified nil 457 . 458) (nil fontified nil 458 . 466) (nil fontified nil 466 . 467) (nil fontified nil 467 . 473) (nil fontified nil 473 . 485) (nil fontified nil 485 . 489) (nil fontified nil 489 . 490) (nil fontified nil 490 . 503) (nil fontified nil 503 . 504) (nil fontified nil 504 . 510) (nil fontified nil 510 . 529) (nil fontified nil 529 . 533) (nil fontified nil 533 . 534) (nil fontified nil 534 . 545) (nil fontified nil 545 . 546) (nil fontified nil 546 . 547) (nil fontified nil 547 . 550) (nil fontified nil 550 . 582) (nil fontified nil 582 . 583) (nil fontified nil 583 . 584) (nil fontified nil 584 . 589) (nil fontified nil 589 . 590) (nil fontified nil 590 . 598) (nil fontified nil 598 . 601) (nil fontified nil 601 . 604) (nil fontified nil 604 . 605) (nil fontified nil 605 . 613) (nil fontified nil 613 . 614) (nil fontified nil 614 . 786) (nil fontified nil 786 . 794) (nil fontified nil 794 . 797) (nil fontified nil 797 . 802) (nil fontified nil 802 . 803) (nil fontified nil 803 . 819) (nil fontified nil 819 . 828) (nil fontified nil 828 . 840) (nil fontified nil 840 . 846) (nil fontified nil 846 . 857) (nil fontified nil 857 . 862) (nil fontified nil 862 . 867) (nil fontified nil 867 . 868) (nil fontified nil 868 . 879) (nil fontified nil 879 . 895) (nil fontified nil 895 . 898) (nil fontified nil 898 . 904) (nil fontified nil 904 . 905) (nil fontified nil 905 . 910) (nil fontified nil 910 . 911) (nil fontified nil 911 . 927) (nil fontified nil 927 . 943) (nil fontified nil 943 . 945) (nil fontified nil 945 . 953) (nil fontified nil 953 . 964) (nil fontified nil 964 . 972) (nil fontified nil 972 . 980) (nil fontified nil 980 . 981) (nil fontified nil 981 . 986) (nil fontified nil 986 . 989) (nil fontified nil 989 . 992) (nil fontified nil 992 . 1051) (nil fontified nil 1051 . 1057) (nil fontified nil 1057 . 1058) (nil fontified nil 1058 . 1063) (nil fontified nil 1063 . 1064) (nil fontified nil 1064 . 1072) (nil fontified nil 1072 . 1073) (nil fontified nil 1073 . 1086) (nil fontified nil 1086 . 1087) (nil fontified nil 1087 . 1093) (nil fontified nil 1093 . 1095) (nil fontified nil 1095 . 1106) (nil fontified nil 1106 . 1108) (nil fontified nil 1108 . 1109) (nil fontified nil 1109 . 1114) (nil fontified nil 1114 . 1119) (nil fontified nil 1119 . 1120) (nil fontified nil 1120 . 1130) (nil fontified nil 1130 . 1133) (nil fontified nil 1133 . 1138) (nil fontified nil 1138 . 1153) (nil fontified nil 1153 . 1159) (nil fontified nil 1159 . 1160) (nil fontified nil 1160 . 1169) (nil fontified nil 1169 . 1183) (nil fontified nil 1183 . 1188) (nil fontified nil 1188 . 1189) (nil fontified nil 1189 . 1198) (nil fontified nil 1198 . 1207) (nil fontified nil 1207 . 1211) (nil fontified nil 1211 . 1212) (nil fontified nil 1212 . 1215) (nil fontified nil 1215 . 1216) (nil fontified nil 1216 . 1226) (nil fontified nil 1226 . 1244) (nil fontified nil 1244 . 1249) (nil fontified nil 1249 . 1250) (nil fontified nil 1250 . 1257) (nil fontified nil 1257 . 1270) (nil fontified nil 1270 . 1273) (nil fontified nil 1273 . 1278) (nil fontified nil 1278 . 1280) (nil fontified nil 1280 . 1283) (nil fontified nil 1283 . 1291) (nil fontified nil 1291 . 1296) (nil fontified nil 1296 . 1304) (nil fontified nil 1304 . 1308) (nil fontified nil 1308 . 1311) (nil fontified nil 1311 . 1314) (nil fontified nil 1314 . 1318) (nil fontified nil 1318 . 1319) (nil fontified nil 1319 . 1321) (nil fontified nil 1321 . 1327) (nil fontified nil 1327 . 1333) (nil fontified nil 1333 . 1342) (nil fontified nil 1342 . 1343) (nil fontified nil 1343 . 1345) (nil fontified nil 1345 . 1348) (nil fontified nil 1348 . 1377) (nil fontified nil 1377 . 1383) (nil fontified nil 1383 . 1384) (nil fontified nil 1384 . 1389) (nil fontified nil 1389 . 1390) (nil fontified nil 1390 . 1398) (nil fontified nil 1398 . 1399) (nil fontified nil 1399 . 1415) (nil fontified nil 1415 . 1416) (nil fontified nil 1416 . 1420) (nil fontified nil 1420 . 1422) (nil fontified nil 1422 . 1426) (nil fontified nil 1426 . 1428) (nil fontified nil 1428 . 1429) (nil fontified nil 1429 . 1434) (nil fontified nil 1434 . 1439) (nil fontified nil 1439 . 1440) (nil fontified nil 1440 . 1455) (nil fontified nil 1455 . 1458) (nil fontified nil 1458 . 1463) (nil fontified nil 1463 . 1464) (nil fontified nil 1464 . 1476) (nil fontified nil 1476 . 1501) (nil fontified nil 1501 . 1508) (nil fontified nil 1508 . 1514) (nil fontified nil 1514 . 1531) (nil fontified nil 1531 . 1535) (nil fontified nil 1535 . 1555) (nil fontified nil 1555 . 1560) (nil fontified nil 1560 . 1561) (nil fontified nil 1561 . 1574) (nil fontified nil 1574 . 1575) (nil fontified nil 1575 . 1580) (nil fontified nil 1580 . 1586) (nil fontified nil 1586 . 1597) (nil fontified nil 1597 . 1614) (nil fontified nil 1614 . 1616) (nil fontified nil 1616 . 1646) (nil fontified nil 1646 . 1655) (nil fontified nil 1655 . 1667) (nil fontified nil 1667 . 1672) (nil fontified nil 1672 . 1673) (nil fontified nil 1673 . 1676) (nil fontified nil 1676 . 1677) (nil fontified nil 1677 . 1682) (nil fontified nil 1682 . 1719) (nil fontified nil 1719 . 1725) (nil fontified nil 1725 . 1750) (nil fontified nil 1750 . 1751) (nil fontified nil 1751 . 1752) (nil fontified nil 1752 . 1753) (nil fontified nil 1753 . 1757) (nil fontified nil 1757 . 1758) (nil fontified nil 1758 . 1775) (nil fontified nil 1775 . 1805) (nil fontified nil 1805 . 1814) (nil fontified nil 1814 . 1832) (nil fontified nil 1832 . 1838) (nil fontified nil 1838 . 1844) (nil fontified nil 1844 . 1850) (nil fontified nil 1850 . 1872) (nil fontified nil 1872 . 1878) (nil fontified nil 1878 . 1890) (nil fontified nil 1890 . 1899) (nil fontified nil 1899 . 1905) (nil fontified nil 1905 . 1909) (nil fontified nil 1909 . 1910) (nil fontified nil 1910 . 1928) (nil fontified nil 1928 . 1931) (nil fontified nil 1931 . 1947) (nil fontified nil 1947 . 1953) (nil fontified nil 1953 . 1968) (nil fontified nil 1968 . 1974) (nil fontified nil 1974 . 1989) (nil fontified nil 1989 . 1995) (nil fontified nil 1995 . 1997) (nil fontified nil 1997 . 1999) (nil fontified nil 1999 . 2005) (nil fontified nil 2005 . 2006) (nil fontified nil 2006 . 2011) (nil fontified nil 2011 . 2012) (nil fontified nil 2012 . 2024) (nil fontified nil 2024 . 2027) (nil fontified nil 2027 . 2032) (nil fontified nil 2032 . 2033) (nil fontified nil 2033 . 2034) (nil fontified nil 2034 . 2040) (nil fontified nil 2040 . 2048) (nil fontified nil 2048 . 2054) (nil fontified nil 2054 . 2062) (nil fontified nil 2062 . 2068) (nil fontified nil 2068 . 2076) (nil fontified nil 2076 . 2078) (1 . 2924)) ((#("\"use server\"
import { z } from 'zod'
import { stripe } from '@/lib/stripe'
import { checkRole } from \"@/../utils/roles\";
import { clerkClient } from \"@clerk/nextjs/server\";
import { productCatalouge, images, orders, users } from '@/db/schema'; 
import { db }  from \"@/db/index\";
import { eq } from 'drizzle-orm';
import { S3Client, PutObjectCommand } from \"@aws-sdk/client-s3\"
import { getSignedUrl } from \"@aws-sdk/s3-request-presigner\"
import crypto from \"crypto\"
import { Orders } from \"@/app/types\"
import { format, Order } from \"@/app/zod\"

// ... (keeping existing functions)

const s3Client = new S3Client({
    region: process.env.AWS_REGION!,
    credentials: {
        accessKeyId: process.env.AWS_ACCESS_KEY_ID!,
        secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY!,
    },
})

const allowedFileTypes = [
    \"image/jpeg\",
    \"image/png\",
]

const maxFileSize = 1048576 * 10 // 10 MB

const generateFileName = (bytes = 32) => crypto.randomBytes(bytes).toString(\"hex\")

// Moved from Form component and enhanced for server-side use
export async function computeSHA256(buffer: ArrayBuffer) {
    const hashBuffer = await crypto.subtle.digest(\"SHA-256\", buffer)
    const hashArray = Array.from(new Uint8Array(hashBuffer))
    const hashHex = hashArray.map((b) => b.toString(16).padStart(2, \"0\")).join(\"\")
    return hashHex
}

// Enhanced file upload handler
export async function handleFileUpload(file: File) {
    const signedURLResult = await getSignedURL({
        fileSize: file.size,
        fileType: file.type,
        checksum: await computeSHA256(await file.arrayBuffer()),
    })

    if (signedURLResult.failure !== undefined) {
        throw new Error(signedURLResult.failure)
    }

    return signedURLResult.success
}

type SignedURLResponse = Promise<
    | { failure?: undefined; success: { url: string; id: number } }
    | { failure: string; success?: undefined }
>

type GetSignedURLParams = {
    fileType: string
    fileSize: number
    checksum: string
}

export const getSignedURL = async ({
    fileType,
    fileSize,
    checksum,
}: GetSignedURLParams): SignedURLResponse => {
    if (!allowedFileTypes.includes(fileType)) {
        return { failure: \"File type not allowed\" }
    }

    if (fileSize > maxFileSize) {
        return { failure: \"File size too large\" }
    }

    const fileName = generateFileName()

    const putObjectCommand = new PutObjectCommand({
        Bucket: process.env.AWS_BUCKET_NAME,
        Key: fileName,
        ContentType: fileType,
        ContentLength: fileSize,
        ChecksumSHA256: checksum,
    })

    const url = await getSignedUrl(
        s3Client,
        putObjectCommand,
        { expiresIn: 60 }
    )

    await db.insert(images).values({
        url: url.split(\"?\")[0],
        width: 0,
        height: 0,
    })
    const results = await db.select().from(images)
    
    return { success: { url, id: results[0].id } }
}" 0 12 (face font-lock-string-face fontified nil) 12 13 (fontified nil) 13 19 (face font-lock-keyword-face fontified nil) 19 26 (fontified nil) 26 30 (face font-lock-keyword-face fontified nil) 30 31 (fontified nil) 31 36 (face font-lock-string-face fontified nil) 36 37 (fontified nil) 37 43 (face font-lock-keyword-face fontified nil) 43 55 (fontified nil) 55 59 (face font-lock-keyword-face fontified nil) 59 60 (fontified nil) 60 74 (face font-lock-string-face fontified nil) 74 75 (fontified nil) 75 81 (face font-lock-keyword-face fontified nil) 81 96 (fontified nil) 96 100 (face font-lock-keyword-face fontified nil) 100 101 (fontified nil) 101 119 (face font-lock-string-face fontified nil) 119 121 (fontified nil) 121 127 (face font-lock-keyword-face fontified nil) 127 144 (fontified nil) 144 148 (face font-lock-keyword-face fontified nil) 148 149 (fontified nil) 149 171 (face font-lock-string-face fontified nil) 171 173 (fontified nil) 173 179 (face font-lock-keyword-face fontified nil) 179 224 (fontified nil) 224 228 (face font-lock-keyword-face fontified nil) 228 229 (fontified nil) 229 242 (face font-lock-string-face fontified nil) 242 245 (fontified nil) 245 251 (face font-lock-keyword-face fontified nil) 251 260 (fontified nil) 260 264 (face font-lock-keyword-face fontified nil) 264 265 (fontified nil) 265 277 (face font-lock-string-face fontified nil) 277 279 (fontified nil) 279 285 (face font-lock-keyword-face fontified nil) 285 293 (fontified nil) 293 297 (face font-lock-keyword-face fontified nil) 297 298 (fontified nil) 298 311 (face font-lock-string-face fontified nil) 311 313 (fontified nil) 313 319 (face font-lock-keyword-face fontified nil) 319 351 (fontified nil) 351 355 (face font-lock-keyword-face fontified nil) 355 356 (fontified nil) 356 376 (face font-lock-string-face fontified nil) 376 377 (fontified nil) 377 383 (face font-lock-keyword-face fontified nil) 383 401 (fontified nil) 401 405 (face font-lock-keyword-face fontified nil) 405 406 (fontified nil) 406 437 (face font-lock-string-face fontified nil) 437 438 (fontified nil) 438 444 (face font-lock-keyword-face fontified nil) 444 452 (fontified nil) 452 456 (face font-lock-keyword-face fontified nil) 456 457 (fontified nil) 457 465 (face font-lock-string-face fontified nil) 465 466 (fontified nil) 466 472 (face font-lock-keyword-face fontified nil) 472 484 (fontified nil) 484 488 (face font-lock-keyword-face fontified nil) 488 489 (fontified nil) 489 502 (face font-lock-string-face fontified nil) 502 503 (fontified nil) 503 509 (face font-lock-keyword-face fontified nil) 509 528 (fontified nil) 528 532 (face font-lock-keyword-face fontified nil) 532 533 (fontified nil) 533 544 (face font-lock-string-face fontified nil) 544 545 (fontified nil) 545 546 (fontified nil) 546 549 (face font-lock-comment-delimiter-face fontified nil) 549 581 (face font-lock-comment-face fontified nil) 581 582 (face font-lock-comment-face fontified nil) 582 583 (fontified nil) 583 588 (fontified nil face font-lock-keyword-face) 588 589 (fontified nil) 589 597 (fontified nil face font-lock-variable-name-face) 597 600 (fontified nil) 600 603 (fontified nil face font-lock-keyword-face) 603 604 (fontified nil) 604 612 (fontified nil face font-lock-type-face) 612 613 (fontified nil) 613 785 (fontified nil font-lock-multiline t) 785 793 (font-lock-multiline t fontified nil) 793 796 (fontified nil) 796 801 (face font-lock-keyword-face fontified nil) 801 802 (fontified nil) 802 818 (face font-lock-variable-name-face fontified nil) 818 827 (fontified nil) 827 839 (face font-lock-string-face fontified nil) 839 845 (fontified nil) 845 856 (face font-lock-string-face fontified nil) 856 861 (fontified nil) 861 866 (face font-lock-keyword-face fontified nil) 866 867 (fontified nil) 867 878 (face font-lock-variable-name-face fontified nil) 878 894 (fontified nil) 894 897 (face font-lock-comment-delimiter-face fontified nil) 897 903 (face font-lock-comment-face fontified nil) 903 904 (fontified nil) 904 909 (face font-lock-keyword-face fontified nil) 909 910 (fontified nil) 910 926 (face font-lock-variable-name-face fontified nil) 926 942 (fontified nil) 942 944 (face font-lock-keyword-face fontified nil) 944 952 (fontified nil) 952 963 (face font-lock-function-name-face fontified nil) 963 971 (fontified nil) 971 979 (face font-lock-function-name-face fontified nil) 979 980 (fontified nil) 980 985 (face font-lock-string-face fontified nil) 985 988 (fontified nil) 988 991 (face font-lock-comment-delimiter-face fontified nil) 991 1050 (face font-lock-comment-face fontified nil) 1050 1056 (face font-lock-keyword-face fontified nil) 1056 1057 (fontified nil) 1057 1062 (face font-lock-keyword-face fontified nil) 1062 1063 (fontified nil) 1063 1071 (face font-lock-keyword-face fontified nil) 1071 1072 (fontified nil) 1072 1085 (face font-lock-function-name-face fontified nil) 1085 1086 (fontified nil) 1086 1092 (face font-lock-variable-name-face fontified nil) 1092 1094 (fontified nil) 1094 1105 (face font-lock-type-face fontified nil) 1105 1107 (fontified nil) 1107 1108 (font-lock-multiline t fontified nil typescript--pstate ((nil 0 function 1064 ("computeSHA256") nil) (nil -2305843009213693952 toplevel nil nil nil))) 1108 1113 (font-lock-multiline t fontified nil) 1113 1118 (font-lock-multiline t face font-lock-keyword-face fontified nil) 1118 1119 (font-lock-multiline t fontified nil) 1119 1129 (face font-lock-variable-name-face font-lock-multiline t fontified nil) 1129 1132 (font-lock-multiline t fontified nil) 1132 1137 (font-lock-multiline t face font-lock-keyword-face fontified nil) 1137 1152 (font-lock-multiline t fontified nil) 1152 1158 (face font-lock-function-name-face font-lock-multiline t fontified nil) 1158 1159 (font-lock-multiline t fontified nil) 1159 1168 (font-lock-multiline t face font-lock-string-face fontified nil) 1168 1182 (font-lock-multiline t fontified nil) 1182 1187 (font-lock-multiline t face font-lock-keyword-face fontified nil) 1187 1188 (font-lock-multiline t fontified nil) 1188 1197 (face font-lock-variable-name-face font-lock-multiline t fontified nil) 1197 1206 (font-lock-multiline t fontified nil) 1206 1210 (font-lock-multiline t face font-lock-function-name-face fontified nil) 1210 1211 (font-lock-multiline t fontified nil) 1211 1214 (font-lock-multiline t face font-lock-keyword-face fontified nil) 1214 1215 (font-lock-multiline t fontified nil) 1215 1225 (face font-lock-type-face font-lock-multiline t fontified nil) 1225 1243 (font-lock-multiline t fontified nil) 1243 1248 (font-lock-multiline t face font-lock-keyword-face fontified nil) 1248 1249 (font-lock-multiline t fontified nil) 1249 1256 (face font-lock-variable-name-face font-lock-multiline t fontified nil) 1256 1269 (font-lock-multiline t fontified nil) 1269 1272 (face font-lock-function-name-face font-lock-multiline t fontified nil) 1272 1277 (font-lock-multiline t fontified nil) 1277 1279 (face font-lock-keyword-face font-lock-multiline t fontified nil) 1279 1282 (font-lock-multiline t fontified nil) 1282 1290 (face font-lock-function-name-face font-lock-multiline t fontified nil) 1290 1295 (font-lock-multiline t fontified nil) 1295 1303 (face font-lock-function-name-face font-lock-multiline t fontified nil) 1303 1307 (font-lock-multiline t fontified nil) 1307 1310 (font-lock-multiline t face font-lock-string-face fontified nil) 1310 1313 (font-lock-multiline t fontified nil) 1313 1317 (face font-lock-function-name-face font-lock-multiline t fontified nil) 1317 1318 (font-lock-multiline t fontified nil) 1318 1320 (font-lock-multiline t face font-lock-string-face fontified nil) 1320 1326 (font-lock-multiline t fontified nil) 1326 1332 (font-lock-multiline t face font-lock-keyword-face fontified nil) 1332 1341 (font-lock-multiline t fontified nil) 1341 1342 (font-lock-multiline t fontified nil typescript--pend (nil 0 function 1064 ("computeSHA256") nil)) 1342 1344 (fontified nil) 1344 1347 (face font-lock-comment-delimiter-face fontified nil) 1347 1376 (face font-lock-comment-face fontified nil) 1376 1382 (face font-lock-keyword-face fontified nil) 1382 1383 (fontified nil) 1383 1388 (face font-lock-keyword-face fontified nil) 1388 1389 (fontified nil) 1389 1397 (face font-lock-keyword-face fontified nil) 1397 1398 (fontified nil) 1398 1414 (face font-lock-function-name-face fontified nil) 1414 1415 (fontified nil) 1415 1419 (face font-lock-variable-name-face fontified nil) 1419 1421 (fontified nil) 1421 1425 (face font-lock-type-face fontified nil) 1425 1427 (fontified nil) 1427 1428 (font-lock-multiline t fontified nil typescript--pstate ((nil 0 function 1390 ("handleFileUpload") nil) (((nil 0 function 1064 ("computeSHA256") nil)) -2305843009213693952 toplevel nil nil nil))) 1428 1433 (font-lock-multiline t fontified nil) 1433 1438 (font-lock-multiline t face font-lock-keyword-face fontified nil) 1438 1439 (font-lock-multiline t fontified nil) 1439 1454 (face font-lock-variable-name-face font-lock-multiline t fontified nil) 1454 1457 (font-lock-multiline t fontified nil) 1457 1462 (font-lock-multiline t face font-lock-keyword-face fontified nil) 1462 1463 (font-lock-multiline t fontified nil) 1463 1475 (face font-lock-function-name-face font-lock-multiline t fontified nil) 1475 1500 (font-lock-multiline t fontified nil) 1500 1507 (font-lock-multiline t fontified nil) 1507 1513 (font-lock-multiline t fontified nil) 1513 1530 (font-lock-multiline t fontified nil) 1530 1534 (font-lock-multiline t face font-lock-keyword-face fontified nil) 1534 1554 (font-lock-multiline t fontified nil) 1554 1559 (font-lock-multiline t face font-lock-keyword-face fontified nil) 1559 1560 (font-lock-multiline t fontified nil) 1560 1573 (face font-lock-function-name-face font-lock-multiline t fontified nil) 1573 1574 (font-lock-multiline t fontified nil) 1574 1579 (font-lock-multiline t face font-lock-keyword-face fontified nil) 1579 1585 (font-lock-multiline t fontified nil) 1585 1596 (face font-lock-function-name-face font-lock-multiline t fontified nil) 1596 1613 (font-lock-multiline t fontified nil) 1613 1615 (font-lock-multiline t face font-lock-keyword-face fontified nil) 1615 1645 (font-lock-multiline t fontified nil) 1645 1654 (font-lock-multiline t face font-lock-constant-face fontified nil) 1654 1666 (font-lock-multiline t fontified nil) 1666 1671 (font-lock-multiline t face font-lock-keyword-face fontified nil) 1671 1672 (font-lock-multiline t fontified nil) 1672 1675 (font-lock-multiline t face font-lock-keyword-face fontified nil) 1675 1676 (font-lock-multiline t fontified nil) 1676 1681 (face font-lock-type-face font-lock-multiline t fontified nil) 1681 1718 (font-lock-multiline t fontified nil) 1718 1724 (font-lock-multiline t face font-lock-keyword-face fontified nil) 1724 1749 (font-lock-multiline t fontified nil) 1749 1750 (font-lock-multiline t fontified nil typescript--pend (nil 0 function 1390 ("handleFileUpload") nil)) 1750 1751 (fontified nil) 1751 1752 (fontified nil) 1752 1756 (face font-lock-keyword-face fontified nil) 1756 1757 (fontified nil) 1757 1774 (face font-lock-type-face fontified nil) 1774 1804 (fontified nil) 1804 1813 (face font-lock-constant-face fontified nil) 1813 1831 (fontified nil) 1831 1837 (face typescript-primitive-face fontified nil) 1837 1843 (fontified nil) 1843 1849 (face typescript-primitive-face fontified nil) 1849 1871 (fontified nil) 1871 1877 (face typescript-primitive-face fontified nil) 1877 1889 (fontified nil) 1889 1898 (face font-lock-constant-face fontified nil) 1898 1904 (fontified nil) 1904 1908 (face font-lock-keyword-face fontified nil) 1908 1909 (fontified nil) 1909 1927 (face font-lock-type-face fontified nil) 1927 1930 (fontified nil) 1930 1946 (font-lock-multiline t fontified nil) 1946 1952 (font-lock-multiline t face typescript-primitive-face fontified nil) 1952 1967 (font-lock-multiline t fontified nil) 1967 1973 (font-lock-multiline t face typescript-primitive-face fontified nil) 1973 1988 (font-lock-multiline t fontified nil) 1988 1994 (font-lock-multiline t face typescript-primitive-face fontified nil) 1994 1996 (font-lock-multiline t fontified nil) 1996 1998 (fontified nil) 1998 2004 (face font-lock-keyword-face fontified nil) 2004 2005 (fontified nil) 2005 2010 (face font-lock-keyword-face fontified nil) 2010 2011 (fontified nil) 2011 2023 (face font-lock-variable-name-face fontified nil) 2023 2026 (fontified nil) 2026 2031 (face font-lock-keyword-face fontified nil) 2031 2032 (fontified nil) 2032 2033 (font-lock-multiline t fontified nil) 2033 2039 (font-lock-multiline t fontified nil) 2039 2047 (face font-lock-variable-name-face font-lock-multiline t fontified nil) 2047 2053 (font-lock-multiline t fontified nil) 2053 2061 (face font-lock-variable-name-face font-lock-multiline t fontified nil) 2061 2067 (font-lock-multiline t fontified nil) 2067 2075 (face font-lock-variable-name-face font-lock-multiline t fontified nil) 2075 2077 (font-lock-multiline t fontified nil) 2077 2078 (font-lock-multiline t fontified nil) 2078 2080 (font-lock-multiline t fontified nil) 2080 2098 (font-lock-multiline t face font-lock-variable-name-face fontified nil) 2098 2099 (font-lock-multiline t fontified nil) 2099 2101 (fontified nil) 2101 2118 (face font-lock-type-face fontified nil) 2118 2119 (fontified nil) 2119 2121 (face font-lock-keyword-face fontified nil) 2121 2122 (fontified nil) 2122 2128 (font-lock-multiline t fontified nil) 2128 2130 (font-lock-multiline t face font-lock-keyword-face fontified nil) 2130 2150 (font-lock-multiline t fontified nil) 2150 2158 (face font-lock-function-name-face font-lock-multiline t fontified nil) 2158 2180 (font-lock-multiline t fontified nil) 2180 2186 (font-lock-multiline t face font-lock-keyword-face fontified nil) 2186 2198 (font-lock-multiline t fontified nil) 2198 2221 (font-lock-multiline t face font-lock-string-face fontified nil) 2221 2235 (font-lock-multiline t fontified nil) 2235 2237 (font-lock-multiline t face font-lock-keyword-face fontified nil) 2237 2273 (font-lock-multiline t fontified nil) 2273 2279 (font-lock-multiline t face font-lock-keyword-face fontified nil) 2279 2285 (font-lock-multiline t fontified nil) 2285 2291 (font-lock-multiline t fontified nil) 2291 2312 (font-lock-multiline t face font-lock-string-face fontified nil) 2312 2326 (font-lock-multiline t fontified nil) 2326 2331 (font-lock-multiline t face font-lock-keyword-face fontified nil) 2331 2332 (font-lock-multiline t fontified nil) 2332 2340 (face font-lock-variable-name-face font-lock-multiline t fontified nil) 2340 2343 (font-lock-multiline t fontified nil) 2343 2359 (face font-lock-function-name-face font-lock-multiline t fontified nil) 2359 2367 (font-lock-multiline t fontified nil) 2367 2372 (font-lock-multiline t face font-lock-keyword-face fontified nil) 2372 2373 (font-lock-multiline t fontified nil) 2373 2389 (face font-lock-variable-name-face font-lock-multiline t fontified nil) 2389 2392 (font-lock-multiline t fontified nil) 2392 2395 (font-lock-multiline t face font-lock-keyword-face fontified nil) 2395 2396 (font-lock-multiline t fontified nil) 2396 2412 (face font-lock-type-face font-lock-multiline t fontified nil) 2412 2593 (font-lock-multiline t fontified nil) 2593 2598 (font-lock-multiline t face font-lock-keyword-face fontified nil) 2598 2599 (font-lock-multiline t fontified nil) 2599 2602 (face font-lock-variable-name-face font-lock-multiline t fontified nil) 2602 2605 (font-lock-multiline t fontified nil) 2605 2610 (font-lock-multiline t face font-lock-keyword-face fontified nil) 2610 2611 (font-lock-multiline t fontified nil) 2611 2623 (face font-lock-function-name-face font-lock-multiline t fontified nil) 2623 2706 (font-lock-multiline t fontified nil) 2706 2711 (font-lock-multiline t face font-lock-keyword-face fontified nil) 2711 2715 (font-lock-multiline t fontified nil) 2715 2721 (face font-lock-function-name-face font-lock-multiline t fontified nil) 2721 2730 (font-lock-multiline t fontified nil) 2730 2736 (face font-lock-function-name-face font-lock-multiline t fontified nil) 2736 2756 (font-lock-multiline t fontified nil) 2756 2761 (face font-lock-function-name-face font-lock-multiline t fontified nil) 2761 2762 (font-lock-multiline t fontified nil) 2762 2765 (font-lock-multiline t face font-lock-string-face fontified nil) 2765 2819 (font-lock-multiline t fontified nil) 2819 2824 (font-lock-multiline t face font-lock-keyword-face fontified nil) 2824 2825 (font-lock-multiline t fontified nil) 2825 2832 (face font-lock-variable-name-face font-lock-multiline t fontified nil) 2832 2835 (font-lock-multiline t fontified nil) 2835 2840 (font-lock-multiline t face font-lock-keyword-face fontified nil) 2840 2844 (font-lock-multiline t fontified nil) 2844 2850 (face font-lock-function-name-face font-lock-multiline t fontified nil) 2850 2853 (font-lock-multiline t fontified nil) 2853 2857 (font-lock-multiline t face font-lock-function-name-face fontified nil) 2857 2858 (font-lock-multiline t fontified nil) 2858 2864 (face font-lock-variable-name-face font-lock-multiline t fontified nil) 2864 2875 (font-lock-multiline t fontified nil) 2875 2881 (font-lock-multiline t face font-lock-keyword-face fontified nil) 2881 2922 (font-lock-multiline t fontified nil) 2922 2923 (font-lock-multiline t fontified nil rear-nonsticky nil)) . 1) (undo-tree-id109 . -581) (undo-tree-id110 . -2923) (undo-tree-id111 . -304) (undo-tree-id112 . -12) (undo-tree-id113 . -1476) (undo-tree-id114 . -1445) (undo-tree-id115 . -1998) (undo-tree-id116 . -791) (undo-tree-id117 . -838) (undo-tree-id118 . -838) (undo-tree-id119 . -1536) (undo-tree-id120 . -823) (undo-tree-id121 . -1536) (nil fontified t 2076 . 2078) (nil fontified t 2068 . 2076) (nil fontified t 2062 . 2068) (nil fontified t 2054 . 2062) (nil fontified t 2048 . 2054) (nil fontified t 2040 . 2048) (nil fontified t 2034 . 2040) (nil fontified t 2033 . 2034) (nil fontified t 2032 . 2033) (nil fontified t 2027 . 2032) (nil fontified t 2024 . 2027) (nil fontified t 2012 . 2024) (nil fontified t 2011 . 2012) (nil fontified t 2006 . 2011) (nil fontified t 2005 . 2006) (nil fontified t 1999 . 2005) (nil fontified t 1997 . 1999) (nil fontified t 1995 . 1997) (nil fontified t 1989 . 1995) (nil fontified t 1974 . 1989) (nil fontified t 1968 . 1974) (nil fontified t 1953 . 1968) (nil fontified t 1947 . 1953) (nil fontified t 1931 . 1947) (nil fontified t 1928 . 1931) (nil fontified t 1910 . 1928) (nil fontified t 1909 . 1910) (nil fontified t 1905 . 1909) (nil fontified t 1899 . 1905) (nil fontified t 1890 . 1899) (nil fontified t 1878 . 1890) (nil fontified t 1872 . 1878) (nil fontified t 1850 . 1872) (nil fontified t 1844 . 1850) (nil fontified t 1838 . 1844) (nil fontified t 1832 . 1838) (nil fontified t 1814 . 1832) (nil fontified t 1805 . 1814) (nil fontified t 1775 . 1805) (nil fontified t 1758 . 1775) (nil fontified t 1757 . 1758) (nil fontified t 1753 . 1757) (nil fontified t 1752 . 1753) (nil fontified t 1751 . 1752) (nil fontified t 1750 . 1751) (nil fontified t 1725 . 1750) (nil fontified t 1719 . 1725) (nil fontified t 1682 . 1719) (nil fontified t 1677 . 1682) (nil fontified t 1676 . 1677) (nil fontified t 1673 . 1676) (nil fontified t 1672 . 1673) (nil fontified t 1667 . 1672) (nil fontified t 1655 . 1667) (nil fontified t 1646 . 1655) (nil fontified t 1616 . 1646) (nil fontified t 1614 . 1616) (nil fontified t 1597 . 1614) (nil fontified t 1586 . 1597) (nil fontified t 1580 . 1586) (nil fontified t 1575 . 1580) (nil fontified t 1574 . 1575) (nil fontified t 1561 . 1574) (nil fontified t 1560 . 1561) (nil fontified t 1555 . 1560) (nil fontified t 1535 . 1555) (nil fontified t 1531 . 1535) (nil fontified t 1514 . 1531) (nil fontified t 1508 . 1514) (nil fontified t 1501 . 1508) (nil fontified t 1476 . 1501) (nil fontified t 1464 . 1476) (nil fontified t 1463 . 1464) (nil fontified t 1458 . 1463) (nil fontified t 1455 . 1458) (nil fontified t 1440 . 1455) (nil fontified t 1439 . 1440) (nil fontified t 1434 . 1439) (nil fontified t 1429 . 1434) (nil fontified t 1428 . 1429) (nil fontified t 1426 . 1428) (nil fontified t 1422 . 1426) (nil fontified t 1420 . 1422) (nil fontified t 1416 . 1420) (nil fontified t 1415 . 1416) (nil fontified t 1399 . 1415) (nil fontified t 1398 . 1399) (nil fontified t 1390 . 1398) (nil fontified t 1389 . 1390) (nil fontified t 1384 . 1389) (nil fontified t 1383 . 1384) (nil fontified t 1377 . 1383) (nil fontified t 1348 . 1377) (nil fontified t 1345 . 1348) (nil fontified t 1343 . 1345) (nil fontified t 1342 . 1343) (nil fontified t 1333 . 1342) (nil fontified t 1327 . 1333) (nil fontified t 1321 . 1327) (nil fontified t 1319 . 1321) (nil fontified t 1318 . 1319) (nil fontified t 1314 . 1318) (nil fontified t 1311 . 1314) (nil fontified t 1308 . 1311) (nil fontified t 1304 . 1308) (nil fontified t 1296 . 1304) (nil fontified t 1291 . 1296) (nil fontified t 1283 . 1291) (nil fontified t 1280 . 1283) (nil fontified t 1278 . 1280) (nil fontified t 1273 . 1278) (nil fontified t 1270 . 1273) (nil fontified t 1257 . 1270) (nil fontified t 1250 . 1257) (nil fontified t 1249 . 1250) (nil fontified t 1244 . 1249) (nil fontified t 1226 . 1244) (nil fontified t 1216 . 1226) (nil fontified t 1215 . 1216) (nil fontified t 1212 . 1215) (nil fontified t 1211 . 1212) (nil fontified t 1207 . 1211) (nil fontified t 1198 . 1207) (nil fontified t 1189 . 1198) (nil fontified t 1188 . 1189) (nil fontified t 1183 . 1188) (nil fontified t 1169 . 1183) (nil fontified t 1160 . 1169) (nil fontified t 1159 . 1160) (nil fontified t 1153 . 1159) (nil fontified t 1138 . 1153) (nil fontified t 1133 . 1138) (nil fontified t 1130 . 1133) (nil fontified t 1120 . 1130) (nil fontified t 1119 . 1120) (nil fontified t 1114 . 1119) (nil fontified t 1109 . 1114) (nil fontified t 1108 . 1109) (nil fontified t 1106 . 1108) (nil fontified t 1095 . 1106) (nil fontified t 1093 . 1095) (nil fontified t 1087 . 1093) (nil fontified t 1086 . 1087) (nil fontified t 1073 . 1086) (nil fontified t 1072 . 1073) (nil fontified t 1064 . 1072) (nil fontified t 1063 . 1064) (nil fontified t 1058 . 1063) (nil fontified t 1057 . 1058) (nil fontified t 1051 . 1057) (nil fontified t 992 . 1051) (nil fontified t 989 . 992) (nil fontified t 986 . 989) (nil fontified t 981 . 986) (nil fontified t 980 . 981) (nil fontified t 972 . 980) (nil fontified t 964 . 972) (nil fontified t 953 . 964) (nil fontified t 945 . 953) (nil fontified t 943 . 945) (nil fontified t 927 . 943) (nil fontified t 911 . 927) (nil fontified t 910 . 911) (nil fontified t 905 . 910) (nil fontified t 904 . 905) (nil fontified t 898 . 904) (nil fontified t 895 . 898) (nil fontified t 879 . 895) (nil fontified t 868 . 879) (nil fontified t 867 . 868) (nil fontified t 862 . 867) (nil fontified t 857 . 862) (nil fontified t 846 . 857) (nil fontified t 840 . 846) (nil fontified t 828 . 840) (nil fontified t 819 . 828) (nil fontified t 803 . 819) (nil fontified t 802 . 803) (nil fontified t 797 . 802) (nil fontified t 794 . 797) (nil fontified t 786 . 794) (nil fontified t 614 . 786) (nil fontified t 613 . 614) (nil fontified t 605 . 613) (nil fontified t 604 . 605) (nil fontified t 601 . 604) (nil fontified t 598 . 601) (nil fontified t 590 . 598) (nil fontified t 589 . 590) (nil fontified t 584 . 589) (nil fontified t 583 . 584) (nil fontified t 582 . 583) (nil fontified t 550 . 582) (nil fontified t 547 . 550) (nil fontified t 546 . 547) (nil fontified t 545 . 546) (nil fontified t 534 . 545) (nil fontified t 533 . 534) (nil fontified t 529 . 533) (nil fontified t 510 . 529) (nil fontified t 504 . 510) (nil fontified t 503 . 504) (nil fontified t 490 . 503) (nil fontified t 489 . 490) (nil fontified t 485 . 489) (nil fontified t 473 . 485) (nil fontified t 467 . 473) (nil fontified t 466 . 467) (nil fontified t 458 . 466) (nil fontified t 457 . 458) (nil fontified t 453 . 457) (nil fontified t 445 . 453) (nil fontified t 439 . 445) (nil fontified t 438 . 439) (nil fontified t 407 . 438) (nil fontified t 406 . 407) (nil fontified t 402 . 406) (nil fontified t 384 . 402) (nil fontified t 378 . 384) (nil fontified t 377 . 378) (nil fontified t 357 . 377) (nil fontified t 356 . 357) (nil fontified t 352 . 356) (nil fontified t 320 . 352) (nil fontified t 314 . 320) (nil fontified t 312 . 314) (nil fontified t 299 . 312) (nil fontified t 298 . 299) (nil fontified t 294 . 298) (nil fontified t 286 . 294) (nil fontified t 280 . 286) (nil fontified t 278 . 280) (nil fontified t 266 . 278) (nil fontified t 265 . 266) (nil fontified t 261 . 265) (nil fontified t 252 . 261) (nil fontified t 246 . 252) (nil fontified t 243 . 246) (nil fontified t 230 . 243) (nil fontified t 229 . 230) (nil fontified t 225 . 229) (nil fontified t 180 . 225) (nil fontified t 174 . 180) (nil fontified t 172 . 174) (nil fontified t 150 . 172) (nil fontified t 149 . 150) (nil fontified t 145 . 149) (nil fontified t 128 . 145) (nil fontified t 122 . 128) (nil fontified t 120 . 122) (nil fontified t 102 . 120) (nil fontified t 101 . 102) (nil fontified t 97 . 101) (nil fontified t 82 . 97) (nil fontified t 76 . 82) (nil fontified t 75 . 76) (nil fontified t 61 . 75) (nil fontified t 60 . 61) (nil fontified t 56 . 60) (nil fontified t 44 . 56) (nil fontified t 38 . 44) (nil fontified t 37 . 38) (nil fontified t 32 . 37) (nil fontified t 31 . 32) (nil fontified t 27 . 31) (nil fontified t 20 . 27) (nil fontified t 14 . 20) (nil fontified t 13 . 14) (nil fontified t 1 . 13) (nil rear-nonsticky t 2923 . 2924)) (26493 62567 199396 0) 0 nil])
([nil nil ((2924 . 2925)) ((#("
" 0 1 (fontified t)) . 2924) (undo-tree-id108 . -1)) (26493 62567 276884 0) 0 nil])
([nil nil ((#("export const getSignedURL = async ({
    fileType,
    fileSize,
    checksum,
}: GetSignedURLParams): SignedURLResponse => {
    if (!allowedFileTypes.includes(fileType)) {
        return { failure: \"File type not allowed\" }
    }

    if (fileSize > maxFileSize) {
        return { failure: \"File size too large\" }
    }

    const fileName = generateFileName()

    const putObjectCommand = new PutObjectCommand({
        Bucket: process.env.AWS_BUCKET_NAME,
        Key: fileName,
        ContentType: fileType,
        ContentLength: fileSize,
        ChecksumSHA256: checksum,
    })

    const url = await getSignedUrl(
        s3Client,
        putObjectCommand,
        { expiresIn: 60 }
    )

    await db.insert(images).values({
        url: url.split(\"?\")[0],
        width: 0,
        height: 0,
    })
    const results = await db.select().from(images)
    
    return { success: { url, id: results[0].id } }
}" 0 6 (face font-lock-keyword-face fontified t) 6 7 (fontified t) 7 12 (face font-lock-keyword-face fontified t) 12 13 (fontified t) 13 25 (face font-lock-variable-name-face fontified t) 25 28 (fontified t) 28 33 (face font-lock-keyword-face fontified t) 33 34 (fontified t) 34 35 (font-lock-multiline t fontified t) 35 41 (font-lock-multiline t fontified t) 41 49 (face font-lock-variable-name-face font-lock-multiline t fontified t) 49 55 (font-lock-multiline t fontified t) 55 63 (face font-lock-variable-name-face font-lock-multiline t fontified t) 63 69 (font-lock-multiline t fontified t) 69 77 (face font-lock-variable-name-face font-lock-multiline t fontified t) 77 79 (font-lock-multiline t fontified t) 79 80 (font-lock-multiline t fontified t) 80 82 (font-lock-multiline t fontified t) 82 100 (font-lock-multiline t face font-lock-variable-name-face fontified t) 100 101 (font-lock-multiline t fontified t) 101 103 (fontified t) 103 120 (face font-lock-type-face fontified t) 120 121 (fontified t) 121 123 (face font-lock-keyword-face fontified t) 123 124 (fontified t) 124 130 (font-lock-multiline t fontified t) 130 132 (font-lock-multiline t face font-lock-keyword-face fontified t) 132 152 (font-lock-multiline t fontified t) 152 160 (face font-lock-function-name-face font-lock-multiline t fontified t) 160 182 (font-lock-multiline t fontified t) 182 188 (font-lock-multiline t face font-lock-keyword-face fontified t) 188 200 (font-lock-multiline t fontified t) 200 223 (font-lock-multiline t face font-lock-string-face fontified t) 223 237 (font-lock-multiline t fontified t) 237 239 (font-lock-multiline t face font-lock-keyword-face fontified t) 239 275 (font-lock-multiline t fontified t) 275 281 (font-lock-multiline t face font-lock-keyword-face fontified t) 281 287 (font-lock-multiline t fontified t) 287 293 (font-lock-multiline t fontified t) 293 314 (font-lock-multiline t face font-lock-string-face fontified t) 314 328 (font-lock-multiline t fontified t) 328 333 (font-lock-multiline t face font-lock-keyword-face fontified t) 333 334 (font-lock-multiline t fontified t) 334 342 (face font-lock-variable-name-face font-lock-multiline t fontified t) 342 345 (font-lock-multiline t fontified t) 345 361 (face font-lock-function-name-face font-lock-multiline t fontified t) 361 369 (font-lock-multiline t fontified t) 369 374 (font-lock-multiline t face font-lock-keyword-face fontified t) 374 375 (font-lock-multiline t fontified t) 375 391 (face font-lock-variable-name-face font-lock-multiline t fontified t) 391 394 (font-lock-multiline t fontified t) 394 397 (font-lock-multiline t face font-lock-keyword-face fontified t) 397 398 (font-lock-multiline t fontified t) 398 414 (face font-lock-type-face font-lock-multiline t fontified t) 414 595 (font-lock-multiline t fontified t) 595 600 (font-lock-multiline t face font-lock-keyword-face fontified t) 600 601 (font-lock-multiline t fontified t) 601 604 (face font-lock-variable-name-face font-lock-multiline t fontified t) 604 607 (font-lock-multiline t fontified t) 607 612 (font-lock-multiline t face font-lock-keyword-face fontified t) 612 613 (font-lock-multiline t fontified t) 613 625 (face font-lock-function-name-face font-lock-multiline t fontified t) 625 708 (font-lock-multiline t fontified t) 708 713 (font-lock-multiline t face font-lock-keyword-face fontified t) 713 717 (font-lock-multiline t fontified t) 717 723 (face font-lock-function-name-face font-lock-multiline t fontified t) 723 732 (font-lock-multiline t fontified t) 732 738 (face font-lock-function-name-face font-lock-multiline t fontified t) 738 758 (font-lock-multiline t fontified t) 758 763 (face font-lock-function-name-face font-lock-multiline t fontified t) 763 764 (font-lock-multiline t fontified t) 764 767 (font-lock-multiline t face font-lock-string-face fontified t) 767 821 (font-lock-multiline t fontified t) 821 826 (font-lock-multiline t face font-lock-keyword-face fontified t) 826 827 (font-lock-multiline t fontified t) 827 834 (face font-lock-variable-name-face font-lock-multiline t fontified t) 834 837 (font-lock-multiline t fontified t) 837 842 (font-lock-multiline t face font-lock-keyword-face fontified t) 842 846 (font-lock-multiline t fontified t) 846 852 (face font-lock-function-name-face font-lock-multiline t fontified t) 852 855 (font-lock-multiline t fontified t) 855 859 (font-lock-multiline t face font-lock-function-name-face fontified t) 859 860 (font-lock-multiline t fontified t) 860 866 (face font-lock-variable-name-face font-lock-multiline t fontified t) 866 877 (font-lock-multiline t fontified t) 877 883 (font-lock-multiline t face font-lock-keyword-face fontified t) 883 924 (font-lock-multiline t fontified t) 924 925 (font-lock-multiline t fontified t rear-nonsticky t)) . 1999) (undo-tree-id142 . -925) (undo-tree-id143 . -925)) ((1999 . 2924)) (26493 62567 351778 0) 0 nil] [nil nil ((#("\"use server\"
import { z } from 'zod'
import { stripe } from '@/lib/stripe'
import { checkRole } from \"@/../utils/roles\";
import { clerkClient } from \"@clerk/nextjs/server\";
import { productCatalouge, images, orders, users } from '@/db/schema'; 
import { db }  from \"@/db/index\";
import { eq } from 'drizzle-orm';
import { S3Client, PutObjectCommand } from \"@aws-sdk/client-s3\"
import { getSignedUrl } from \"@aws-sdk/s3-request-presigner\"
import crypto from \"crypto\"
import { Orders } from \"@/app/types\"
import { format, Order } from \"@/app/zod\"

// ... (keeping existing functions)

const s3Client = new S3Client({
    region: process.env.AWS_REGION!,
    credentials: {
        accessKeyId: process.env.AWS_ACCESS_KEY_ID!,
        secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY!,
    },
})

const allowedFileTypes = [
    \"image/jpeg\",
    \"image/png\",
]

const maxFileSize = 1048576 * 10 // 10 MB

const generateFileName = (bytes = 32) => crypto.randomBytes(bytes).toString(\"hex\")

// Moved from Form component and enhanced for server-side use
export async function computeSHA256(buffer: ArrayBuffer) {
    const hashBuffer = await crypto.subtle.digest(\"SHA-256\", buffer)
    const hashArray = Array.from(new Uint8Array(hashBuffer))
    const hashHex = hashArray.map((b) => b.toString(16).padStart(2, \"0\")).join(\"\")
    return hashHex
}

// Enhanced file upload handler
export async function handleFileUpload(file: File) {
    const signedURLResult = await getSignedURL({
        fileSize: file.size,
        fileType: file.type,
        checksum: await computeSHA256(await file.arrayBuffer()),
    })

    if (signedURLResult.failure !== undefined) {
        throw new Error(signedURLResult.failure)
    }

    return signedURLResult.success
}

type SignedURLResponse = Promise<
    | { failure?: undefined; success: { url: string; id: number } }
    | { failure: string; success?: undefined }
>

type GetSignedURLParams = {
    fileType: string
    fileSize: number
    checksum: string
}

export const getSignedURL = async ({
    fileType,
    fileSize,
    checksum,
}: GetSignedURLParams): SignedURLResponse => {
    if (!allowedFileTypes.includes(fileType)) {
        return { failure: \"File type not allowed\" }
    }

    if (fileSize > maxFileSize) {
        return { failure: \"File size too large\" }
    }

    const fileName = generateFileName()

    const putObjectCommand = new PutObjectCommand({
        Bucket: process.env.AWS_BUCKET_NAME,
        Key: fileName,
        ContentType: fileType,
        ContentLength: fileSize,
        ChecksumSHA256: checksum,
    })

    const url = await getSignedUrl(
        s3Client,
        putObjectCommand,
        { expiresIn: 60 }
    )

    await db.insert(images).values({
        url: url.split(\"?\")[0],
        width: 0,
        height: 0,
    })
    const results = await db.select().from(images)
    
    return { success: { url, id: results[0].id } }
}
" 0 12 (face font-lock-string-face fontified t) 12 13 (fontified t) 13 19 (face font-lock-keyword-face fontified t) 19 26 (fontified t) 26 30 (face font-lock-keyword-face fontified t) 30 31 (fontified t) 31 36 (face font-lock-string-face fontified t) 36 37 (fontified t) 37 43 (face font-lock-keyword-face fontified t) 43 55 (fontified t) 55 59 (face font-lock-keyword-face fontified t) 59 60 (fontified t) 60 74 (face font-lock-string-face fontified t) 74 75 (fontified t) 75 81 (face font-lock-keyword-face fontified t) 81 96 (fontified t) 96 100 (face font-lock-keyword-face fontified t) 100 101 (fontified t) 101 119 (face font-lock-string-face fontified t) 119 121 (fontified t) 121 127 (face font-lock-keyword-face fontified t) 127 144 (fontified t) 144 148 (face font-lock-keyword-face fontified t) 148 149 (fontified t) 149 171 (face font-lock-string-face fontified t) 171 173 (fontified t) 173 179 (face font-lock-keyword-face fontified t) 179 224 (fontified t) 224 228 (face font-lock-keyword-face fontified t) 228 229 (fontified t) 229 242 (face font-lock-string-face fontified t) 242 245 (fontified t) 245 251 (face font-lock-keyword-face fontified t) 251 260 (fontified t) 260 264 (face font-lock-keyword-face fontified t) 264 265 (fontified t) 265 277 (face font-lock-string-face fontified t) 277 279 (fontified t) 279 285 (face font-lock-keyword-face fontified t) 285 293 (fontified t) 293 297 (face font-lock-keyword-face fontified t) 297 298 (fontified t) 298 311 (face font-lock-string-face fontified t) 311 313 (fontified t) 313 319 (face font-lock-keyword-face fontified t) 319 351 (fontified t) 351 355 (face font-lock-keyword-face fontified t) 355 356 (fontified t) 356 376 (face font-lock-string-face fontified t) 376 377 (fontified t) 377 383 (face font-lock-keyword-face fontified t) 383 401 (fontified t) 401 405 (face font-lock-keyword-face fontified t) 405 406 (fontified t) 406 437 (face font-lock-string-face fontified t) 437 438 (fontified t) 438 444 (face font-lock-keyword-face fontified t) 444 452 (fontified t) 452 456 (face font-lock-keyword-face fontified t) 456 457 (fontified t) 457 465 (face font-lock-string-face fontified t) 465 466 (fontified t) 466 472 (face font-lock-keyword-face fontified t) 472 484 (fontified t) 484 488 (face font-lock-keyword-face fontified t) 488 489 (fontified t) 489 502 (face font-lock-string-face fontified t) 502 503 (fontified t) 503 509 (face font-lock-keyword-face fontified t) 509 528 (fontified t) 528 532 (face font-lock-keyword-face fontified t) 532 533 (fontified t) 533 544 (face font-lock-string-face fontified t) 544 546 (fontified t) 546 549 (face font-lock-comment-delimiter-face fontified t) 549 582 (face font-lock-comment-face fontified t) 582 583 (fontified t) 583 588 (face font-lock-keyword-face fontified t) 588 589 (fontified t) 589 597 (face font-lock-variable-name-face fontified t) 597 600 (fontified t) 600 603 (face font-lock-keyword-face fontified t) 603 604 (fontified t) 604 612 (face font-lock-type-face fontified t) 612 613 (fontified t) 613 793 (font-lock-multiline t fontified t) 793 796 (fontified t) 796 801 (face font-lock-keyword-face fontified t) 801 802 (fontified t) 802 818 (face font-lock-variable-name-face fontified t) 818 827 (fontified t) 827 839 (face font-lock-string-face fontified t) 839 845 (fontified t) 845 856 (face font-lock-string-face fontified t) 856 861 (fontified t) 861 866 (face font-lock-keyword-face fontified t) 866 867 (fontified t) 867 878 (face font-lock-variable-name-face fontified t) 878 894 (fontified t) 894 897 (face font-lock-comment-delimiter-face fontified t) 897 903 (face font-lock-comment-face fontified t) 903 904 (fontified t) 904 909 (face font-lock-keyword-face fontified t) 909 910 (fontified t) 910 926 (face font-lock-variable-name-face fontified t) 926 942 (fontified t) 942 944 (face font-lock-keyword-face fontified t) 944 952 (fontified t) 952 963 (face font-lock-function-name-face fontified t) 963 971 (fontified t) 971 979 (face font-lock-function-name-face fontified t) 979 980 (fontified t) 980 985 (face font-lock-string-face fontified t) 985 988 (fontified t) 988 991 (face font-lock-comment-delimiter-face fontified t) 991 1050 (face font-lock-comment-face fontified t) 1050 1056 (face font-lock-keyword-face fontified t) 1056 1057 (fontified t) 1057 1062 (face font-lock-keyword-face fontified t) 1062 1063 (fontified t) 1063 1071 (face font-lock-keyword-face fontified t) 1071 1072 (fontified t) 1072 1085 (face font-lock-function-name-face fontified t) 1085 1086 (fontified t) 1086 1092 (face font-lock-variable-name-face fontified t) 1092 1094 (fontified t) 1094 1105 (face font-lock-type-face fontified t) 1105 1107 (fontified t) 1107 1108 (typescript--pstate ((nil 0 function 1064 ("computeSHA256") nil) (nil -2305843009213693952 toplevel nil nil nil)) font-lock-multiline t fontified t) 1108 1113 (font-lock-multiline t fontified t) 1113 1118 (font-lock-multiline t face font-lock-keyword-face fontified t) 1118 1119 (font-lock-multiline t fontified t) 1119 1129 (face font-lock-variable-name-face font-lock-multiline t fontified t) 1129 1132 (font-lock-multiline t fontified t) 1132 1137 (font-lock-multiline t face font-lock-keyword-face fontified t) 1137 1152 (font-lock-multiline t fontified t) 1152 1158 (face font-lock-function-name-face font-lock-multiline t fontified t) 1158 1159 (font-lock-multiline t fontified t) 1159 1168 (font-lock-multiline t face font-lock-string-face fontified t) 1168 1182 (font-lock-multiline t fontified t) 1182 1187 (font-lock-multiline t face font-lock-keyword-face fontified t) 1187 1188 (font-lock-multiline t fontified t) 1188 1197 (face font-lock-variable-name-face font-lock-multiline t fontified t) 1197 1206 (font-lock-multiline t fontified t) 1206 1210 (font-lock-multiline t face font-lock-function-name-face fontified t) 1210 1211 (font-lock-multiline t fontified t) 1211 1214 (font-lock-multiline t face font-lock-keyword-face fontified t) 1214 1215 (font-lock-multiline t fontified t) 1215 1225 (face font-lock-type-face font-lock-multiline t fontified t) 1225 1243 (font-lock-multiline t fontified t) 1243 1248 (font-lock-multiline t face font-lock-keyword-face fontified t) 1248 1249 (font-lock-multiline t fontified t) 1249 1256 (face font-lock-variable-name-face font-lock-multiline t fontified t) 1256 1269 (font-lock-multiline t fontified t) 1269 1272 (face font-lock-function-name-face font-lock-multiline t fontified t) 1272 1277 (font-lock-multiline t fontified t) 1277 1279 (face font-lock-keyword-face font-lock-multiline t fontified t) 1279 1282 (font-lock-multiline t fontified t) 1282 1290 (face font-lock-function-name-face font-lock-multiline t fontified t) 1290 1295 (font-lock-multiline t fontified t) 1295 1303 (face font-lock-function-name-face font-lock-multiline t fontified t) 1303 1307 (font-lock-multiline t fontified t) 1307 1310 (font-lock-multiline t face font-lock-string-face fontified t) 1310 1313 (font-lock-multiline t fontified t) 1313 1317 (face font-lock-function-name-face font-lock-multiline t fontified t) 1317 1318 (font-lock-multiline t fontified t) 1318 1320 (font-lock-multiline t face font-lock-string-face fontified t) 1320 1326 (font-lock-multiline t fontified t) 1326 1332 (font-lock-multiline t face font-lock-keyword-face fontified t) 1332 1341 (font-lock-multiline t fontified t) 1341 1342 (typescript--pend (nil 0 function 1064 ("computeSHA256") nil) font-lock-multiline t fontified t) 1342 1344 (fontified t) 1344 1347 (face font-lock-comment-delimiter-face fontified t) 1347 1376 (face font-lock-comment-face fontified t) 1376 1382 (face font-lock-keyword-face fontified t) 1382 1383 (fontified t) 1383 1388 (face font-lock-keyword-face fontified t) 1388 1389 (fontified t) 1389 1397 (face font-lock-keyword-face fontified t) 1397 1398 (fontified t) 1398 1414 (face font-lock-function-name-face fontified t) 1414 1415 (fontified t) 1415 1419 (face font-lock-variable-name-face fontified t) 1419 1421 (fontified t) 1421 1425 (face font-lock-type-face fontified t) 1425 1427 (fontified t) 1427 1428 (font-lock-multiline t typescript--pstate ((nil 0 function 1390 ("handleFileUpload") nil) (((nil 0 function 1064 ("computeSHA256") nil)) -2305843009213693952 toplevel nil nil nil)) fontified t) 1428 1433 (font-lock-multiline t fontified t) 1433 1438 (font-lock-multiline t face font-lock-keyword-face fontified t) 1438 1439 (font-lock-multiline t fontified t) 1439 1454 (face font-lock-variable-name-face font-lock-multiline t fontified t) 1454 1457 (font-lock-multiline t fontified t) 1457 1462 (font-lock-multiline t face font-lock-keyword-face fontified t) 1462 1463 (font-lock-multiline t fontified t) 1463 1475 (face font-lock-function-name-face font-lock-multiline t fontified t) 1475 1500 (font-lock-multiline t fontified t) 1500 1507 (font-lock-multiline t fontified t) 1507 1530 (font-lock-multiline t fontified t) 1530 1534 (font-lock-multiline t face font-lock-keyword-face fontified t) 1534 1554 (font-lock-multiline t fontified t) 1554 1559 (font-lock-multiline t face font-lock-keyword-face fontified t) 1559 1560 (font-lock-multiline t fontified t) 1560 1573 (face font-lock-function-name-face font-lock-multiline t fontified t) 1573 1574 (font-lock-multiline t fontified t) 1574 1579 (font-lock-multiline t face font-lock-keyword-face fontified t) 1579 1585 (font-lock-multiline t fontified t) 1585 1596 (face font-lock-function-name-face font-lock-multiline t fontified t) 1596 1613 (font-lock-multiline t fontified t) 1613 1615 (font-lock-multiline t face font-lock-keyword-face fontified t) 1615 1645 (font-lock-multiline t fontified t) 1645 1654 (font-lock-multiline t face font-lock-constant-face fontified t) 1654 1666 (font-lock-multiline t fontified t) 1666 1671 (font-lock-multiline t face font-lock-keyword-face fontified t) 1671 1672 (font-lock-multiline t fontified t) 1672 1675 (font-lock-multiline t face font-lock-keyword-face fontified t) 1675 1676 (font-lock-multiline t fontified t) 1676 1681 (face font-lock-type-face font-lock-multiline t fontified t) 1681 1718 (font-lock-multiline t fontified t) 1718 1724 (font-lock-multiline t face font-lock-keyword-face fontified t) 1724 1749 (font-lock-multiline t fontified t) 1749 1750 (typescript--pend (nil 0 function 1390 ("handleFileUpload") nil) font-lock-multiline t fontified t) 1750 1752 (fontified t) 1752 1756 (face font-lock-keyword-face fontified t) 1756 1757 (fontified t) 1757 1774 (face font-lock-type-face fontified t) 1774 1804 (fontified t) 1804 1813 (face font-lock-constant-face fontified t) 1813 1831 (fontified t) 1831 1837 (face typescript-primitive-face fontified t) 1837 1843 (fontified t) 1843 1849 (face typescript-primitive-face fontified t) 1849 1871 (fontified t) 1871 1877 (face typescript-primitive-face fontified t) 1877 1889 (fontified t) 1889 1898 (face font-lock-constant-face fontified t) 1898 1904 (fontified t) 1904 1908 (face font-lock-keyword-face fontified t) 1908 1909 (fontified t) 1909 1927 (face font-lock-type-face fontified t) 1927 1930 (fontified t) 1930 1946 (font-lock-multiline t fontified t) 1946 1952 (font-lock-multiline t face typescript-primitive-face fontified t) 1952 1967 (font-lock-multiline t fontified t) 1967 1973 (font-lock-multiline t face typescript-primitive-face fontified t) 1973 1988 (font-lock-multiline t fontified t) 1988 1994 (font-lock-multiline t face typescript-primitive-face fontified t) 1994 1996 (font-lock-multiline t fontified t) 1996 1998 (fontified t) 1998 2004 (face font-lock-keyword-face fontified t) 2004 2005 (fontified t) 2005 2010 (face font-lock-keyword-face fontified t) 2010 2011 (fontified t) 2011 2023 (face font-lock-variable-name-face fontified t) 2023 2026 (fontified t) 2026 2031 (face font-lock-keyword-face fontified t) 2031 2032 (fontified t) 2032 2033 (font-lock-multiline t fontified t) 2033 2039 (font-lock-multiline t fontified t) 2039 2047 (face font-lock-variable-name-face font-lock-multiline t fontified t) 2047 2053 (font-lock-multiline t fontified t) 2053 2061 (face font-lock-variable-name-face font-lock-multiline t fontified t) 2061 2067 (font-lock-multiline t fontified t) 2067 2075 (face font-lock-variable-name-face font-lock-multiline t fontified t) 2075 2077 (font-lock-multiline t fontified t) 2077 2078 (font-lock-multiline t fontified t) 2078 2080 (font-lock-multiline t fontified t) 2080 2098 (font-lock-multiline t face font-lock-variable-name-face fontified t) 2098 2099 (font-lock-multiline t fontified t) 2099 2101 (fontified t) 2101 2118 (face font-lock-type-face fontified t) 2118 2119 (fontified t) 2119 2121 (face font-lock-keyword-face fontified t) 2121 2122 (fontified t) 2122 2128 (font-lock-multiline t fontified t) 2128 2130 (font-lock-multiline t face font-lock-keyword-face fontified t) 2130 2150 (font-lock-multiline t fontified t) 2150 2158 (face font-lock-function-name-face font-lock-multiline t fontified t) 2158 2180 (font-lock-multiline t fontified t) 2180 2186 (font-lock-multiline t face font-lock-keyword-face fontified t) 2186 2198 (font-lock-multiline t fontified t) 2198 2221 (font-lock-multiline t face font-lock-string-face fontified t) 2221 2235 (font-lock-multiline t fontified t) 2235 2237 (font-lock-multiline t face font-lock-keyword-face fontified t) 2237 2273 (font-lock-multiline t fontified t) 2273 2279 (font-lock-multiline t face font-lock-keyword-face fontified t) 2279 2291 (font-lock-multiline t fontified t) 2291 2312 (font-lock-multiline t face font-lock-string-face fontified t) 2312 2326 (font-lock-multiline t fontified t) 2326 2331 (font-lock-multiline t face font-lock-keyword-face fontified t) 2331 2332 (font-lock-multiline t fontified t) 2332 2340 (face font-lock-variable-name-face font-lock-multiline t fontified t) 2340 2343 (font-lock-multiline t fontified t) 2343 2359 (face font-lock-function-name-face font-lock-multiline t fontified t) 2359 2367 (font-lock-multiline t fontified t) 2367 2372 (font-lock-multiline t face font-lock-keyword-face fontified t) 2372 2373 (font-lock-multiline t fontified t) 2373 2389 (face font-lock-variable-name-face font-lock-multiline t fontified t) 2389 2392 (font-lock-multiline t fontified t) 2392 2395 (font-lock-multiline t face font-lock-keyword-face fontified t) 2395 2396 (font-lock-multiline t fontified t) 2396 2412 (face font-lock-type-face font-lock-multiline t fontified t) 2412 2593 (font-lock-multiline t fontified t) 2593 2598 (font-lock-multiline t face font-lock-keyword-face fontified t) 2598 2599 (font-lock-multiline t fontified t) 2599 2602 (face font-lock-variable-name-face font-lock-multiline t fontified t) 2602 2605 (font-lock-multiline t fontified t) 2605 2610 (font-lock-multiline t face font-lock-keyword-face fontified t) 2610 2611 (font-lock-multiline t fontified t) 2611 2623 (face font-lock-function-name-face font-lock-multiline t fontified t) 2623 2706 (font-lock-multiline t fontified t) 2706 2711 (font-lock-multiline t face font-lock-keyword-face fontified t) 2711 2715 (font-lock-multiline t fontified t) 2715 2721 (face font-lock-function-name-face font-lock-multiline t fontified t) 2721 2730 (font-lock-multiline t fontified t) 2730 2736 (face font-lock-function-name-face font-lock-multiline t fontified t) 2736 2756 (font-lock-multiline t fontified t) 2756 2761 (face font-lock-function-name-face font-lock-multiline t fontified t) 2761 2762 (font-lock-multiline t fontified t) 2762 2765 (font-lock-multiline t face font-lock-string-face fontified t) 2765 2819 (font-lock-multiline t fontified t) 2819 2824 (font-lock-multiline t face font-lock-keyword-face fontified t) 2824 2825 (font-lock-multiline t fontified t) 2825 2832 (face font-lock-variable-name-face font-lock-multiline t fontified t) 2832 2835 (font-lock-multiline t fontified t) 2835 2840 (font-lock-multiline t face font-lock-keyword-face fontified t) 2840 2844 (font-lock-multiline t fontified t) 2844 2850 (face font-lock-function-name-face font-lock-multiline t fontified t) 2850 2853 (font-lock-multiline t fontified t) 2853 2857 (font-lock-multiline t face font-lock-function-name-face fontified t) 2857 2858 (font-lock-multiline t fontified t) 2858 2864 (face font-lock-variable-name-face font-lock-multiline t fontified t) 2864 2875 (font-lock-multiline t fontified t) 2875 2881 (font-lock-multiline t face font-lock-keyword-face fontified t) 2881 2922 (font-lock-multiline t fontified t) 2922 2923 (font-lock-multiline t rear-nonsticky t fontified t) 2923 2924 (fontified t)) . 1) (undo-tree-id94 . -2924) (undo-tree-id95 . -2924) (t 26492 43133 241446 810000)) ((1 . 2925)) (26493 62182 115480 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 3717 . 3718) (nil fontified nil 1999 . 2005) (nil fontified nil 2005 . 2006) (nil fontified nil 2006 . 2011) (nil fontified nil 2011 . 2012) (nil fontified nil 2012 . 2020) (nil fontified nil 2020 . 2021) (nil fontified nil 2021 . 2033) (nil fontified nil 2033 . 2034) (nil fontified nil 2034 . 2040) (nil fontified nil 2040 . 2048) (nil fontified nil 2048 . 2054) (nil fontified nil 2054 . 2062) (nil fontified nil 2062 . 2068) (nil fontified nil 2068 . 2076) (nil fontified nil 2076 . 2082) (nil fontified nil 2082 . 2083) (nil fontified nil 2083 . 2086) (nil fontified nil 2086 . 2092) (nil fontified nil 2092 . 2096) (nil fontified nil 2096 . 2102) (nil fontified nil 2102 . 2111) (nil fontified nil 2111 . 2113) (nil fontified nil 2113 . 2115) (nil fontified nil 2115 . 2121) (nil fontified nil 2121 . 2129) (nil fontified nil 2129 . 2131) (nil fontified nil 2131 . 2137) (nil fontified nil 2137 . 2152) (nil fontified nil 2152 . 2158) (nil fontified nil 2158 . 2173) (nil fontified nil 2173 . 2179) (nil fontified nil 2179 . 2190) (nil fontified nil 2190 . 2196) (nil fontified nil 2196 . 2201) (nil fontified nil 2201 . 2205) (nil fontified nil 2205 . 2207) (nil fontified nil 2207 . 2213) (nil fontified nil 2213 . 2230) (nil fontified nil 2230 . 2236) (nil fontified nil 2236 . 2239) (nil fontified nil 2239 . 2243) (nil fontified nil 2243 . 2244) (1999 . 3718)) ((#("export async function getSignedURL({
    fileType,
    fileSize,
    checksum,
    name,
    type,
    productId
}: {
    fileType: string
    fileSize: number
    checksum: string
    name: string
    type: string
    productId?: number | null
}): Promise<ActionResponse<FileUploadResponse>> {
    // Validation
    if (!s3Config.allowedTypes.includes(fileType as any)) {
        return {
            success: false,
            error: \"File type not allowed\"
        }
    }

    if (fileSize > s3Config.maxSize) {
        return {
            success: false,
            error: \"File size too large\"
        }
    }

    try {
        const fileName = generateFileName()
        const putObjectCommand = new PutObjectCommand({
            Bucket: s3Config.bucket,
            Key: fileName,
            ContentType: fileType,
            ContentLength: fileSize,
            ChecksumSHA256: checksum,
        })

        const url = await getSignedUrl(
            s3Config.client,
            putObjectCommand,
            { expiresIn: 60 }
        )

        const baseUrl = url.split(\"?\")[0]
        
        // Store file info in database with all required fields
        await db.insert(images).values({
            name,
            url: baseUrl,
            width: 0,
            height: 0,
            type,
            productId: productId || undefined
        })

        const results = await db.select().from(images)
        
        return {
            success: true,
            data: {
                url,
                id: results[0].id
            }
        }
    } catch (error) {
        return {
            success: false,
            error: 'Failed to generate signed URL'
        }
    }
}" 0 6 (face font-lock-keyword-face fontified nil) 6 7 (fontified nil) 7 12 (face font-lock-keyword-face fontified nil) 12 13 (fontified nil) 13 21 (face font-lock-keyword-face fontified nil) 21 22 (fontified nil) 22 34 (face font-lock-function-name-face font-lock-multiline t fontified nil) 34 35 (font-lock-multiline t fontified nil) 35 41 (font-lock-multiline t fontified nil) 41 49 (face font-lock-variable-name-face font-lock-multiline t fontified nil) 49 55 (font-lock-multiline t fontified nil) 55 63 (face font-lock-variable-name-face font-lock-multiline t fontified nil) 63 69 (font-lock-multiline t fontified nil) 69 77 (face font-lock-variable-name-face font-lock-multiline t fontified nil) 77 83 (font-lock-multiline t fontified nil) 83 84 (face font-lock-variable-name-face font-lock-multiline t fontified nil) 84 87 (fontified nil face font-lock-variable-name-face font-lock-multiline t) 87 93 (fontified nil font-lock-multiline t) 93 97 (fontified nil font-lock-multiline t face font-lock-variable-name-face) 97 103 (fontified nil font-lock-multiline t) 103 112 (fontified nil face font-lock-variable-name-face font-lock-multiline t) 112 114 (fontified nil font-lock-multiline t) 114 116 (fontified nil font-lock-multiline t) 116 122 (fontified nil font-lock-multiline t) 122 130 (fontified nil face font-lock-variable-name-face font-lock-multiline t) 130 132 (fontified nil font-lock-multiline t) 132 138 (fontified nil font-lock-multiline t face typescript-primitive-face) 138 153 (fontified nil font-lock-multiline t) 153 159 (fontified nil font-lock-multiline t face typescript-primitive-face) 159 174 (fontified nil font-lock-multiline t) 174 180 (fontified nil font-lock-multiline t face typescript-primitive-face) 180 191 (fontified nil font-lock-multiline t) 191 197 (fontified nil font-lock-multiline t face typescript-primitive-face) 197 202 (fontified nil font-lock-multiline t) 202 206 (fontified nil font-lock-multiline t face default) 206 208 (fontified nil font-lock-multiline t) 208 214 (fontified nil font-lock-multiline t face typescript-primitive-face) 214 231 (fontified nil font-lock-multiline t) 231 237 (fontified nil font-lock-multiline t face typescript-primitive-face) 237 240 (fontified nil font-lock-multiline t) 240 244 (fontified nil font-lock-multiline t face font-lock-constant-face) 244 245 (fontified nil font-lock-multiline t) 245 246 (fontified nil font-lock-multiline t) 246 247 (fontified nil font-lock-multiline t) 247 249 (fontified nil) 249 256 (fontified nil face font-lock-type-face) 256 257 (fontified nil) 257 271 (fontified nil face font-lock-type-face) 271 272 (fontified nil) 272 290 (fontified nil face font-lock-type-face) 290 293 (fontified nil) 293 299 (fontified nil font-lock-multiline t) 299 302 (fontified nil font-lock-multiline t face font-lock-comment-delimiter-face) 302 313 (fontified nil font-lock-multiline t face font-lock-comment-face) 313 317 (fontified nil font-lock-multiline t) 317 319 (fontified nil font-lock-multiline t face font-lock-keyword-face) 319 344 (fontified nil font-lock-multiline t) 344 352 (fontified nil face font-lock-function-name-face font-lock-multiline t) 352 362 (fontified nil font-lock-multiline t) 362 364 (fontified nil font-lock-multiline t face font-lock-keyword-face) 364 365 (fontified nil font-lock-multiline t) 365 368 (fontified nil font-lock-multiline t face typescript-primitive-face) 368 381 (fontified nil font-lock-multiline t) 381 387 (fontified nil font-lock-multiline t face font-lock-keyword-face) 387 411 (fontified nil font-lock-multiline t) 411 416 (fontified nil font-lock-multiline t face font-lock-constant-face) 416 437 (fontified nil font-lock-multiline t) 437 460 (fontified nil font-lock-multiline t face font-lock-string-face) 460 482 (fontified nil font-lock-multiline t) 482 484 (fontified nil font-lock-multiline t face font-lock-keyword-face) 484 525 (fontified nil font-lock-multiline t) 525 531 (fontified nil font-lock-multiline t face font-lock-keyword-face) 531 555 (fontified nil font-lock-multiline t) 555 560 (fontified nil font-lock-multiline t face font-lock-constant-face) 560 581 (fontified nil font-lock-multiline t) 581 602 (fontified nil font-lock-multiline t face font-lock-string-face) 602 624 (fontified nil font-lock-multiline t) 624 627 (fontified nil font-lock-multiline t face font-lock-keyword-face) 627 638 (fontified nil font-lock-multiline t) 638 643 (fontified nil font-lock-multiline t face font-lock-keyword-face) 643 644 (fontified nil font-lock-multiline t) 644 652 (fontified nil face font-lock-variable-name-face font-lock-multiline t) 652 655 (fontified nil font-lock-multiline t) 655 671 (fontified nil face font-lock-function-name-face font-lock-multiline t) 671 682 (fontified nil font-lock-multiline t) 682 687 (fontified nil font-lock-multiline t face font-lock-keyword-face) 687 688 (fontified nil font-lock-multiline t) 688 704 (fontified nil face font-lock-variable-name-face font-lock-multiline t) 704 707 (fontified nil font-lock-multiline t) 707 710 (fontified nil font-lock-multiline t face font-lock-keyword-face) 710 711 (fontified nil font-lock-multiline t) 711 727 (fontified nil face font-lock-type-face font-lock-multiline t) 727 924 (fontified nil font-lock-multiline t) 924 929 (fontified nil font-lock-multiline t face font-lock-keyword-face) 929 930 (fontified nil font-lock-multiline t) 930 933 (fontified nil face font-lock-variable-name-face font-lock-multiline t) 933 936 (fontified nil font-lock-multiline t) 936 941 (fontified nil font-lock-multiline t face font-lock-keyword-face) 941 942 (fontified nil font-lock-multiline t) 942 954 (fontified nil face font-lock-function-name-face font-lock-multiline t) 954 1064 (fontified nil font-lock-multiline t) 1064 1069 (fontified nil font-lock-multiline t face font-lock-keyword-face) 1069 1070 (fontified nil font-lock-multiline t) 1070 1077 (fontified nil face font-lock-variable-name-face font-lock-multiline t) 1077 1084 (fontified nil font-lock-multiline t) 1084 1089 (fontified nil face font-lock-function-name-face font-lock-multiline t) 1089 1090 (fontified nil font-lock-multiline t) 1090 1093 (fontified nil font-lock-multiline t face font-lock-string-face) 1093 1115 (fontified nil font-lock-multiline t) 1115 1118 (fontified nil font-lock-multiline t face font-lock-comment-delimiter-face) 1118 1171 (fontified nil font-lock-multiline t face font-lock-comment-face) 1171 1179 (fontified nil font-lock-multiline t) 1179 1184 (fontified nil font-lock-multiline t face font-lock-keyword-face) 1184 1188 (fontified nil font-lock-multiline t) 1188 1194 (fontified nil face font-lock-function-name-face font-lock-multiline t) 1194 1203 (fontified nil font-lock-multiline t) 1203 1209 (fontified nil face font-lock-function-name-face font-lock-multiline t) 1209 1253 (fontified nil font-lock-multiline t) 1253 1313 (fontified nil font-lock-multiline t) 1313 1317 (fontified nil font-lock-multiline t face font-lock-keyword-face) 1317 1355 (fontified nil font-lock-multiline t) 1355 1364 (fontified nil font-lock-multiline t face font-lock-constant-face) 1364 1385 (fontified nil font-lock-multiline t) 1385 1390 (fontified nil font-lock-multiline t face font-lock-keyword-face) 1390 1391 (fontified nil font-lock-multiline t) 1391 1398 (fontified nil face font-lock-variable-name-face font-lock-multiline t) 1398 1401 (fontified nil font-lock-multiline t) 1401 1406 (fontified nil font-lock-multiline t face font-lock-keyword-face) 1406 1410 (fontified nil font-lock-multiline t) 1410 1416 (fontified nil face font-lock-function-name-face font-lock-multiline t) 1416 1419 (fontified nil font-lock-multiline t) 1419 1423 (fontified nil font-lock-multiline t face font-lock-function-name-face) 1423 1424 (fontified nil font-lock-multiline t) 1424 1430 (fontified nil face font-lock-variable-name-face font-lock-multiline t) 1430 1449 (fontified nil font-lock-multiline t) 1449 1455 (fontified nil font-lock-multiline t face font-lock-keyword-face) 1455 1479 (fontified nil font-lock-multiline t) 1479 1483 (fontified nil font-lock-multiline t face font-lock-constant-face) 1483 1500 (fontified nil font-lock-multiline t) 1500 1505 (fontified nil font-lock-multiline t) 1505 1590 (fontified nil font-lock-multiline t) 1590 1595 (fontified nil font-lock-multiline t face font-lock-keyword-face) 1595 1614 (fontified nil font-lock-multiline t) 1614 1620 (fontified nil font-lock-multiline t face font-lock-keyword-face) 1620 1644 (fontified nil font-lock-multiline t) 1644 1649 (fontified nil font-lock-multiline t face font-lock-constant-face) 1649 1670 (fontified nil font-lock-multiline t) 1670 1701 (fontified nil font-lock-multiline t face font-lock-string-face) 1701 1718 (fontified nil font-lock-multiline t) 1718 1719 (fontified nil font-lock-multiline t rear-nonsticky nil)) . 1999) (nil fontified t 2243 . 2244) (nil fontified t 2239 . 2243) (nil fontified t 2236 . 2239) (nil fontified t 2230 . 2236) (nil fontified t 2213 . 2230) (nil fontified t 2207 . 2213) (nil fontified t 2205 . 2207) (nil fontified t 2201 . 2205) (nil fontified t 2196 . 2201) (nil fontified t 2190 . 2196) (nil fontified t 2179 . 2190) (nil fontified t 2173 . 2179) (nil fontified t 2158 . 2173) (nil fontified t 2152 . 2158) (nil fontified t 2137 . 2152) (nil fontified t 2131 . 2137) (nil fontified t 2129 . 2131) (nil fontified t 2121 . 2129) (nil fontified t 2115 . 2121) (nil fontified t 2113 . 2115) (nil fontified t 2111 . 2113) (nil fontified t 2102 . 2111) (nil fontified t 2096 . 2102) (nil fontified t 2092 . 2096) (nil fontified t 2086 . 2092) (nil fontified t 2083 . 2086) (nil fontified t 2082 . 2083) (nil fontified t 2076 . 2082) (nil fontified t 2068 . 2076) (nil fontified t 2062 . 2068) (nil fontified t 2054 . 2062) (nil fontified t 2048 . 2054) (nil fontified t 2040 . 2048) (nil fontified t 2034 . 2040) (nil fontified t 2033 . 2034) (nil fontified t 2021 . 2033) (nil fontified t 2020 . 2021) (nil fontified t 2012 . 2020) (nil fontified t 2011 . 2012) (nil fontified t 2006 . 2011) (nil fontified t 2005 . 2006) (nil fontified t 1999 . 2005) (nil rear-nonsticky t 3717 . 3718)) (26493 62567 438754 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 1719 . 1720) (nil fontified nil 1 . 1720) (1 . 1720)) ((#("export async function getSignedURL({
    fileType,
    fileSize,
    checksum,
    name,
    type,
    productId
}: {
    fileType: string
    fileSize: number
    checksum: string
    name: string
    type: string
    productId?: number | null
}): Promise<ActionResponse<FileUploadResponse>> {
    // Validation
    if (!s3Config.allowedTypes.includes(fileType as any)) {
        return {
            success: false,
            error: \"File type not allowed\"
        }
    }

    if (fileSize > s3Config.maxSize) {
        return {
            success: false,
            error: \"File size too large\"
        }
    }

    try {
        const fileName = generateFileName()
        const putObjectCommand = new PutObjectCommand({
            Bucket: s3Config.bucket,
            Key: fileName,
            ContentType: fileType,
            ContentLength: fileSize,
            ChecksumSHA256: checksum,
        })

        const url = await getSignedUrl(
            s3Config.client,
            putObjectCommand,
            { expiresIn: 60 }
        )

        const baseUrl = url.split(\"?\")[0]
        
        // Store file info in database with all required fields
        await db.insert(images).values({
            name,
            url: baseUrl,
            width: 0,
            height: 0,
            type,
            productId: productId || undefined
        })

        const results = await db.select().from(images)
        
        return {
            success: true,
            data: {
                url,
                id: results[0].id
            }
        }
    } catch (error) {
        return {
            success: false,
            error: 'Failed to generate signed URL'
        }
    }
}" 0 6 (face font-lock-keyword-face fontified nil) 6 7 (fontified nil) 7 12 (face font-lock-keyword-face fontified nil) 12 13 (fontified nil) 13 21 (face font-lock-keyword-face fontified nil) 21 22 (fontified nil) 22 34 (face font-lock-function-name-face font-lock-multiline t fontified nil) 34 35 (font-lock-multiline t fontified nil) 35 41 (font-lock-multiline t fontified nil) 41 49 (face font-lock-variable-name-face font-lock-multiline t fontified nil) 49 55 (font-lock-multiline t fontified nil) 55 63 (face font-lock-variable-name-face font-lock-multiline t fontified nil) 63 69 (font-lock-multiline t fontified nil) 69 77 (face font-lock-variable-name-face font-lock-multiline t fontified nil) 77 83 (font-lock-multiline t fontified nil) 83 87 (face font-lock-variable-name-face font-lock-multiline t fontified nil) 87 93 (font-lock-multiline t fontified nil) 93 97 (font-lock-multiline t face font-lock-variable-name-face fontified nil) 97 103 (font-lock-multiline t fontified nil) 103 112 (face font-lock-variable-name-face font-lock-multiline t fontified nil) 112 114 (font-lock-multiline t fontified nil) 114 116 (font-lock-multiline t fontified nil) 116 122 (font-lock-multiline t fontified nil) 122 130 (face font-lock-variable-name-face font-lock-multiline t fontified nil) 130 132 (font-lock-multiline t fontified nil) 132 138 (font-lock-multiline t face typescript-primitive-face fontified nil) 138 153 (font-lock-multiline t fontified nil) 153 159 (font-lock-multiline t face typescript-primitive-face fontified nil) 159 174 (font-lock-multiline t fontified nil) 174 180 (font-lock-multiline t face typescript-primitive-face fontified nil) 180 191 (font-lock-multiline t fontified nil) 191 197 (font-lock-multiline t face typescript-primitive-face fontified nil) 197 202 (font-lock-multiline t fontified nil) 202 206 (font-lock-multiline t face default fontified nil) 206 208 (font-lock-multiline t fontified nil) 208 214 (font-lock-multiline t face typescript-primitive-face fontified nil) 214 231 (font-lock-multiline t fontified nil) 231 237 (font-lock-multiline t face typescript-primitive-face fontified nil) 237 240 (font-lock-multiline t fontified nil) 240 244 (font-lock-multiline t face font-lock-constant-face fontified nil) 244 245 (font-lock-multiline t fontified nil) 245 246 (font-lock-multiline t fontified nil) 246 247 (font-lock-multiline t fontified nil) 247 249 (fontified nil) 249 256 (face font-lock-type-face fontified nil) 256 257 (fontified nil) 257 271 (face font-lock-type-face fontified nil) 271 272 (fontified nil) 272 290 (face font-lock-type-face fontified nil) 290 293 (fontified nil) 293 299 (font-lock-multiline t fontified nil) 299 302 (font-lock-multiline t face font-lock-comment-delimiter-face fontified nil) 302 313 (font-lock-multiline t face font-lock-comment-face fontified nil) 313 317 (font-lock-multiline t fontified nil) 317 319 (font-lock-multiline t face font-lock-keyword-face fontified nil) 319 344 (font-lock-multiline t fontified nil) 344 352 (face font-lock-function-name-face font-lock-multiline t fontified nil) 352 362 (font-lock-multiline t fontified nil) 362 364 (font-lock-multiline t face font-lock-keyword-face fontified nil) 364 365 (font-lock-multiline t fontified nil) 365 368 (font-lock-multiline t face typescript-primitive-face fontified nil) 368 381 (font-lock-multiline t fontified nil) 381 387 (font-lock-multiline t face font-lock-keyword-face fontified nil) 387 411 (font-lock-multiline t fontified nil) 411 416 (font-lock-multiline t face font-lock-constant-face fontified nil) 416 437 (font-lock-multiline t fontified nil) 437 460 (font-lock-multiline t face font-lock-string-face fontified nil) 460 482 (font-lock-multiline t fontified nil) 482 484 (font-lock-multiline t face font-lock-keyword-face fontified nil) 484 525 (font-lock-multiline t fontified nil) 525 531 (font-lock-multiline t face font-lock-keyword-face fontified nil) 531 555 (font-lock-multiline t fontified nil) 555 560 (font-lock-multiline t face font-lock-constant-face fontified nil) 560 581 (font-lock-multiline t fontified nil) 581 602 (font-lock-multiline t face font-lock-string-face fontified nil) 602 624 (font-lock-multiline t fontified nil) 624 627 (font-lock-multiline t face font-lock-keyword-face fontified nil) 627 638 (font-lock-multiline t fontified nil) 638 643 (font-lock-multiline t face font-lock-keyword-face fontified nil) 643 644 (font-lock-multiline t fontified nil) 644 652 (face font-lock-variable-name-face font-lock-multiline t fontified nil) 652 655 (font-lock-multiline t fontified nil) 655 671 (face font-lock-function-name-face font-lock-multiline t fontified nil) 671 682 (font-lock-multiline t fontified nil) 682 687 (font-lock-multiline t face font-lock-keyword-face fontified nil) 687 688 (font-lock-multiline t fontified nil) 688 704 (face font-lock-variable-name-face font-lock-multiline t fontified nil) 704 707 (font-lock-multiline t fontified nil) 707 710 (font-lock-multiline t face font-lock-keyword-face fontified nil) 710 711 (font-lock-multiline t fontified nil) 711 727 (face font-lock-type-face font-lock-multiline t fontified nil) 727 924 (font-lock-multiline t fontified nil) 924 929 (font-lock-multiline t face font-lock-keyword-face fontified nil) 929 930 (font-lock-multiline t fontified nil) 930 933 (face font-lock-variable-name-face font-lock-multiline t fontified nil) 933 936 (font-lock-multiline t fontified nil) 936 941 (font-lock-multiline t face font-lock-keyword-face fontified nil) 941 942 (font-lock-multiline t fontified nil) 942 954 (face font-lock-function-name-face font-lock-multiline t fontified nil) 954 1064 (font-lock-multiline t fontified nil) 1064 1069 (font-lock-multiline t face font-lock-keyword-face fontified nil) 1069 1070 (font-lock-multiline t fontified nil) 1070 1077 (face font-lock-variable-name-face font-lock-multiline t fontified nil) 1077 1084 (font-lock-multiline t fontified nil) 1084 1089 (face font-lock-function-name-face font-lock-multiline t fontified nil) 1089 1090 (font-lock-multiline t fontified nil) 1090 1093 (font-lock-multiline t face font-lock-string-face fontified nil) 1093 1115 (font-lock-multiline t fontified nil) 1115 1118 (font-lock-multiline t face font-lock-comment-delimiter-face fontified nil) 1118 1171 (font-lock-multiline t face font-lock-comment-face fontified nil) 1171 1179 (font-lock-multiline t fontified nil) 1179 1184 (font-lock-multiline t face font-lock-keyword-face fontified nil) 1184 1188 (font-lock-multiline t fontified nil) 1188 1194 (face font-lock-function-name-face font-lock-multiline t fontified nil) 1194 1203 (font-lock-multiline t fontified nil) 1203 1209 (face font-lock-function-name-face font-lock-multiline t fontified nil) 1209 1313 (font-lock-multiline t fontified nil) 1313 1317 (font-lock-multiline t face font-lock-keyword-face fontified nil) 1317 1355 (font-lock-multiline t fontified nil) 1355 1364 (font-lock-multiline t face font-lock-constant-face fontified nil) 1364 1385 (font-lock-multiline t fontified nil) 1385 1390 (font-lock-multiline t face font-lock-keyword-face fontified nil) 1390 1391 (font-lock-multiline t fontified nil) 1391 1398 (face font-lock-variable-name-face font-lock-multiline t fontified nil) 1398 1401 (font-lock-multiline t fontified nil) 1401 1406 (font-lock-multiline t face font-lock-keyword-face fontified nil) 1406 1410 (font-lock-multiline t fontified nil) 1410 1416 (face font-lock-function-name-face font-lock-multiline t fontified nil) 1416 1419 (font-lock-multiline t fontified nil) 1419 1423 (font-lock-multiline t face font-lock-function-name-face fontified nil) 1423 1424 (font-lock-multiline t fontified nil) 1424 1430 (face font-lock-variable-name-face font-lock-multiline t fontified nil) 1430 1449 (font-lock-multiline t fontified nil) 1449 1455 (font-lock-multiline t face font-lock-keyword-face fontified nil) 1455 1479 (font-lock-multiline t fontified nil) 1479 1483 (font-lock-multiline t face font-lock-constant-face fontified nil) 1483 1500 (font-lock-multiline t fontified nil) 1500 1505 (font-lock-multiline t fontified nil) 1505 1590 (font-lock-multiline t fontified nil) 1590 1595 (font-lock-multiline t face font-lock-keyword-face fontified nil) 1595 1614 (font-lock-multiline t fontified nil) 1614 1620 (font-lock-multiline t face font-lock-keyword-face fontified nil) 1620 1644 (font-lock-multiline t fontified nil) 1644 1649 (font-lock-multiline t face font-lock-constant-face fontified nil) 1649 1670 (font-lock-multiline t fontified nil) 1670 1701 (font-lock-multiline t face font-lock-string-face fontified nil) 1701 1718 (font-lock-multiline t fontified nil) 1718 1719 (font-lock-multiline t rear-nonsticky nil fontified nil)) . 1) (undo-tree-id96 . -1056) (undo-tree-id97 . -1056) (undo-tree-id98 . -1056) (nil fontified t 245 . 246) (nil fontified t 241 . 245) (nil fontified t 238 . 241) (nil fontified t 232 . 238) (nil fontified t 215 . 232) (nil fontified t 209 . 215) (nil fontified t 207 . 209) (nil fontified t 203 . 207) (nil fontified t 198 . 203) (nil fontified t 192 . 198) (nil fontified t 181 . 192) (nil fontified t 175 . 181) (nil fontified t 160 . 175) (nil fontified t 154 . 160) (nil fontified t 139 . 154) (nil fontified t 133 . 139) (nil fontified t 131 . 133) (nil fontified t 123 . 131) (nil fontified t 117 . 123) (nil fontified t 115 . 117) (nil fontified t 113 . 115) (nil fontified t 104 . 113) (nil fontified t 98 . 104) (nil fontified t 94 . 98) (nil fontified t 88 . 94) (nil fontified t 84 . 88) (nil fontified t 78 . 84) (nil fontified t 70 . 78) (nil fontified t 64 . 70) (nil fontified t 56 . 64) (nil fontified t 50 . 56) (nil fontified t 42 . 50) (nil fontified t 36 . 42) (nil fontified t 35 . 36) (nil fontified t 23 . 35) (nil fontified t 22 . 23) (nil fontified t 14 . 22) (nil fontified t 13 . 14) (nil fontified t 8 . 13) (nil fontified t 7 . 8) (nil fontified t 1 . 7) (nil rear-nonsticky t 1719 . 1720)) (26493 62180 913785 0) 0 nil])
([nil nil ((13 . 14)) ((#("
" 0 1 (fontified t)) . 13) (t 26493 62264 351375 442000)) (26493 62567 525556 0) 0 nil])
nil
([nil nil ((#("// ... (keeping existing functions)" 0 3 (face font-lock-comment-delimiter-face fontified t) 3 35 (face font-lock-comment-face fontified t)) . 548) (undo-tree-id144 . -35) (t 26493 62264 351375 442000)) ((548 . 583)) (26493 62567 607244 0) 0 nil])
([nil nil ((#("
" 0 1 (fontified t)) . 547) (undo-tree-id145 . -1) (undo-tree-id146 . -1) (undo-tree-id147 . -1)) ((547 . 548)) (26493 62567 693450 0) 0 nil])
([nil nil ((548 . 549) (t 26493 62571 340891 434000)) nil (26493 63094 632496 0) 0 nil])
([nil nil ((#("
" 0 1 (fontified t)) . -546) (undo-tree-id150 . -1) (undo-tree-id151 . -1) (#("
" 0 1 (fontified t)) . -547) (undo-tree-id152 . -1) (undo-tree-id153 . -1) (#("x" 0 1 (fontified t)) . -548) (undo-tree-id154 . -1) (undo-tree-id155 . -1) 549) nil (26493 63094 632495 0) 0 nil])
([nil nil ((546 . 549)) nil (26493 63094 632490 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 696 . 697) (nil fontified nil 548 . 697) (548 . 697)) nil (26493 63094 632489 0) 0 nil])
([nil nil ((#("\"use server\"

import { z } from 'zod'
import { stripe } from '@/lib/stripe'
import { checkRole } from \"@/../utils/roles\";
import { clerkClient } from \"@clerk/nextjs/server\";
import { productCatalouge, images, orders, users } from '@/db/schema'; 
import { db }  from \"@/db/index\";
import { eq } from 'drizzle-orm';
import { S3Client, PutObjectCommand } from \"@aws-sdk/client-s3\"
import { getSignedUrl } from \"@aws-sdk/s3-request-presigner\"
import crypto from \"crypto\"
import { Orders } from \"@/app/types\"
import { format, Order } from \"@/app/zod\"

interface ActionResponse<T> {
    success: boolean
    data?: T
    error?: string
}

interface FileUploadResponse {
    url: string
    id: number
}

const s3Client = new S3Client({
    region: process.env.AWS_REGION!,
    credentials: {
        accessKeyId: process.env.AWS_ACCESS_KEY_ID!,
        secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY!,
    },
})

const allowedFileTypes = [
    \"image/jpeg\",
    \"image/png\",
]

const maxFileSize = 1048576 * 10 // 10 MB

const generateFileName = (bytes = 32) => crypto.randomBytes(bytes).toString(\"hex\")

// Moved from Form component and enhanced for server-side use
export async function computeSHA256(buffer: ArrayBuffer) {
    const hashBuffer = await crypto.subtle.digest(\"SHA-256\", buffer)
    const hashArray = Array.from(new Uint8Array(hashBuffer))
    const hashHex = hashArray.map((b) => b.toString(16).padStart(2, \"0\")).join(\"\")
    return hashHex
}

// Enhanced file upload handler
export async function handleFileUpload(file: File) {
    const signedURLResult = await getSignedURL({
        fileSize: file.size,
        fileType: file.type,
        checksum: await computeSHA256(await file.arrayBuffer()),
    })

    if (signedURLResult.failure !== undefined) {
        throw new Error(signedURLResult.failure)
    }

    return signedURLResult.success
}
" 0 12 (face font-lock-string-face fontified t) 12 13 (fontified t) 13 14 (fontified t) 14 20 (face font-lock-keyword-face fontified t) 20 27 (fontified t) 27 31 (face font-lock-keyword-face fontified t) 31 32 (fontified t) 32 37 (face font-lock-string-face fontified t) 37 38 (fontified t) 38 44 (face font-lock-keyword-face fontified t) 44 56 (fontified t) 56 60 (face font-lock-keyword-face fontified t) 60 61 (fontified t) 61 75 (face font-lock-string-face fontified t) 75 76 (fontified t) 76 82 (face font-lock-keyword-face fontified t) 82 97 (fontified t) 97 101 (face font-lock-keyword-face fontified t) 101 102 (fontified t) 102 120 (face font-lock-string-face fontified t) 120 122 (fontified t) 122 128 (face font-lock-keyword-face fontified t) 128 145 (fontified t) 145 149 (face font-lock-keyword-face fontified t) 149 150 (fontified t) 150 172 (face font-lock-string-face fontified t) 172 174 (fontified t) 174 180 (face font-lock-keyword-face fontified t) 180 225 (fontified t) 225 229 (face font-lock-keyword-face fontified t) 229 230 (fontified t) 230 243 (face font-lock-string-face fontified t) 243 246 (fontified t) 246 252 (face font-lock-keyword-face fontified t) 252 261 (fontified t) 261 265 (face font-lock-keyword-face fontified t) 265 266 (fontified t) 266 278 (face font-lock-string-face fontified t) 278 280 (fontified t) 280 286 (face font-lock-keyword-face fontified t) 286 294 (fontified t) 294 298 (face font-lock-keyword-face fontified t) 298 299 (fontified t) 299 312 (face font-lock-string-face fontified t) 312 314 (fontified t) 314 320 (face font-lock-keyword-face fontified t) 320 352 (fontified t) 352 356 (face font-lock-keyword-face fontified t) 356 357 (fontified t) 357 377 (face font-lock-string-face fontified t) 377 378 (fontified t) 378 384 (face font-lock-keyword-face fontified t) 384 402 (fontified t) 402 406 (face font-lock-keyword-face fontified t) 406 407 (fontified t) 407 438 (face font-lock-string-face fontified t) 438 439 (fontified t) 439 445 (face font-lock-keyword-face fontified t) 445 453 (fontified t) 453 457 (face font-lock-keyword-face fontified t) 457 458 (fontified t) 458 466 (face font-lock-string-face fontified t) 466 467 (fontified t) 467 473 (face font-lock-keyword-face fontified t) 473 485 (fontified t) 485 489 (face font-lock-keyword-face fontified t) 489 490 (fontified t) 490 503 (face font-lock-string-face fontified t) 503 504 (fontified t) 504 510 (face font-lock-keyword-face fontified t) 510 529 (fontified t) 529 533 (face font-lock-keyword-face fontified t) 533 534 (fontified t) 534 545 (face font-lock-string-face fontified t) 545 546 (fontified t) 546 547 (fontified t) 547 556 (face font-lock-keyword-face fontified t) 556 557 (fontified t) 557 571 (face font-lock-type-face fontified t) 571 572 (fontified t) 572 573 (face font-lock-type-face fontified t) 573 575 (fontified t) 575 590 (font-lock-multiline t fontified t) 590 597 (font-lock-multiline t face typescript-primitive-face fontified t) 597 623 (font-lock-multiline t fontified t) 623 629 (font-lock-multiline t face typescript-primitive-face fontified t) 629 631 (font-lock-multiline t fontified t) 631 633 (fontified t) 633 642 (face font-lock-keyword-face fontified t) 642 643 (fontified t) 643 661 (face font-lock-type-face fontified t) 661 662 (fontified t) 662 673 (font-lock-multiline t fontified t) 673 679 (font-lock-multiline t face typescript-primitive-face fontified t) 679 688 (font-lock-multiline t fontified t) 688 694 (font-lock-multiline t face typescript-primitive-face fontified t) 694 695 (font-lock-multiline t fontified t) 695 696 (font-lock-multiline t rear-nonsticky t fontified t) 696 697 (fontified t) 697 698 (fontified t) 698 703 (face font-lock-keyword-face fontified t) 703 704 (fontified t) 704 712 (face font-lock-variable-name-face fontified t) 712 715 (fontified t) 715 718 (face font-lock-keyword-face fontified t) 718 719 (fontified t) 719 727 (face font-lock-type-face fontified t) 727 728 (fontified t) 728 900 (font-lock-multiline t fontified t) 900 908 (font-lock-multiline t fontified t) 908 911 (fontified t) 911 916 (face font-lock-keyword-face fontified t) 916 917 (fontified t) 917 933 (face font-lock-variable-name-face fontified t) 933 942 (fontified t) 942 954 (face font-lock-string-face fontified t) 954 960 (fontified t) 960 971 (face font-lock-string-face fontified t) 971 976 (fontified t) 976 981 (face font-lock-keyword-face fontified t) 981 982 (fontified t) 982 993 (face font-lock-variable-name-face fontified t) 993 1009 (fontified t) 1009 1012 (face font-lock-comment-delimiter-face fontified t) 1012 1018 (face font-lock-comment-face fontified t) 1018 1019 (fontified t) 1019 1024 (face font-lock-keyword-face fontified t) 1024 1025 (fontified t) 1025 1041 (face font-lock-variable-name-face fontified t) 1041 1057 (fontified t) 1057 1059 (face font-lock-keyword-face fontified t) 1059 1067 (fontified t) 1067 1078 (face font-lock-function-name-face fontified t) 1078 1086 (fontified t) 1086 1094 (face font-lock-function-name-face fontified t) 1094 1095 (fontified t) 1095 1100 (face font-lock-string-face fontified t) 1100 1103 (fontified t) 1103 1106 (face font-lock-comment-delimiter-face fontified t) 1106 1165 (face font-lock-comment-face fontified t) 1165 1171 (face font-lock-keyword-face fontified t) 1171 1172 (fontified t) 1172 1177 (face font-lock-keyword-face fontified t) 1177 1178 (fontified t) 1178 1186 (face font-lock-keyword-face fontified t) 1186 1187 (fontified t) 1187 1200 (face font-lock-function-name-face fontified t) 1200 1201 (fontified t) 1201 1207 (face font-lock-variable-name-face fontified t) 1207 1209 (fontified t) 1209 1220 (face font-lock-type-face fontified t) 1220 1222 (fontified t) 1222 1223 (typescript--pstate ((nil 0 function 1179 ("computeSHA256") 1458) (nil -2305843009213693952 toplevel nil nil nil)) font-lock-multiline t fontified t) 1223 1228 (font-lock-multiline t fontified t) 1228 1233 (font-lock-multiline t face font-lock-keyword-face fontified t) 1233 1234 (font-lock-multiline t fontified t) 1234 1244 (face font-lock-variable-name-face font-lock-multiline t fontified t) 1244 1247 (font-lock-multiline t fontified t) 1247 1252 (font-lock-multiline t face font-lock-keyword-face fontified t) 1252 1267 (font-lock-multiline t fontified t) 1267 1273 (face font-lock-function-name-face font-lock-multiline t fontified t) 1273 1274 (font-lock-multiline t fontified t) 1274 1283 (font-lock-multiline t face font-lock-string-face fontified t) 1283 1297 (font-lock-multiline t fontified t) 1297 1302 (font-lock-multiline t face font-lock-keyword-face fontified t) 1302 1303 (font-lock-multiline t fontified t) 1303 1312 (face font-lock-variable-name-face font-lock-multiline t fontified t) 1312 1321 (font-lock-multiline t fontified t) 1321 1325 (font-lock-multiline t face font-lock-function-name-face fontified t) 1325 1326 (font-lock-multiline t fontified t) 1326 1329 (font-lock-multiline t face font-lock-keyword-face fontified t) 1329 1330 (font-lock-multiline t fontified t) 1330 1340 (face font-lock-type-face font-lock-multiline t fontified t) 1340 1358 (font-lock-multiline t fontified t) 1358 1363 (font-lock-multiline t face font-lock-keyword-face fontified t) 1363 1364 (font-lock-multiline t fontified t) 1364 1371 (face font-lock-variable-name-face font-lock-multiline t fontified t) 1371 1384 (font-lock-multiline t fontified t) 1384 1387 (face font-lock-function-name-face font-lock-multiline t fontified t) 1387 1392 (font-lock-multiline t fontified t) 1392 1394 (face font-lock-keyword-face font-lock-multiline t fontified t) 1394 1397 (font-lock-multiline t fontified t) 1397 1405 (face font-lock-function-name-face font-lock-multiline t fontified t) 1405 1410 (font-lock-multiline t fontified t) 1410 1418 (face font-lock-function-name-face font-lock-multiline t fontified t) 1418 1422 (font-lock-multiline t fontified t) 1422 1425 (font-lock-multiline t face font-lock-string-face fontified t) 1425 1428 (font-lock-multiline t fontified t) 1428 1432 (face font-lock-function-name-face font-lock-multiline t fontified t) 1432 1433 (font-lock-multiline t fontified t) 1433 1435 (font-lock-multiline t face font-lock-string-face fontified t) 1435 1441 (font-lock-multiline t fontified t) 1441 1447 (font-lock-multiline t face font-lock-keyword-face fontified t) 1447 1456 (font-lock-multiline t fontified t) 1456 1457 (typescript--pend (nil 0 function 1179 ("computeSHA256") 1458) font-lock-multiline t fontified t) 1457 1459 (fontified t) 1459 1462 (face font-lock-comment-delimiter-face fontified t) 1462 1491 (face font-lock-comment-face fontified t) 1491 1497 (face font-lock-keyword-face fontified t) 1497 1498 (fontified t) 1498 1503 (face font-lock-keyword-face fontified t) 1503 1504 (fontified t) 1504 1512 (face font-lock-keyword-face fontified t) 1512 1513 (fontified t) 1513 1529 (face font-lock-function-name-face fontified t) 1529 1530 (fontified t) 1530 1534 (face font-lock-variable-name-face fontified t) 1534 1536 (fontified t) 1536 1540 (face font-lock-type-face fontified t) 1540 1542 (fontified t) 1542 1543 (typescript--pstate ((nil 0 function 1505 ("handleFileUpload") 1866) (((nil 0 function 1179 ("computeSHA256") 1458)) -2305843009213693952 toplevel nil nil nil)) font-lock-multiline t fontified t) 1543 1548 (font-lock-multiline t fontified t) 1548 1553 (font-lock-multiline t face font-lock-keyword-face fontified t) 1553 1554 (font-lock-multiline t fontified t) 1554 1569 (face font-lock-variable-name-face font-lock-multiline t fontified t) 1569 1572 (font-lock-multiline t fontified t) 1572 1577 (font-lock-multiline t face font-lock-keyword-face fontified t) 1577 1578 (font-lock-multiline t fontified t) 1578 1590 (face font-lock-function-name-face font-lock-multiline t fontified t) 1590 1615 (font-lock-multiline t fontified t) 1615 1622 (font-lock-multiline t fontified t) 1622 1628 (font-lock-multiline t fontified t) 1628 1645 (font-lock-multiline t fontified t) 1645 1649 (font-lock-multiline t face font-lock-keyword-face fontified t) 1649 1664 (font-lock-multiline t fontified t) 1664 1669 (font-lock-multiline t fontified t) 1669 1674 (font-lock-multiline t face font-lock-keyword-face fontified t) 1674 1675 (font-lock-multiline t fontified t) 1675 1688 (face font-lock-function-name-face font-lock-multiline t fontified t) 1688 1689 (font-lock-multiline t fontified t) 1689 1694 (font-lock-multiline t face font-lock-keyword-face fontified t) 1694 1700 (font-lock-multiline t fontified t) 1700 1711 (face font-lock-function-name-face font-lock-multiline t fontified t) 1711 1728 (font-lock-multiline t fontified t) 1728 1730 (font-lock-multiline t face font-lock-keyword-face fontified t) 1730 1760 (font-lock-multiline t fontified t) 1760 1769 (font-lock-multiline t face font-lock-constant-face fontified t) 1769 1781 (font-lock-multiline t fontified t) 1781 1786 (font-lock-multiline t face font-lock-keyword-face fontified t) 1786 1787 (font-lock-multiline t fontified t) 1787 1790 (font-lock-multiline t face font-lock-keyword-face fontified t) 1790 1791 (font-lock-multiline t fontified t) 1791 1796 (face font-lock-type-face font-lock-multiline t fontified t) 1796 1833 (font-lock-multiline t fontified t) 1833 1839 (font-lock-multiline t face font-lock-keyword-face fontified t) 1839 1864 (font-lock-multiline t fontified t) 1864 1865 (typescript--pend (nil 0 function 1505 ("handleFileUpload") 1866) font-lock-multiline t fontified t) 1865 1866 (fontified t)) . 1) (undo-tree-id148 . -1866) (undo-tree-id149 . -545)) nil (26493 63094 632488 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 5228 . 5229) (nil fontified nil 1 . 5229) (1 . 5229)) nil (26493 63094 632481 0) 0 nil])
([nil nil ((5229 . 5231)) nil (26493 63094 632478 0) 0 nil])
([nil nil ((#("L" 0 1 (font-lock-multiline t fontified t)) . -4389) (undo-tree-id228 . -1) (undo-tree-id229 . -1) (undo-tree-id230 . -1) (undo-tree-id231 . -1) (undo-tree-id232 . -1) (undo-tree-id233 . -1) (undo-tree-id234 . -1) (undo-tree-id235 . -1) (#("o" 0 1 (font-lock-multiline t fontified t)) . -4390) (undo-tree-id236 . -1) (undo-tree-id237 . -1) (undo-tree-id238 . -1) (undo-tree-id239 . -1) (undo-tree-id240 . -1) (undo-tree-id241 . -1) (undo-tree-id242 . -1) (undo-tree-id243 . -1) (#("c" 0 1 (font-lock-multiline t fontified t)) . -4391) (undo-tree-id244 . -1) (undo-tree-id245 . -1) (undo-tree-id246 . -1) (undo-tree-id247 . -1) (undo-tree-id248 . -1) (undo-tree-id249 . -1) (undo-tree-id250 . -1) (undo-tree-id251 . -1) (#("a" 0 1 (font-lock-multiline t fontified t)) . -4392) (undo-tree-id252 . -1) (undo-tree-id253 . -1) (undo-tree-id254 . -1) (undo-tree-id255 . -1) (undo-tree-id256 . -1) (undo-tree-id257 . -1) (undo-tree-id258 . -1) (undo-tree-id259 . -1) (#("t" 0 1 (font-lock-multiline t fontified t)) . -4393) (undo-tree-id260 . -1) (undo-tree-id261 . -1) (undo-tree-id262 . -1) (undo-tree-id263 . -1) (undo-tree-id264 . -1) (undo-tree-id265 . -1) (undo-tree-id266 . -1) (undo-tree-id267 . -1) (#("i" 0 1 (font-lock-multiline t fontified t)) . -4394) (undo-tree-id268 . -1) (undo-tree-id269 . -1) (undo-tree-id270 . -1) (undo-tree-id271 . -1) (undo-tree-id272 . -1) (undo-tree-id273 . -1) (undo-tree-id274 . -1) (undo-tree-id275 . -1) (#("o" 0 1 (font-lock-multiline t fontified t)) . -4395) (undo-tree-id276 . -1) (undo-tree-id277 . -1) (undo-tree-id278 . -1) (undo-tree-id279 . -1) (undo-tree-id280 . -1) (undo-tree-id281 . -1) (undo-tree-id282 . -1) (undo-tree-id283 . -1) (#("n" 0 1 (font-lock-multiline t fontified t)) . -4396) (undo-tree-id284 . -1) (undo-tree-id285 . -1) (undo-tree-id286 . -1) (undo-tree-id287 . -1) (undo-tree-id288 . -1) (undo-tree-id289 . -1) (undo-tree-id290 . -1) 4397 (t 26493 63094 638153 735000)) nil (26493 63135 398673 0) 0 nil])
([nil nil ((4389 . 4393)) nil (26493 63135 398640 0) 0 nil])
([nil nil ((4393 . 4397)) nil (26493 63135 398639 0) 0 nil])
([nil nil ((#("L" 0 1 (font-lock-multiline t fontified t)) . -4409) (undo-tree-id156 . -1) (undo-tree-id157 . -1) (undo-tree-id158 . -1) (undo-tree-id159 . -1) (undo-tree-id160 . -1) (undo-tree-id161 . -1) (undo-tree-id162 . -1) (undo-tree-id163 . -1) (undo-tree-id164 . -1) (#("o" 0 1 (font-lock-multiline t fontified t)) . -4410) (undo-tree-id165 . -1) (undo-tree-id166 . -1) (undo-tree-id167 . -1) (undo-tree-id168 . -1) (undo-tree-id169 . -1) (undo-tree-id170 . -1) (undo-tree-id171 . -1) (undo-tree-id172 . -1) (undo-tree-id173 . -1) (#("c" 0 1 (font-lock-multiline t fontified t)) . -4411) (undo-tree-id174 . -1) (undo-tree-id175 . -1) (undo-tree-id176 . -1) (undo-tree-id177 . -1) (undo-tree-id178 . -1) (undo-tree-id179 . -1) (undo-tree-id180 . -1) (undo-tree-id181 . -1) (undo-tree-id182 . -1) (#("a" 0 1 (font-lock-multiline t fontified t)) . -4412) (undo-tree-id183 . -1) (undo-tree-id184 . -1) (undo-tree-id185 . -1) (undo-tree-id186 . -1) (undo-tree-id187 . -1) (undo-tree-id188 . -1) (undo-tree-id189 . -1) (undo-tree-id190 . -1) (undo-tree-id191 . -1) (#("t" 0 1 (font-lock-multiline t fontified t)) . -4413) (undo-tree-id192 . -1) (undo-tree-id193 . -1) (undo-tree-id194 . -1) (undo-tree-id195 . -1) (undo-tree-id196 . -1) (undo-tree-id197 . -1) (undo-tree-id198 . -1) (undo-tree-id199 . -1) (undo-tree-id200 . -1) (#("i" 0 1 (font-lock-multiline t fontified t)) . -4414) (undo-tree-id201 . -1) (undo-tree-id202 . -1) (undo-tree-id203 . -1) (undo-tree-id204 . -1) (undo-tree-id205 . -1) (undo-tree-id206 . -1) (undo-tree-id207 . -1) (undo-tree-id208 . -1) (undo-tree-id209 . -1) (#("o" 0 1 (font-lock-multiline t fontified t)) . -4415) (undo-tree-id210 . -1) (undo-tree-id211 . -1) (undo-tree-id212 . -1) (undo-tree-id213 . -1) (undo-tree-id214 . -1) (undo-tree-id215 . -1) (undo-tree-id216 . -1) (undo-tree-id217 . -1) (undo-tree-id218 . -1) (#("n" 0 1 (font-lock-multiline t fontified t)) . -4416) (undo-tree-id219 . -1) (undo-tree-id220 . -1) (undo-tree-id221 . -1) (undo-tree-id222 . -1) (undo-tree-id223 . -1) (undo-tree-id224 . -1) (undo-tree-id225 . -1) (undo-tree-id226 . -1) (undo-tree-id227 . -1) 4417) nil (26493 63135 398634 0) 0 nil])
([nil nil ((5223 . 5225) (t 26493 63135 405042 626000)) nil (26493 63167 65032 0) 0 nil])
([nil nil ((#("X" 0 1 (fontified t)) . -5221) (undo-tree-id291 . -1) (undo-tree-id292 . -1) (undo-tree-id293 . -1) (undo-tree-id294 . -1) (undo-tree-id295 . -1) (undo-tree-id296 . -1) (undo-tree-id297 . -1) (undo-tree-id298 . -1) (#("S" 0 1 (fontified t)) . -5222) (undo-tree-id299 . -1) (undo-tree-id300 . -1) (undo-tree-id301 . -1) (undo-tree-id302 . -1) (undo-tree-id303 . -1) (undo-tree-id304 . -1) (undo-tree-id305 . -1) (undo-tree-id306 . -1) (#("\\" 0 1 (fontified t)) . -5223) (undo-tree-id307 . -1) (undo-tree-id308 . -1) (#("\\" 0 1 (fontified t)) . -5224) (undo-tree-id309 . -1) 5225) nil (26493 63167 65028 0) 0 nil])
([nil nil ((#("export async function setRole(
    formData: FormData
): Promise<ActionResponse<unknown>> {
    if (!checkRole(\"admin\")) {
        return {
            success: false,
            error: \"Not Authorized\"
        }
    }

    try {
        const res = await clerkClient.users.updateUser(
            formData.get('id') as string,
            {
                publicMetadata: { role: formData.get('role') },
            }
        )
        return {
            success: true,
            data: res.publicMetadata
        }
    } catch (error) {
        return {
            success: false,
            error: 'Failed to update user role'
        }
    }
}" 0 6 (face font-lock-keyword-face fontified t) 6 7 (fontified t) 7 12 (face font-lock-keyword-face fontified t) 12 13 (fontified t) 13 21 (font-lock-multiline t face font-lock-keyword-face fontified t) 21 22 (font-lock-multiline t fontified t) 22 29 (face font-lock-function-name-face font-lock-multiline t fontified t) 29 35 (font-lock-multiline t fontified t) 35 43 (face font-lock-variable-name-face font-lock-multiline t fontified t) 43 45 (font-lock-multiline t fontified t) 45 53 (font-lock-multiline t face font-lock-type-face fontified t) 53 55 (font-lock-multiline t fontified t) 55 57 (fontified t) 57 64 (face font-lock-type-face fontified t) 64 65 (fontified t) 65 79 (face font-lock-type-face fontified t) 79 80 (fontified t) 80 87 (face typescript-primitive-face fontified t) 87 90 (fontified t) 90 96 (font-lock-multiline t fontified t) 96 98 (font-lock-multiline t face font-lock-keyword-face fontified t) 98 101 (font-lock-multiline t fontified t) 101 110 (face font-lock-function-name-face font-lock-multiline t fontified t) 110 111 (font-lock-multiline t fontified t) 111 118 (font-lock-multiline t face font-lock-string-face fontified t) 118 131 (font-lock-multiline t fontified t) 131 137 (font-lock-multiline t face font-lock-keyword-face fontified t) 137 161 (font-lock-multiline t fontified t) 161 166 (font-lock-multiline t face font-lock-constant-face fontified t) 166 187 (font-lock-multiline t fontified t) 187 203 (font-lock-multiline t face font-lock-string-face fontified t) 203 225 (font-lock-multiline t fontified t) 225 228 (font-lock-multiline t face font-lock-keyword-face fontified t) 228 239 (font-lock-multiline t fontified t) 239 244 (font-lock-multiline t face font-lock-keyword-face fontified t) 244 245 (font-lock-multiline t fontified t) 245 248 (face font-lock-variable-name-face font-lock-multiline t fontified t) 248 251 (font-lock-multiline t fontified t) 251 256 (font-lock-multiline t face font-lock-keyword-face fontified t) 256 275 (font-lock-multiline t fontified t) 275 285 (face font-lock-function-name-face font-lock-multiline t fontified t) 285 308 (font-lock-multiline t fontified t) 308 311 (font-lock-multiline t face font-lock-function-name-face fontified t) 311 312 (font-lock-multiline t fontified t) 312 316 (font-lock-multiline t face font-lock-string-face fontified t) 316 318 (font-lock-multiline t fontified t) 318 320 (font-lock-multiline t face font-lock-keyword-face fontified t) 320 321 (font-lock-multiline t fontified t) 321 327 (font-lock-multiline t face typescript-primitive-face fontified t) 327 392 (font-lock-multiline t fontified t) 392 395 (font-lock-multiline t face font-lock-function-name-face fontified t) 395 396 (font-lock-multiline t fontified t) 396 402 (font-lock-multiline t face font-lock-string-face fontified t) 402 439 (font-lock-multiline t fontified t) 439 445 (font-lock-multiline t face font-lock-keyword-face fontified t) 445 469 (font-lock-multiline t fontified t) 469 473 (font-lock-multiline t face font-lock-constant-face fontified t) 473 528 (font-lock-multiline t fontified t) 528 533 (font-lock-multiline t face font-lock-keyword-face fontified t) 533 552 (font-lock-multiline t fontified t) 552 558 (font-lock-multiline t face font-lock-keyword-face fontified t) 558 582 (font-lock-multiline t fontified t) 582 587 (font-lock-multiline t face font-lock-constant-face fontified t) 587 608 (font-lock-multiline t fontified t) 608 636 (font-lock-multiline t face font-lock-string-face fontified t) 636 654 (font-lock-multiline t fontified t)) . 1845) (undo-tree-id310 . -654) (undo-tree-id311 . -29) (undo-tree-id312 . -29) (undo-tree-id313 . -91) (undo-tree-id314 . -91) (undo-tree-id315 . -91) (undo-tree-id316 . -91) (undo-tree-id317 . -91) (undo-tree-id318 . -91) (undo-tree-id319 . -91) (undo-tree-id320 . -91) (undo-tree-id321 . -654) (undo-tree-id322 . -654) (undo-tree-id323 . -654) (undo-tree-id324 . -654) (t 26493 63167 71098 746000)) nil (26493 63253 381762 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 2253 . 2254) (nil fontified nil 1845 . 2254) (1845 . 2254)) nil (26493 63253 381747 0) 0 nil])
([nil nil ((#("L" 0 1 (font-lock-multiline t fontified t)) . -4144) (undo-tree-id325 . -1) (undo-tree-id326 . -1) (undo-tree-id327 . -1) (undo-tree-id328 . -1) (undo-tree-id329 . -1) (undo-tree-id330 . -1) (#("o" 0 1 (font-lock-multiline t fontified t)) . -4145) (undo-tree-id331 . -1) (undo-tree-id332 . -1) (undo-tree-id333 . -1) (undo-tree-id334 . -1) (undo-tree-id335 . -1) (undo-tree-id336 . -1) (#("c" 0 1 (font-lock-multiline t fontified t)) . -4146) (undo-tree-id337 . -1) (undo-tree-id338 . -1) (undo-tree-id339 . -1) (undo-tree-id340 . -1) (undo-tree-id341 . -1) (undo-tree-id342 . -1) (#("a" 0 1 (font-lock-multiline t fontified t)) . -4147) (undo-tree-id343 . -1) (undo-tree-id344 . -1) (undo-tree-id345 . -1) (undo-tree-id346 . -1) (undo-tree-id347 . -1) (undo-tree-id348 . -1) (#("t" 0 1 (font-lock-multiline t fontified t)) . -4148) (undo-tree-id349 . -1) (undo-tree-id350 . -1) (undo-tree-id351 . -1) (undo-tree-id352 . -1) (undo-tree-id353 . -1) (undo-tree-id354 . -1) (#("i" 0 1 (font-lock-multiline t fontified t)) . -4149) (undo-tree-id355 . -1) (undo-tree-id356 . -1) (undo-tree-id357 . -1) (undo-tree-id358 . -1) (undo-tree-id359 . -1) (undo-tree-id360 . -1) (#("o" 0 1 (font-lock-multiline t fontified t)) . -4150) (undo-tree-id361 . -1) (undo-tree-id362 . -1) (undo-tree-id363 . -1) (undo-tree-id364 . -1) (undo-tree-id365 . -1) (undo-tree-id366 . -1) (#("n" 0 1 (fontified t font-lock-multiline t)) . -4151) (undo-tree-id367 . -1) (undo-tree-id368 . -1) (undo-tree-id369 . -1) (undo-tree-id370 . -1) (undo-tree-id371 . -1) 4152 (t 26493 63253 386914 90000)) nil (26493 63339 207842 0) 0 nil])
([nil nil ((#("L" 0 1 (font-lock-multiline t fontified t)) . -3946) (undo-tree-id372 . -1) (undo-tree-id373 . -1) (undo-tree-id374 . -1) (undo-tree-id375 . -1) (undo-tree-id376 . -1) (undo-tree-id377 . -1) (undo-tree-id378 . -1) (undo-tree-id379 . -1) (#("o" 0 1 (font-lock-multiline t fontified t)) . -3947) (undo-tree-id380 . -1) (undo-tree-id381 . -1) (undo-tree-id382 . -1) (undo-tree-id383 . -1) (undo-tree-id384 . -1) (undo-tree-id385 . -1) (undo-tree-id386 . -1) (undo-tree-id387 . -1) (#("c" 0 1 (font-lock-multiline t fontified t)) . -3948) (undo-tree-id388 . -1) (undo-tree-id389 . -1) (undo-tree-id390 . -1) (undo-tree-id391 . -1) (undo-tree-id392 . -1) (undo-tree-id393 . -1) (undo-tree-id394 . -1) (undo-tree-id395 . -1) (#("a" 0 1 (font-lock-multiline t fontified t)) . -3949) (undo-tree-id396 . -1) (undo-tree-id397 . -1) (undo-tree-id398 . -1) (undo-tree-id399 . -1) (undo-tree-id400 . -1) (undo-tree-id401 . -1) (undo-tree-id402 . -1) (undo-tree-id403 . -1) (#("t" 0 1 (font-lock-multiline t fontified t)) . -3950) (undo-tree-id404 . -1) (undo-tree-id405 . -1) (undo-tree-id406 . -1) (undo-tree-id407 . -1) (undo-tree-id408 . -1) (undo-tree-id409 . -1) (undo-tree-id410 . -1) (undo-tree-id411 . -1) (#("i" 0 1 (font-lock-multiline t fontified t)) . -3951) (undo-tree-id412 . -1) (undo-tree-id413 . -1) (undo-tree-id414 . -1) (undo-tree-id415 . -1) (undo-tree-id416 . -1) (undo-tree-id417 . -1) (undo-tree-id418 . -1) (undo-tree-id419 . -1) (#("o" 0 1 (font-lock-multiline t fontified t)) . -3952) (undo-tree-id420 . -1) (undo-tree-id421 . -1) (undo-tree-id422 . -1) (undo-tree-id423 . -1) (undo-tree-id424 . -1) (undo-tree-id425 . -1) (undo-tree-id426 . -1) (undo-tree-id427 . -1) (#("n" 0 1 (font-lock-multiline t fontified t)) . -3953) (undo-tree-id428 . -1) (undo-tree-id429 . -1) (undo-tree-id430 . -1) (undo-tree-id431 . -1) (undo-tree-id432 . -1) (undo-tree-id433 . -1) (undo-tree-id434 . -1) 3954 (t 26493 63339 214155 555000)) nil (26493 63351 411728 0) 0 nil])
([nil nil ((#("." 0 1 (font-lock-multiline t fontified t)) . -4142) (undo-tree-id439 . -1) (undo-tree-id440 . -1) (undo-tree-id441 . -1) (#("i" 0 1 (font-lock-multiline t fontified t)) . -4143) (undo-tree-id442 . -1) (undo-tree-id443 . -1) (undo-tree-id444 . -1) (#("m" 0 1 (font-lock-multiline t fontified t)) . -4144) (undo-tree-id445 . -1) (undo-tree-id446 . -1) (undo-tree-id447 . -1) (#("a" 0 1 (font-lock-multiline t fontified t)) . -4145) (undo-tree-id448 . -1) (undo-tree-id449 . -1) (undo-tree-id450 . -1) (#("g" 0 1 (font-lock-multiline t fontified t)) . -4146) (undo-tree-id451 . -1) (undo-tree-id452 . -1) (#("e" 0 1 (font-lock-multiline t fontified t)) . -4147) (undo-tree-id453 . -1) (undo-tree-id454 . -1) 4148 (t 26493 63351 416736 31000)) nil (26493 63643 890062 0) 0 nil])
([nil nil ((4142 . 4143)) nil (26493 63643 890052 0) 0 nil])
([nil nil ((4143 . 4156)) nil (26493 63643 890051 0) 0 nil])
([nil nil ((4136 . 4139)) nil (26493 63643 890051 0) 0 nil])
([nil nil ((#("a" 0 1 (font-lock-multiline t fontified t)) . -4138) (undo-tree-id438 . -1) 4139) nil (26493 63643 890050 0) 0 nil])
([nil nil ((4138 . 4144)) nil (26493 63643 890048 0) 0 nil])
([nil nil ((#("type SignedURLResponse = Promise<
    | { failure?: undefined; success: { url: string; id: number } }
    | { failure: string; success?: undefined }
>

type GetSignedURLParams = {
    fileType: string
    fileSize: number
    checksum: string
}" 0 4 (face font-lock-keyword-face fontified t) 4 5 (fontified t) 5 22 (face font-lock-type-face fontified t) 22 52 (fontified t) 52 61 (face font-lock-constant-face fontified t) 61 79 (fontified t) 79 85 (face typescript-primitive-face fontified t) 85 91 (fontified t) 91 97 (face typescript-primitive-face fontified t) 97 119 (fontified t) 119 125 (face typescript-primitive-face fontified t) 125 137 (fontified t) 137 146 (face font-lock-constant-face fontified t) 146 152 (fontified t) 152 156 (face font-lock-keyword-face fontified t) 156 157 (fontified t) 157 175 (face font-lock-type-face fontified t) 175 178 (fontified t) 178 194 (font-lock-multiline t fontified t) 194 200 (font-lock-multiline t face typescript-primitive-face fontified t) 200 215 (font-lock-multiline t fontified t) 215 221 (font-lock-multiline t face typescript-primitive-face fontified t) 221 236 (font-lock-multiline t fontified t) 236 242 (font-lock-multiline t face typescript-primitive-face fontified t) 242 244 (font-lock-multiline t fontified t)) . 4977) (undo-tree-id437 . -244)) nil (26493 63643 890047 0) 0 nil])
([nil nil ((#("
" 0 1 (fontified t)) . -4976) (undo-tree-id435 . -1) (undo-tree-id436 . -1) 4977) nil (26493 63643 890043 0) 0 nil])
([nil nil ((#("\"use server\"

import { z } from 'zod'
import { stripe } from '@/lib/stripe'
import { checkRole } from \"@/../utils/roles\"
import { clerkClient } from \"@clerk/nextjs/server\"
import { productCatalouge, images, orders, users } from '@/db/schema'
import { db } from \"@/db/index\"
import { eq } from 'drizzle-orm'
import { S3Client, PutObjectCommand } from \"@aws-sdk/client-s3\"
import { getSignedUrl } from \"@aws-sdk/s3-request-presigner\"
import crypto from \"crypto\"
import { Orders } from \"@/app/types\"
import { format, Order } from \"@/app/zod\"

// Types
interface ActionResponse<T> {
    success: boolean
    data?: T
    error?: string
}

interface FileUploadResponse {
    url: string
    id: number
}

// Configuration
const s3Config = {
    client: new S3Client({
        region: process.env.AWS_REGION!,
        credentials: {
            accessKeyId: process.env.AWS_ACCESS_KEY_ID!,
            secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY!,
        },
    }),
    bucket: process.env.AWS_BUCKET_NAME!,
    allowedTypes: [\"image/jpeg\", \"image/png\"] as const,
    maxSize: 1048576 * 10, // 10 MB
}

// Utility Functions
const generateFileName = (bytes = 32) => crypto.randomBytes(bytes).toString(\"hex\")

async function handleDatabaseError(error: unknown): Promise<never> {
    console.error('Database error:', error)
    throw new Error('Database operation failed')
}

// User Management Actions
export async function authManage(
    email: string | null = null,
    name: string | null = null,
    authId: string
): Promise<ActionResponse<void>> {
    try {
        await db.insert(users).values({
            email,
            authId,
            authName: name
        })
        return { success: true }
    } catch (error) {
        return {
            success: false,
            error: 'Failed to create user'
        }
    }
}

export async function setRole(formData: FormData) {
    const client = await clerkClient()
    if (!checkRole(\"admin\")) {
	return { message: \"Not Authorized\" };
    }  
 try {
    const res = await client.users.updateUser(formData.get('id') as string, {
      publicMetadata: { role: formData.get('role') },
    })
    return { message: res.publicMetadata }
  } catch (err) {
    return { message: err }
  }
}

// Order Management Actions
export async function orderStatus(
    orderID: number
): Promise<ActionResponse<string>> {
    try {
        const order = await db
            .select()
            .from(orders)
            .where(eq(orders.id, orderID))
        
        const parsedOrder = Order.parse(order)
        return {
            success: true,
            data: parsedOrder.orderStatus
        }
    } catch (error) {
        return {
            success: false,
            error: 'Failed to fetch order status'
        }
    }
}

export async function updateOrderStatus(
    orderID: number
): Promise<ActionResponse<void>> {
    try {
        const order = await db.query.orders.findFirst({
            where: eq(orders.id, orderID)
        })
        
        if (!order) {
            return {
                success: false,
                error: 'Order not found'
            }
        }

        const parsedOrder = Order.parse(order)
        const newStatus = parsedOrder.orderStatus === \"Your order has been shipped.\"
            ? \"Your order has been received.\"
            : \"Your order has been shipped.\"

        await db.update(orders)
            .set({ orderStatus: newStatus })
            .where(eq(orders.id, orderID))

        return { success: true }
    } catch (error) {
        return {
            success: false,
            error: 'Failed to update order status'
        }
    }
}

// Product Management Actions
export async function createProduct(
    formData: FormData
): Promise<ActionResponse<void>> {
    try {
        const info = format.parse({
            name: formData.get('name'),
            price: formData.get(\"price\"),
            image: formData.get('imageLocation'),
            category: formData.get('category'),
        })

        await db.insert(productCatalouge).values({
            name: info.name,
            imageLocation: info.imageLocation,
            price: info.price,
            category: info.category,
        })

        const product = await stripe.products.create({
            name: info.name,
        })

        await stripe.prices.create({
            currency: 'gbp',
            unit_amount: Math.round(info.price * 100),
            product: product.id,
        })

        return { success: true }
    } catch (error) {
        return {
            success: false,
            error: 'Failed to create product'
        }
    }
}

// File Upload Actions
export async function computeSHA256(buffer: ArrayBuffer): Promise<string> {
    const hashBuffer = await crypto.subtle.digest(\"SHA-256\", buffer)
    const hashArray = Array.from(new Uint8Array(hashBuffer))
    return hashArray.map(b => b.toString(16).padStart(2, \"0\")).join(\"\")
}


export async function getSignedURL({
    fileType,
    fileSize,
    checksum,
    name,
    type,
    productId
}: {
    fileType: string
    fileSize: number
    checksum: string
    name: string
    type: string
    productId?: number | null
}): Promise<ActionResponse<FileUploadResponse>> {
    // Validation
    if (!s3Config.allowedTypes.includes(fileType as any)) {
        return {
            success: false,
            error: \"File type not allowed\"
        }
    }

    if (fileSize > s3Config.maxSize) {
        return {
            success: false,
            error: \"File size too large\"
        }
    }

    try {
        const fileName = generateFileName()
        const putObjectCommand = new PutObjectCommand({
            Bucket: s3Config.bucket,
            Key: fileName,
            ContentType: fileType,
            ContentLength: fileSize,
            ChecksumSHA256: checksum,
        })

        const url = await getSignedUrl(
            s3Config.client,
            putObjectCommand,
            { expiresIn: 60 }
        )

        const baseUrl = url.split(\"?\")[0]
        
        // Store file info in database with all required fields
        await db.insert(images).values({
            name,
            url: baseUrl,
            width: 0,
            height: 0,
            type,
            productId: productId || undefined
        })

        const results = await db.select().from(images)
        
        return {
            success: true,
            data: {
                url,
                id: results[0].id
            }
        }
    } catch (error) {
        return {
            success: false,
            error: 'Failed to generate signed URL'
        }
    }
}
" 0 12 (face font-lock-string-face fontified t) 12 14 (fontified t) 14 20 (face font-lock-keyword-face fontified t) 20 27 (fontified t) 27 31 (face font-lock-keyword-face fontified t) 31 32 (fontified t) 32 37 (face font-lock-string-face fontified t) 37 38 (fontified t) 38 44 (face font-lock-keyword-face fontified t) 44 56 (fontified t) 56 60 (face font-lock-keyword-face fontified t) 60 61 (fontified t) 61 75 (face font-lock-string-face fontified t) 75 76 (fontified t) 76 82 (face font-lock-keyword-face fontified t) 82 97 (fontified t) 97 101 (face font-lock-keyword-face fontified t) 101 102 (fontified t) 102 120 (face font-lock-string-face fontified t) 120 121 (fontified t) 121 127 (face font-lock-keyword-face fontified t) 127 144 (fontified t) 144 148 (face font-lock-keyword-face fontified t) 148 149 (fontified t) 149 171 (face font-lock-string-face fontified t) 171 172 (fontified t) 172 178 (face font-lock-keyword-face fontified t) 178 223 (fontified t) 223 227 (face font-lock-keyword-face fontified t) 227 228 (fontified t) 228 241 (face font-lock-string-face fontified t) 241 242 (fontified t) 242 248 (face font-lock-keyword-face fontified t) 248 256 (fontified t) 256 260 (face font-lock-keyword-face fontified t) 260 261 (fontified t) 261 273 (face font-lock-string-face fontified t) 273 274 (fontified t) 274 280 (face font-lock-keyword-face fontified t) 280 288 (fontified t) 288 292 (face font-lock-keyword-face fontified t) 292 293 (fontified t) 293 306 (face font-lock-string-face fontified t) 306 307 (fontified t) 307 313 (face font-lock-keyword-face fontified t) 313 345 (fontified t) 345 349 (face font-lock-keyword-face fontified t) 349 350 (fontified t) 350 370 (face font-lock-string-face fontified t) 370 371 (fontified t) 371 377 (face font-lock-keyword-face fontified t) 377 395 (fontified t) 395 399 (face font-lock-keyword-face fontified t) 399 400 (fontified t) 400 431 (face font-lock-string-face fontified t) 431 432 (fontified t) 432 438 (face font-lock-keyword-face fontified t) 438 446 (fontified t) 446 450 (face font-lock-keyword-face fontified t) 450 451 (fontified t) 451 459 (face font-lock-string-face fontified t) 459 460 (fontified t) 460 466 (face font-lock-keyword-face fontified t) 466 478 (fontified t) 478 482 (face font-lock-keyword-face fontified t) 482 483 (fontified t) 483 496 (face font-lock-string-face fontified t) 496 497 (fontified t) 497 503 (face font-lock-keyword-face fontified t) 503 522 (fontified t) 522 526 (face font-lock-keyword-face fontified t) 526 527 (fontified t) 527 538 (face font-lock-string-face fontified t) 538 540 (fontified t) 540 543 (face font-lock-comment-delimiter-face fontified t) 543 549 (face font-lock-comment-face fontified t) 549 558 (face font-lock-keyword-face fontified t) 558 559 (fontified t) 559 573 (face font-lock-type-face fontified t) 573 574 (fontified t) 574 575 (face font-lock-type-face fontified t) 575 577 (fontified t) 577 592 (font-lock-multiline t fontified t) 592 599 (font-lock-multiline t face typescript-primitive-face fontified t) 599 625 (font-lock-multiline t fontified t) 625 631 (font-lock-multiline t face typescript-primitive-face fontified t) 631 633 (font-lock-multiline t fontified t) 633 635 (fontified t) 635 644 (face font-lock-keyword-face fontified t) 644 645 (fontified t) 645 663 (face font-lock-type-face fontified t) 663 664 (fontified t) 664 675 (font-lock-multiline t fontified t) 675 681 (font-lock-multiline t face typescript-primitive-face fontified t) 681 690 (font-lock-multiline t fontified t) 690 696 (font-lock-multiline t face typescript-primitive-face fontified t) 696 698 (font-lock-multiline t fontified t) 698 700 (fontified t) 700 703 (face font-lock-comment-delimiter-face fontified t) 703 717 (face font-lock-comment-face fontified t) 717 722 (face font-lock-keyword-face fontified t) 722 723 (fontified t) 723 731 (face font-lock-variable-name-face fontified t) 731 734 (fontified t) 734 748 (font-lock-multiline t fontified t) 748 751 (font-lock-multiline t face font-lock-keyword-face fontified t) 751 752 (font-lock-multiline t fontified t) 752 760 (face font-lock-type-face font-lock-multiline t fontified t) 760 1029 (font-lock-multiline t fontified t) 1029 1041 (font-lock-multiline t face font-lock-string-face fontified t) 1041 1043 (font-lock-multiline t fontified t) 1043 1054 (font-lock-multiline t face font-lock-string-face fontified t) 1054 1056 (font-lock-multiline t fontified t) 1056 1058 (font-lock-multiline t face font-lock-keyword-face fontified t) 1058 1059 (font-lock-multiline t fontified t) 1059 1064 (font-lock-multiline t face font-lock-keyword-face fontified t) 1064 1093 (font-lock-multiline t fontified t) 1093 1096 (font-lock-multiline t face font-lock-comment-delimiter-face fontified t) 1096 1102 (font-lock-multiline t face font-lock-comment-face fontified t) 1102 1103 (font-lock-multiline t fontified t) 1103 1105 (fontified t) 1105 1108 (face font-lock-comment-delimiter-face fontified t) 1108 1126 (face font-lock-comment-face fontified t) 1126 1131 (face font-lock-keyword-face fontified t) 1131 1132 (fontified t) 1132 1148 (face font-lock-variable-name-face fontified t) 1148 1164 (fontified t) 1164 1166 (face font-lock-keyword-face fontified t) 1166 1174 (fontified t) 1174 1185 (face font-lock-function-name-face fontified t) 1185 1193 (fontified t) 1193 1201 (face font-lock-function-name-face fontified t) 1201 1202 (fontified t) 1202 1207 (face font-lock-string-face fontified t) 1207 1210 (fontified t) 1210 1215 (face font-lock-keyword-face fontified t) 1215 1216 (fontified t) 1216 1224 (face font-lock-keyword-face fontified t) 1224 1225 (fontified t) 1225 1244 (face font-lock-function-name-face fontified t) 1244 1245 (fontified t) 1245 1250 (face font-lock-variable-name-face fontified t) 1250 1252 (fontified t) 1252 1259 (face typescript-primitive-face fontified t) 1259 1262 (fontified t) 1262 1269 (face font-lock-type-face fontified t) 1269 1270 (fontified t) 1270 1275 (face typescript-primitive-face fontified t) 1275 1277 (fontified t) 1277 1283 (font-lock-multiline t fontified t) 1283 1290 (face font-lock-type-face font-lock-multiline t fontified t) 1290 1291 (font-lock-multiline t fontified t) 1291 1296 (face font-lock-function-name-face font-lock-multiline t fontified t) 1296 1297 (font-lock-multiline t fontified t) 1297 1314 (font-lock-multiline t face font-lock-string-face fontified t) 1314 1327 (font-lock-multiline t fontified t) 1327 1332 (font-lock-multiline t face font-lock-keyword-face fontified t) 1332 1333 (font-lock-multiline t fontified t) 1333 1336 (font-lock-multiline t face font-lock-keyword-face fontified t) 1336 1337 (font-lock-multiline t fontified t) 1337 1342 (face font-lock-type-face font-lock-multiline t fontified t) 1342 1343 (font-lock-multiline t fontified t) 1343 1370 (font-lock-multiline t face font-lock-string-face fontified t) 1370 1373 (font-lock-multiline t fontified t) 1373 1375 (fontified t) 1375 1378 (face font-lock-comment-delimiter-face fontified t) 1378 1402 (face font-lock-comment-face fontified t) 1402 1408 (face font-lock-keyword-face fontified t) 1408 1409 (fontified t) 1409 1414 (face font-lock-keyword-face fontified t) 1414 1415 (fontified t) 1415 1423 (font-lock-multiline t face font-lock-keyword-face fontified t) 1423 1424 (font-lock-multiline t fontified t) 1424 1434 (face font-lock-function-name-face font-lock-multiline t fontified t) 1434 1440 (font-lock-multiline t fontified t) 1440 1445 (face font-lock-variable-name-face font-lock-multiline t fontified t) 1445 1447 (font-lock-multiline t fontified t) 1447 1453 (font-lock-multiline t face typescript-primitive-face fontified t) 1453 1456 (font-lock-multiline t fontified t) 1456 1460 (font-lock-multiline t face font-lock-constant-face fontified t) 1460 1463 (font-lock-multiline t fontified t) 1463 1467 (font-lock-multiline t face font-lock-constant-face fontified t) 1467 1473 (font-lock-multiline t fontified t) 1473 1477 (face font-lock-variable-name-face font-lock-multiline t fontified t) 1477 1479 (font-lock-multiline t fontified t) 1479 1485 (font-lock-multiline t face typescript-primitive-face fontified t) 1485 1488 (font-lock-multiline t fontified t) 1488 1492 (font-lock-multiline t face font-lock-constant-face fontified t) 1492 1495 (font-lock-multiline t fontified t) 1495 1499 (font-lock-multiline t face font-lock-constant-face fontified t) 1499 1500 (font-lock-multiline t fontified t) 1500 1501 (font-lock-multiline t fontified t) 1501 1505 (font-lock-multiline t fontified t) 1505 1511 (face font-lock-variable-name-face font-lock-multiline t fontified t) 1511 1513 (font-lock-multiline t fontified t) 1513 1519 (font-lock-multiline t face typescript-primitive-face fontified t) 1519 1521 (font-lock-multiline t fontified t) 1521 1523 (fontified t) 1523 1530 (face font-lock-type-face fontified t) 1530 1531 (fontified t) 1531 1545 (face font-lock-type-face fontified t) 1545 1546 (fontified t) 1546 1550 (face typescript-primitive-face fontified t) 1550 1553 (fontified t) 1553 1559 (font-lock-multiline t fontified t) 1559 1562 (font-lock-multiline t face font-lock-keyword-face fontified t) 1562 1573 (font-lock-multiline t fontified t) 1573 1578 (font-lock-multiline t face font-lock-keyword-face fontified t) 1578 1582 (font-lock-multiline t fontified t) 1582 1588 (face font-lock-function-name-face font-lock-multiline t fontified t) 1588 1596 (font-lock-multiline t fontified t) 1596 1602 (face font-lock-function-name-face font-lock-multiline t fontified t) 1602 1690 (font-lock-multiline t fontified t) 1690 1696 (font-lock-multiline t face font-lock-keyword-face fontified t) 1696 1708 (font-lock-multiline t fontified t) 1708 1712 (font-lock-multiline t face font-lock-constant-face fontified t) 1712 1721 (font-lock-multiline t fontified t) 1721 1726 (font-lock-multiline t face font-lock-keyword-face fontified t) 1726 1745 (font-lock-multiline t fontified t) 1745 1751 (font-lock-multiline t face font-lock-keyword-face fontified t) 1751 1775 (font-lock-multiline t fontified t) 1775 1780 (font-lock-multiline t face font-lock-constant-face fontified t) 1780 1801 (font-lock-multiline t fontified t) 1801 1824 (font-lock-multiline t face font-lock-string-face fontified t) 1824 1842 (font-lock-multiline t fontified t) 1842 1844 (fontified t) 1844 1850 (face font-lock-keyword-face fontified t) 1850 1851 (fontified t) 1851 1856 (face font-lock-keyword-face fontified t) 1856 1857 (fontified t) 1857 1865 (face font-lock-keyword-face fontified t) 1865 1866 (fontified t) 1866 1873 (face font-lock-function-name-face fontified t) 1873 1874 (fontified t) 1874 1882 (face font-lock-variable-name-face fontified t) 1882 1884 (fontified t) 1884 1892 (face font-lock-type-face fontified t) 1892 1894 (fontified t) 1894 1895 (typescript--pstate ((nil 0 function 1858 ("setRole") 2254) (nil -2305843009213693952 toplevel nil nil nil)) font-lock-multiline t fontified t) 1895 1900 (font-lock-multiline t fontified t) 1900 1905 (font-lock-multiline t face font-lock-keyword-face fontified t) 1905 1906 (font-lock-multiline t fontified t) 1906 1912 (face font-lock-variable-name-face font-lock-multiline t fontified t) 1912 1915 (font-lock-multiline t fontified t) 1915 1920 (font-lock-multiline t face font-lock-keyword-face fontified t) 1920 1921 (font-lock-multiline t fontified t) 1921 1932 (face font-lock-function-name-face font-lock-multiline t fontified t) 1932 1939 (font-lock-multiline t fontified t) 1939 1941 (font-lock-multiline t face font-lock-keyword-face fontified t) 1941 1944 (font-lock-multiline t fontified t) 1944 1953 (face font-lock-function-name-face font-lock-multiline t fontified t) 1953 1954 (font-lock-multiline t fontified t) 1954 1961 (font-lock-multiline t face font-lock-string-face fontified t) 1961 1967 (font-lock-multiline t fontified t) 1967 1973 (font-lock-multiline t face font-lock-keyword-face fontified t) 1973 1985 (font-lock-multiline t fontified t) 1985 2001 (font-lock-multiline t face font-lock-string-face fontified t) 2001 2014 (font-lock-multiline t fontified t) 2014 2017 (font-lock-multiline t face font-lock-keyword-face fontified t) 2017 2024 (font-lock-multiline t fontified t) 2024 2029 (font-lock-multiline t face font-lock-keyword-face fontified t) 2029 2030 (font-lock-multiline t fontified t) 2030 2033 (face font-lock-variable-name-face font-lock-multiline t fontified t) 2033 2036 (font-lock-multiline t fontified t) 2036 2041 (font-lock-multiline t face font-lock-keyword-face fontified t) 2041 2055 (font-lock-multiline t fontified t) 2055 2065 (face font-lock-function-name-face font-lock-multiline t fontified t) 2065 2075 (font-lock-multiline t fontified t) 2075 2078 (font-lock-multiline t face font-lock-function-name-face fontified t) 2078 2079 (font-lock-multiline t fontified t) 2079 2083 (font-lock-multiline t face font-lock-string-face fontified t) 2083 2085 (font-lock-multiline t fontified t) 2085 2087 (font-lock-multiline t face font-lock-keyword-face fontified t) 2087 2088 (font-lock-multiline t fontified t) 2088 2094 (font-lock-multiline t face typescript-primitive-face fontified t) 2094 2137 (font-lock-multiline t fontified t) 2137 2140 (font-lock-multiline t face font-lock-function-name-face fontified t) 2140 2141 (font-lock-multiline t fontified t) 2141 2147 (font-lock-multiline t face font-lock-string-face fontified t) 2147 2163 (font-lock-multiline t fontified t) 2163 2169 (font-lock-multiline t face font-lock-keyword-face fontified t) 2169 2206 (font-lock-multiline t fontified t) 2206 2211 (font-lock-multiline t face font-lock-keyword-face fontified t) 2211 2224 (font-lock-multiline t fontified t) 2224 2230 (font-lock-multiline t face font-lock-keyword-face fontified t) 2230 2252 (font-lock-multiline t fontified t) 2252 2253 (typescript--pend (nil 0 function 1858 ("setRole") 2254) font-lock-multiline t fontified t) 2253 2255 (fontified t) 2255 2258 (face font-lock-comment-delimiter-face fontified t) 2258 2283 (face font-lock-comment-face fontified t) 2283 2289 (face font-lock-keyword-face fontified t) 2289 2290 (fontified t) 2290 2295 (face font-lock-keyword-face fontified t) 2295 2296 (fontified t) 2296 2304 (font-lock-multiline t face font-lock-keyword-face fontified t) 2304 2305 (font-lock-multiline t fontified t) 2305 2316 (face font-lock-function-name-face font-lock-multiline t fontified t) 2316 2322 (font-lock-multiline t fontified t) 2322 2329 (face font-lock-variable-name-face font-lock-multiline t fontified t) 2329 2331 (font-lock-multiline t fontified t) 2331 2337 (font-lock-multiline t face typescript-primitive-face fontified t) 2337 2339 (font-lock-multiline t fontified t) 2339 2341 (fontified t) 2341 2348 (face font-lock-type-face fontified t) 2348 2349 (fontified t) 2349 2363 (face font-lock-type-face fontified t) 2363 2364 (fontified t) 2364 2370 (face typescript-primitive-face fontified t) 2370 2373 (fontified t) 2373 2379 (font-lock-multiline t fontified t) 2379 2382 (font-lock-multiline t face font-lock-keyword-face fontified t) 2382 2393 (font-lock-multiline t fontified t) 2393 2398 (font-lock-multiline t face font-lock-keyword-face fontified t) 2398 2399 (font-lock-multiline t fontified t) 2399 2404 (face font-lock-variable-name-face font-lock-multiline t fontified t) 2404 2407 (font-lock-multiline t fontified t) 2407 2412 (font-lock-multiline t face font-lock-keyword-face fontified t) 2412 2429 (font-lock-multiline t fontified t) 2429 2435 (face font-lock-function-name-face font-lock-multiline t fontified t) 2435 2451 (font-lock-multiline t fontified t) 2451 2455 (font-lock-multiline t face font-lock-function-name-face fontified t) 2455 2477 (font-lock-multiline t fontified t) 2477 2482 (face font-lock-function-name-face font-lock-multiline t fontified t) 2482 2483 (font-lock-multiline t fontified t) 2483 2485 (face font-lock-function-name-face font-lock-multiline t fontified t) 2485 2524 (font-lock-multiline t fontified t) 2524 2529 (font-lock-multiline t face font-lock-keyword-face fontified t) 2529 2530 (font-lock-multiline t fontified t) 2530 2541 (face font-lock-variable-name-face font-lock-multiline t fontified t) 2541 2550 (font-lock-multiline t fontified t) 2550 2555 (face font-lock-function-name-face font-lock-multiline t fontified t) 2555 2571 (font-lock-multiline t fontified t) 2571 2577 (font-lock-multiline t face font-lock-keyword-face fontified t) 2577 2601 (font-lock-multiline t fontified t) 2601 2605 (font-lock-multiline t face font-lock-constant-face fontified t) 2605 2665 (font-lock-multiline t fontified t) 2665 2670 (font-lock-multiline t face font-lock-keyword-face fontified t) 2670 2689 (font-lock-multiline t fontified t) 2689 2695 (font-lock-multiline t face font-lock-keyword-face fontified t) 2695 2719 (font-lock-multiline t fontified t) 2719 2724 (font-lock-multiline t face font-lock-constant-face fontified t) 2724 2745 (font-lock-multiline t fontified t) 2745 2775 (font-lock-multiline t face font-lock-string-face fontified t) 2775 2793 (font-lock-multiline t fontified t) 2793 2795 (fontified t) 2795 2801 (face font-lock-keyword-face fontified t) 2801 2802 (fontified t) 2802 2807 (face font-lock-keyword-face fontified t) 2807 2808 (fontified t) 2808 2816 (font-lock-multiline t face font-lock-keyword-face fontified t) 2816 2817 (font-lock-multiline t fontified t) 2817 2834 (face font-lock-function-name-face font-lock-multiline t fontified t) 2834 2840 (font-lock-multiline t fontified t) 2840 2847 (face font-lock-variable-name-face font-lock-multiline t fontified t) 2847 2849 (font-lock-multiline t fontified t) 2849 2855 (font-lock-multiline t face typescript-primitive-face fontified t) 2855 2857 (font-lock-multiline t fontified t) 2857 2859 (fontified t) 2859 2866 (face font-lock-type-face fontified t) 2866 2867 (fontified t) 2867 2881 (face font-lock-type-face fontified t) 2881 2882 (fontified t) 2882 2886 (face typescript-primitive-face fontified t) 2886 2889 (fontified t) 2889 2895 (font-lock-multiline t fontified t) 2895 2898 (font-lock-multiline t face font-lock-keyword-face fontified t) 2898 2909 (font-lock-multiline t fontified t) 2909 2914 (font-lock-multiline t face font-lock-keyword-face fontified t) 2914 2915 (font-lock-multiline t fontified t) 2915 2920 (face font-lock-variable-name-face font-lock-multiline t fontified t) 2920 2923 (font-lock-multiline t fontified t) 2923 2928 (font-lock-multiline t face font-lock-keyword-face fontified t) 2928 2945 (font-lock-multiline t fontified t) 2945 2954 (face font-lock-function-name-face font-lock-multiline t fontified t) 2954 2976 (font-lock-multiline t fontified t) 2976 2978 (face font-lock-function-name-face font-lock-multiline t fontified t) 2978 3001 (font-lock-multiline t fontified t) 3001 3010 (font-lock-multiline t fontified t) 3010 3027 (font-lock-multiline t fontified t) 3027 3029 (font-lock-multiline t face font-lock-keyword-face fontified t) 3029 3053 (font-lock-multiline t fontified t) 3053 3059 (font-lock-multiline t face font-lock-keyword-face fontified t) 3059 3087 (font-lock-multiline t fontified t) 3087 3092 (font-lock-multiline t face font-lock-constant-face fontified t) 3092 3117 (font-lock-multiline t fontified t) 3117 3134 (font-lock-multiline t face font-lock-string-face fontified t) 3134 3168 (font-lock-multiline t fontified t) 3168 3173 (font-lock-multiline t face font-lock-keyword-face fontified t) 3173 3174 (font-lock-multiline t fontified t) 3174 3185 (face font-lock-variable-name-face font-lock-multiline t fontified t) 3185 3194 (font-lock-multiline t fontified t) 3194 3199 (face font-lock-function-name-face font-lock-multiline t fontified t) 3199 3215 (font-lock-multiline t fontified t) 3215 3220 (font-lock-multiline t face font-lock-keyword-face fontified t) 3220 3221 (font-lock-multiline t fontified t) 3221 3230 (face font-lock-variable-name-face font-lock-multiline t fontified t) 3230 3261 (font-lock-multiline t fontified t) 3261 3291 (font-lock-multiline t face font-lock-string-face fontified t) 3291 3306 (font-lock-multiline t fontified t) 3306 3337 (font-lock-multiline t face font-lock-string-face fontified t) 3337 3352 (font-lock-multiline t fontified t) 3352 3382 (font-lock-multiline t face font-lock-string-face fontified t) 3382 3392 (font-lock-multiline t fontified t) 3392 3397 (font-lock-multiline t face font-lock-keyword-face fontified t) 3397 3401 (font-lock-multiline t fontified t) 3401 3407 (face font-lock-function-name-face font-lock-multiline t fontified t) 3407 3429 (font-lock-multiline t fontified t) 3429 3432 (font-lock-multiline t face font-lock-function-name-face fontified t) 3432 3474 (font-lock-multiline t fontified t) 3474 3479 (face font-lock-function-name-face font-lock-multiline t fontified t) 3479 3480 (font-lock-multiline t fontified t) 3480 3482 (face font-lock-function-name-face font-lock-multiline t fontified t) 3482 3513 (font-lock-multiline t fontified t) 3513 3519 (font-lock-multiline t face font-lock-keyword-face fontified t) 3519 3531 (font-lock-multiline t fontified t) 3531 3535 (font-lock-multiline t face font-lock-constant-face fontified t) 3535 3544 (font-lock-multiline t fontified t) 3544 3549 (font-lock-multiline t face font-lock-keyword-face fontified t) 3549 3568 (font-lock-multiline t fontified t) 3568 3574 (font-lock-multiline t face font-lock-keyword-face fontified t) 3574 3598 (font-lock-multiline t fontified t) 3598 3603 (font-lock-multiline t face font-lock-constant-face fontified t) 3603 3624 (font-lock-multiline t fontified t) 3624 3655 (font-lock-multiline t face font-lock-string-face fontified t) 3655 3673 (font-lock-multiline t fontified t) 3673 3675 (fontified t) 3675 3678 (face font-lock-comment-delimiter-face fontified t) 3678 3705 (face font-lock-comment-face fontified t) 3705 3711 (face font-lock-keyword-face fontified t) 3711 3712 (fontified t) 3712 3717 (face font-lock-keyword-face fontified t) 3717 3718 (fontified t) 3718 3726 (font-lock-multiline t face font-lock-keyword-face fontified t) 3726 3727 (font-lock-multiline t fontified t) 3727 3740 (face font-lock-function-name-face font-lock-multiline t fontified t) 3740 3746 (font-lock-multiline t fontified t) 3746 3754 (face font-lock-variable-name-face font-lock-multiline t fontified t) 3754 3756 (font-lock-multiline t fontified t) 3756 3764 (font-lock-multiline t face font-lock-type-face fontified t) 3764 3766 (font-lock-multiline t fontified t) 3766 3768 (fontified t) 3768 3775 (face font-lock-type-face fontified t) 3775 3776 (fontified t) 3776 3790 (face font-lock-type-face fontified t) 3790 3791 (fontified t) 3791 3795 (face typescript-primitive-face fontified t) 3795 3798 (fontified t) 3798 3804 (font-lock-multiline t fontified t) 3804 3807 (font-lock-multiline t face font-lock-keyword-face fontified t) 3807 3818 (font-lock-multiline t fontified t) 3818 3823 (font-lock-multiline t face font-lock-keyword-face fontified t) 3823 3824 (font-lock-multiline t fontified t) 3824 3828 (face font-lock-variable-name-face font-lock-multiline t fontified t) 3828 3838 (font-lock-multiline t fontified t) 3838 3843 (face font-lock-function-name-face font-lock-multiline t fontified t) 3843 3873 (font-lock-multiline t fontified t) 3873 3876 (font-lock-multiline t face font-lock-function-name-face fontified t) 3876 3877 (font-lock-multiline t fontified t) 3877 3883 (font-lock-multiline t face font-lock-string-face fontified t) 3883 3914 (font-lock-multiline t fontified t) 3914 3917 (font-lock-multiline t face font-lock-function-name-face fontified t) 3917 3918 (font-lock-multiline t fontified t) 3918 3925 (font-lock-multiline t face font-lock-string-face fontified t) 3925 3956 (font-lock-multiline t fontified t) 3956 3959 (font-lock-multiline t face font-lock-function-name-face fontified t) 3959 3960 (font-lock-multiline t fontified t) 3960 3975 (font-lock-multiline t face font-lock-string-face fontified t) 3975 4009 (font-lock-multiline t fontified t) 4009 4012 (font-lock-multiline t face font-lock-function-name-face fontified t) 4012 4013 (font-lock-multiline t fontified t) 4013 4023 (font-lock-multiline t face font-lock-string-face fontified t) 4023 4046 (font-lock-multiline t fontified t) 4046 4051 (font-lock-multiline t face font-lock-keyword-face fontified t) 4051 4055 (font-lock-multiline t fontified t) 4055 4061 (face font-lock-function-name-face font-lock-multiline t fontified t) 4061 4080 (font-lock-multiline t fontified t) 4080 4086 (face font-lock-function-name-face font-lock-multiline t fontified t) 4086 4253 (font-lock-multiline t fontified t) 4253 4258 (font-lock-multiline t face font-lock-keyword-face fontified t) 4258 4259 (font-lock-multiline t fontified t) 4259 4266 (face font-lock-variable-name-face font-lock-multiline t fontified t) 4266 4269 (font-lock-multiline t fontified t) 4269 4274 (font-lock-multiline t face font-lock-keyword-face fontified t) 4274 4291 (font-lock-multiline t fontified t) 4291 4297 (face font-lock-function-name-face font-lock-multiline t fontified t) 4297 4349 (font-lock-multiline t fontified t) 4349 4354 (font-lock-multiline t face font-lock-keyword-face fontified t) 4354 4369 (font-lock-multiline t fontified t) 4369 4375 (face font-lock-function-name-face font-lock-multiline t fontified t) 4375 4400 (font-lock-multiline t fontified t) 4400 4405 (font-lock-multiline t face font-lock-string-face fontified t) 4405 4432 (font-lock-multiline t fontified t) 4432 4436 (font-lock-multiline t face font-lock-type-face fontified t) 4436 4437 (font-lock-multiline t fontified t) 4437 4442 (face font-lock-function-name-face font-lock-multiline t fontified t) 4442 4510 (font-lock-multiline t fontified t) 4510 4515 (font-lock-multiline t fontified t) 4515 4521 (font-lock-multiline t face font-lock-keyword-face fontified t) 4521 4533 (font-lock-multiline t fontified t) 4533 4537 (font-lock-multiline t face font-lock-constant-face fontified t) 4537 4540 (font-lock-multiline t fontified t) 4540 4546 (font-lock-multiline t fontified t) 4546 4551 (font-lock-multiline t face font-lock-keyword-face fontified t) 4551 4570 (font-lock-multiline t fontified t) 4570 4576 (font-lock-multiline t face font-lock-keyword-face fontified t) 4576 4600 (font-lock-multiline t fontified t) 4600 4605 (font-lock-multiline t face font-lock-constant-face fontified t) 4605 4626 (font-lock-multiline t fontified t) 4626 4652 (font-lock-multiline t face font-lock-string-face fontified t) 4652 4670 (font-lock-multiline t fontified t) 4670 4672 (fontified t) 4672 4675 (face font-lock-comment-delimiter-face fontified t) 4675 4695 (face font-lock-comment-face fontified t) 4695 4701 (face font-lock-keyword-face fontified t) 4701 4702 (fontified t) 4702 4707 (face font-lock-keyword-face fontified t) 4707 4708 (fontified t) 4708 4716 (face font-lock-keyword-face fontified t) 4716 4717 (fontified t) 4717 4730 (face font-lock-function-name-face fontified t) 4730 4731 (fontified t) 4731 4737 (face font-lock-variable-name-face fontified t) 4737 4739 (fontified t) 4739 4750 (face font-lock-type-face fontified t) 4750 4753 (fontified t) 4753 4760 (face font-lock-type-face fontified t) 4760 4761 (fontified t) 4761 4767 (face typescript-primitive-face fontified t) 4767 4769 (fontified t) 4769 4775 (font-lock-multiline t fontified t) 4775 4780 (font-lock-multiline t face font-lock-keyword-face fontified t) 4780 4781 (font-lock-multiline t fontified t) 4781 4791 (face font-lock-variable-name-face font-lock-multiline t fontified t) 4791 4794 (font-lock-multiline t fontified t) 4794 4799 (font-lock-multiline t face font-lock-keyword-face fontified t) 4799 4814 (font-lock-multiline t fontified t) 4814 4820 (face font-lock-function-name-face font-lock-multiline t fontified t) 4820 4821 (font-lock-multiline t fontified t) 4821 4830 (font-lock-multiline t face font-lock-string-face fontified t) 4830 4844 (font-lock-multiline t fontified t) 4844 4849 (font-lock-multiline t face font-lock-keyword-face fontified t) 4849 4850 (font-lock-multiline t fontified t) 4850 4859 (face font-lock-variable-name-face font-lock-multiline t fontified t) 4859 4868 (font-lock-multiline t fontified t) 4868 4872 (font-lock-multiline t face font-lock-function-name-face fontified t) 4872 4873 (font-lock-multiline t fontified t) 4873 4876 (font-lock-multiline t face font-lock-keyword-face fontified t) 4876 4877 (font-lock-multiline t fontified t) 4877 4887 (face font-lock-type-face font-lock-multiline t fontified t) 4887 4905 (font-lock-multiline t fontified t) 4905 4911 (font-lock-multiline t face font-lock-keyword-face fontified t) 4911 4922 (font-lock-multiline t fontified t) 4922 4925 (face font-lock-function-name-face font-lock-multiline t fontified t) 4925 4928 (font-lock-multiline t fontified t) 4928 4930 (face font-lock-keyword-face font-lock-multiline t fontified t) 4930 4933 (font-lock-multiline t fontified t) 4933 4941 (face font-lock-function-name-face font-lock-multiline t fontified t) 4941 4946 (font-lock-multiline t fontified t) 4946 4954 (face font-lock-function-name-face font-lock-multiline t fontified t) 4954 4958 (font-lock-multiline t fontified t) 4958 4961 (font-lock-multiline t face font-lock-string-face fontified t) 4961 4964 (font-lock-multiline t fontified t) 4964 4968 (face font-lock-function-name-face font-lock-multiline t fontified t) 4968 4969 (font-lock-multiline t fontified t) 4969 4971 (font-lock-multiline t face font-lock-string-face fontified t) 4971 4974 (font-lock-multiline t fontified t) 4974 4977 (fontified t) 4977 4983 (face font-lock-keyword-face fontified t) 4983 4984 (fontified t) 4984 4989 (face font-lock-keyword-face fontified t) 4989 4990 (fontified t) 4990 4998 (face font-lock-keyword-face fontified t) 4998 4999 (fontified t) 4999 5011 (face font-lock-function-name-face font-lock-multiline t fontified t) 5011 5012 (font-lock-multiline t fontified t) 5012 5018 (font-lock-multiline t fontified t) 5018 5026 (face font-lock-variable-name-face font-lock-multiline t fontified t) 5026 5032 (font-lock-multiline t fontified t) 5032 5040 (face font-lock-variable-name-face font-lock-multiline t fontified t) 5040 5046 (font-lock-multiline t fontified t) 5046 5054 (face font-lock-variable-name-face font-lock-multiline t fontified t) 5054 5060 (font-lock-multiline t fontified t) 5060 5064 (face font-lock-variable-name-face font-lock-multiline t fontified t) 5064 5070 (font-lock-multiline t fontified t) 5070 5074 (font-lock-multiline t face font-lock-variable-name-face fontified t) 5074 5080 (font-lock-multiline t fontified t) 5080 5089 (face font-lock-variable-name-face font-lock-multiline t fontified t) 5089 5091 (font-lock-multiline t fontified t) 5091 5093 (font-lock-multiline t fontified t) 5093 5099 (font-lock-multiline t fontified t) 5099 5107 (face font-lock-variable-name-face font-lock-multiline t fontified t) 5107 5109 (font-lock-multiline t fontified t) 5109 5115 (font-lock-multiline t face typescript-primitive-face fontified t) 5115 5130 (font-lock-multiline t fontified t) 5130 5136 (font-lock-multiline t face typescript-primitive-face fontified t) 5136 5151 (font-lock-multiline t fontified t) 5151 5157 (font-lock-multiline t face typescript-primitive-face fontified t) 5157 5168 (font-lock-multiline t fontified t) 5168 5174 (font-lock-multiline t face typescript-primitive-face fontified t) 5174 5179 (font-lock-multiline t fontified t) 5179 5183 (font-lock-multiline t face default fontified t) 5183 5185 (font-lock-multiline t fontified t) 5185 5191 (font-lock-multiline t face typescript-primitive-face fontified t) 5191 5208 (font-lock-multiline t fontified t) 5208 5214 (font-lock-multiline t face typescript-primitive-face fontified t) 5214 5217 (font-lock-multiline t fontified t) 5217 5221 (font-lock-multiline t face font-lock-constant-face fontified t) 5221 5223 (font-lock-multiline t fontified t) 5223 5224 (font-lock-multiline t fontified t) 5224 5226 (fontified t) 5226 5233 (face font-lock-type-face fontified t) 5233 5234 (fontified t) 5234 5248 (face font-lock-type-face fontified t) 5248 5249 (fontified t) 5249 5267 (face font-lock-type-face fontified t) 5267 5270 (fontified t) 5270 5276 (font-lock-multiline t fontified t) 5276 5279 (font-lock-multiline t face font-lock-comment-delimiter-face fontified t) 5279 5290 (font-lock-multiline t face font-lock-comment-face fontified t) 5290 5294 (font-lock-multiline t fontified t) 5294 5296 (font-lock-multiline t face font-lock-keyword-face fontified t) 5296 5321 (font-lock-multiline t fontified t) 5321 5329 (face font-lock-function-name-face font-lock-multiline t fontified t) 5329 5339 (font-lock-multiline t fontified t) 5339 5341 (font-lock-multiline t face font-lock-keyword-face fontified t) 5341 5342 (font-lock-multiline t fontified t) 5342 5345 (font-lock-multiline t face typescript-primitive-face fontified t) 5345 5358 (font-lock-multiline t fontified t) 5358 5364 (font-lock-multiline t face font-lock-keyword-face fontified t) 5364 5388 (font-lock-multiline t fontified t) 5388 5393 (font-lock-multiline t face font-lock-constant-face fontified t) 5393 5414 (font-lock-multiline t fontified t) 5414 5437 (font-lock-multiline t face font-lock-string-face fontified t) 5437 5459 (font-lock-multiline t fontified t) 5459 5461 (font-lock-multiline t face font-lock-keyword-face fontified t) 5461 5502 (font-lock-multiline t fontified t) 5502 5508 (font-lock-multiline t face font-lock-keyword-face fontified t) 5508 5532 (font-lock-multiline t fontified t) 5532 5537 (font-lock-multiline t face font-lock-constant-face fontified t) 5537 5558 (font-lock-multiline t fontified t) 5558 5579 (font-lock-multiline t face font-lock-string-face fontified t) 5579 5601 (font-lock-multiline t fontified t) 5601 5604 (font-lock-multiline t face font-lock-keyword-face fontified t) 5604 5615 (font-lock-multiline t fontified t) 5615 5620 (font-lock-multiline t face font-lock-keyword-face fontified t) 5620 5621 (font-lock-multiline t fontified t) 5621 5629 (face font-lock-variable-name-face font-lock-multiline t fontified t) 5629 5632 (font-lock-multiline t fontified t) 5632 5648 (face font-lock-function-name-face font-lock-multiline t fontified t) 5648 5659 (font-lock-multiline t fontified t) 5659 5664 (font-lock-multiline t face font-lock-keyword-face fontified t) 5664 5665 (font-lock-multiline t fontified t) 5665 5681 (face font-lock-variable-name-face font-lock-multiline t fontified t) 5681 5684 (font-lock-multiline t fontified t) 5684 5687 (font-lock-multiline t face font-lock-keyword-face fontified t) 5687 5688 (font-lock-multiline t fontified t) 5688 5704 (face font-lock-type-face font-lock-multiline t fontified t) 5704 5901 (font-lock-multiline t fontified t) 5901 5906 (font-lock-multiline t face font-lock-keyword-face fontified t) 5906 5907 (font-lock-multiline t fontified t) 5907 5910 (face font-lock-variable-name-face font-lock-multiline t fontified t) 5910 5913 (font-lock-multiline t fontified t) 5913 5918 (font-lock-multiline t face font-lock-keyword-face fontified t) 5918 5919 (font-lock-multiline t fontified t) 5919 5931 (face font-lock-function-name-face font-lock-multiline t fontified t) 5931 6040 (font-lock-multiline t fontified t) 6040 6041 (font-lock-multiline t fontified t) 6041 6046 (font-lock-multiline t face font-lock-keyword-face fontified t) 6046 6047 (font-lock-multiline t fontified t) 6047 6054 (face font-lock-variable-name-face font-lock-multiline t fontified t) 6054 6061 (font-lock-multiline t fontified t) 6061 6066 (face font-lock-function-name-face font-lock-multiline t fontified t) 6066 6067 (font-lock-multiline t fontified t) 6067 6070 (font-lock-multiline t face font-lock-string-face fontified t) 6070 6075 (font-lock-multiline t fontified t) 6075 6092 (font-lock-multiline t fontified t) 6092 6095 (font-lock-multiline t face font-lock-comment-delimiter-face fontified t) 6095 6148 (font-lock-multiline t face font-lock-comment-face fontified t) 6148 6156 (font-lock-multiline t fontified t) 6156 6161 (font-lock-multiline t face font-lock-keyword-face fontified t) 6161 6165 (font-lock-multiline t fontified t) 6165 6171 (face font-lock-function-name-face font-lock-multiline t fontified t) 6171 6180 (font-lock-multiline t fontified t) 6180 6186 (face font-lock-function-name-face font-lock-multiline t fontified t) 6186 6290 (font-lock-multiline t fontified t) 6290 6294 (font-lock-multiline t face font-lock-keyword-face fontified t) 6294 6332 (font-lock-multiline t fontified t) 6332 6341 (font-lock-multiline t face font-lock-constant-face fontified t) 6341 6362 (font-lock-multiline t fontified t) 6362 6367 (font-lock-multiline t face font-lock-keyword-face fontified t) 6367 6368 (font-lock-multiline t fontified t) 6368 6375 (face font-lock-variable-name-face font-lock-multiline t fontified t) 6375 6378 (font-lock-multiline t fontified t) 6378 6383 (font-lock-multiline t face font-lock-keyword-face fontified t) 6383 6387 (font-lock-multiline t fontified t) 6387 6393 (face font-lock-function-name-face font-lock-multiline t fontified t) 6393 6396 (font-lock-multiline t fontified t) 6396 6400 (font-lock-multiline t face font-lock-function-name-face fontified t) 6400 6401 (font-lock-multiline t fontified t) 6401 6407 (face font-lock-variable-name-face font-lock-multiline t fontified t) 6407 6426 (font-lock-multiline t fontified t) 6426 6432 (font-lock-multiline t face font-lock-keyword-face fontified t) 6432 6456 (font-lock-multiline t fontified t) 6456 6460 (font-lock-multiline t face font-lock-constant-face fontified t) 6460 6567 (font-lock-multiline t fontified t) 6567 6572 (font-lock-multiline t face font-lock-keyword-face fontified t) 6572 6591 (font-lock-multiline t fontified t) 6591 6597 (font-lock-multiline t face font-lock-keyword-face fontified t) 6597 6621 (font-lock-multiline t fontified t) 6621 6626 (font-lock-multiline t face font-lock-constant-face fontified t) 6626 6647 (font-lock-multiline t fontified t) 6647 6678 (font-lock-multiline t face font-lock-string-face fontified t) 6678 6696 (font-lock-multiline t fontified t) 6696 6697 (fontified t)) . -1) (undo-tree-id0 . -5065) (undo-tree-id1 . -2830) (undo-tree-id2 . -763) (undo-tree-id3 . -6697) (undo-tree-id4 . -6296) (undo-tree-id5 . -763) (undo-tree-id6 . -4506) 6698 (t 26493 63643 895972 874000)) nil (26494 48739 486248 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 4340 . 4341) (nil fontified nil 1 . 4341) (1 . 4341)) nil (26494 48739 486231 0) 0 nil])
([nil nil ((4341 . 4342)) nil (26494 48739 486226 0) 0 nil])
([nil nil ((4223 . 4229) (t 26494 48739 495608 358000)) nil (26502 44950 262944 0) 0 nil])
([nil nil ((4229 . 4234)) nil (26502 44950 262943 0) 0 nil])
([nil nil ((#("w" 0 1 (font-lock-multiline t fontified t)) . -4233) (undo-tree-id6 . -1) 4234) nil (26502 44950 262942 0) 0 nil])
([nil nil ((4233 . 4234)) nil (26502 44950 262941 0) 0 nil])
([nil nil ((4234 . 4240)) nil (26502 44950 262940 0) 0 nil])
([nil nil ((4240 . 4245)) nil (26502 44950 262939 0) 0 nil])
([nil nil ((4245 . 4251)) nil (26502 44950 262939 0) 0 nil])
([nil nil ((4251 . 4258)) nil (26502 44950 262938 0) 0 nil])
([nil nil ((4251 . 4260) (#("product" 0 7 (font-lock-multiline t fontified t)) . -4251) (undo-tree-id5 . -7) 4258) nil (26502 44950 262938 0) 0 nil])
([nil nil ((4260 . 4269)) nil (26502 44950 262936 0) 0 nil])
([nil nil ((4269 . 4277)) nil (26502 44950 262935 0) 0 nil])
([nil nil ((#("i" 0 1 (font-lock-multiline t fontified t)) . -4275) (undo-tree-id3 . -1) (#("n" 0 1 (font-lock-multiline t face font-lock-keyword-face fontified t)) . -4276) (undo-tree-id4 . -1) 4277) nil (26502 44950 262934 0) 0 nil])
([nil nil ((4275 . 4278)) nil (26502 44950 262932 0) 0 nil])
([nil nil ((4275 . 4284) (#("und" 0 3 (font-lock-multiline t fontified t)) . -4275) (undo-tree-id0 . -3) (undo-tree-id1 . -3) (undo-tree-id2 . -3) 4278) nil (26502 44950 262928 0) 0 nil])
([nil nil ((3516 . 3521) (t 26502 44950 271180 325000)) nil (26502 44995 590462 0) 0 nil])
([nil nil ((3521 . 3532)) nil (26502 44995 590462 0) 0 nil])
([nil nil ((3532 . 3537)) nil (26502 44995 590461 0) 0 nil])
([nil nil ((3537 . 3546)) nil (26502 44995 590454 0) 0 nil])
([nil nil ((3435 . 3440) (t 26502 44995 595233 263000)) nil (26502 45056 689311 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 3502 . 3503) (nil fontified nil 3440 . 3503) (3440 . 3503)) nil (26502 45056 689310 0) 0 nil])
([nil nil ((#("    " 0 4 (font-lock-multiline t fontified t)) . -3440) (undo-tree-id7 . -4) (undo-tree-id8 . -4) (undo-tree-id9 . -4) (undo-tree-id10 . -4) (undo-tree-id11 . -4) (undo-tree-id12 . -4) (undo-tree-id13 . -4) 3444) nil (26502 45056 689305 0) 0 nil])
([nil nil ((#("i" 0 1 (font-lock-multiline t fontified t)) . -4483) (undo-tree-id14 . -1) (undo-tree-id15 . -1) (undo-tree-id16 . -1) (undo-tree-id17 . -1) (undo-tree-id18 . -1) (undo-tree-id19 . -1) (undo-tree-id20 . -1) (undo-tree-id21 . -1) (#("m" 0 1 (font-lock-multiline t fontified t)) . -4484) (undo-tree-id22 . -1) (undo-tree-id23 . -1) (undo-tree-id24 . -1) (undo-tree-id25 . -1) (undo-tree-id26 . -1) (undo-tree-id27 . -1) (undo-tree-id28 . -1) (undo-tree-id29 . -1) (#("a" 0 1 (font-lock-multiline t fontified t)) . -4485) (undo-tree-id30 . -1) (undo-tree-id31 . -1) (undo-tree-id32 . -1) (undo-tree-id33 . -1) (undo-tree-id34 . -1) (undo-tree-id35 . -1) (undo-tree-id36 . -1) (undo-tree-id37 . -1) (#("g" 0 1 (font-lock-multiline t fontified t)) . -4486) (undo-tree-id38 . -1) (undo-tree-id39 . -1) (undo-tree-id40 . -1) (undo-tree-id41 . -1) (undo-tree-id42 . -1) (undo-tree-id43 . -1) (undo-tree-id44 . -1) (undo-tree-id45 . -1) (#("e" 0 1 (font-lock-multiline t fontified t)) . -4487) (undo-tree-id46 . -1) (undo-tree-id47 . -1) (undo-tree-id48 . -1) (undo-tree-id49 . -1) (undo-tree-id50 . -1) (undo-tree-id51 . -1) (undo-tree-id52 . -1) (undo-tree-id53 . -1) (#("I" 0 1 (font-lock-multiline t fontified t)) . -4488) (undo-tree-id54 . -1) (undo-tree-id55 . -1) (undo-tree-id56 . -1) (undo-tree-id57 . -1) (undo-tree-id58 . -1) (undo-tree-id59 . -1) (undo-tree-id60 . -1) (undo-tree-id61 . -1) (#("d" 0 1 (font-lock-multiline t fontified t)) . -4489) (undo-tree-id62 . -1) (undo-tree-id63 . -1) (undo-tree-id64 . -1) (undo-tree-id65 . -1) (undo-tree-id66 . -1) (undo-tree-id67 . -1) (undo-tree-id68 . -1) 4490 (t 26502 45056 696895 20000)) nil (26502 45082 98669 0) 0 nil])
([nil nil ((4483 . 4485)) nil (26502 45082 98622 0) 0 nil])
([nil nil ((#("export const getSignedURL = async ({
    fileType,
    fileSize,
    checksum,
    name, type,
    productId
}: GetSignedURLParams): SignedURLResponse => {


    if (!allowedFileTypes.includes(fileType)) {
	return { failure: \"File type not allowed\" }
    }

    if (fileSize > maxFileSize) {
	return { failure: \"File size too large\" }
    }

    const fileName = generateFileName()

    const putObjectCommand = new PutObjectCommand({
	Bucket: process.env.AWS_BUCKET_NAME,
	Key: fileName,
	ContentType: fileType,
	ContentLength: fileSize,
	ChecksumSHA256: checksum,
    })

    const url = await getSignedUrl(
	s3Client,
	putObjectCommand,
	{ expiresIn: 60 } // 60 seconds
    )

    console.log({ success: url })

    await db
	.insert(images)
	.values({
	    url: url.split(\"?\")[0],
	    width: 0,
	    height: 0,
	    name,
	    type,
	    productId: productId || undefined
	})
    const results = await db.select().from(images)
    
    return { success: { url, id: results[0].id } }
}
" 0 6 (face font-lock-keyword-face fontified t) 6 7 (fontified t) 7 12 (face font-lock-keyword-face fontified t) 12 13 (fontified t) 13 25 (face font-lock-variable-name-face fontified t) 25 28 (fontified t) 28 33 (face font-lock-keyword-face fontified t) 33 34 (fontified t) 34 35 (font-lock-multiline t fontified t) 35 41 (font-lock-multiline t fontified t) 41 49 (face font-lock-variable-name-face font-lock-multiline t fontified t) 49 55 (font-lock-multiline t fontified t) 55 63 (face font-lock-variable-name-face font-lock-multiline t fontified t) 63 69 (font-lock-multiline t fontified t) 69 77 (face font-lock-variable-name-face font-lock-multiline t fontified t) 77 83 (font-lock-multiline t fontified t) 83 87 (face font-lock-variable-name-face font-lock-multiline t fontified t) 87 89 (font-lock-multiline t fontified t) 89 93 (font-lock-multiline t face font-lock-variable-name-face fontified t) 93 99 (font-lock-multiline t fontified t) 99 108 (face font-lock-variable-name-face font-lock-multiline t fontified t) 108 109 (font-lock-multiline t fontified t) 109 110 (font-lock-multiline t fontified t) 110 112 (font-lock-multiline t fontified t) 112 130 (font-lock-multiline t face font-lock-variable-name-face fontified t) 130 131 (font-lock-multiline t fontified t) 131 133 (fontified t) 133 150 (face font-lock-type-face fontified t) 150 151 (fontified t) 151 153 (face font-lock-keyword-face fontified t) 153 154 (fontified t) 154 156 (font-lock-multiline t fontified t) 156 162 (font-lock-multiline t fontified t) 162 164 (font-lock-multiline t face font-lock-keyword-face fontified t) 164 184 (font-lock-multiline t fontified t) 184 192 (face font-lock-function-name-face font-lock-multiline t fontified t) 192 207 (font-lock-multiline t fontified t) 207 213 (font-lock-multiline t face font-lock-keyword-face fontified t) 213 225 (font-lock-multiline t fontified t) 225 248 (font-lock-multiline t face font-lock-string-face fontified t) 248 262 (font-lock-multiline t fontified t) 262 264 (font-lock-multiline t face font-lock-keyword-face fontified t) 264 293 (font-lock-multiline t fontified t) 293 299 (font-lock-multiline t face font-lock-keyword-face fontified t) 299 311 (font-lock-multiline t fontified t) 311 332 (font-lock-multiline t face font-lock-string-face fontified t) 332 346 (font-lock-multiline t fontified t) 346 351 (font-lock-multiline t face font-lock-keyword-face fontified t) 351 352 (font-lock-multiline t fontified t) 352 360 (face font-lock-variable-name-face font-lock-multiline t fontified t) 360 363 (font-lock-multiline t fontified t) 363 379 (face font-lock-function-name-face font-lock-multiline t fontified t) 379 387 (font-lock-multiline t fontified t) 387 392 (font-lock-multiline t face font-lock-keyword-face fontified t) 392 393 (font-lock-multiline t fontified t) 393 409 (face font-lock-variable-name-face font-lock-multiline t fontified t) 409 412 (font-lock-multiline t fontified t) 412 415 (font-lock-multiline t face font-lock-keyword-face fontified t) 415 416 (font-lock-multiline t fontified t) 416 432 (face font-lock-type-face font-lock-multiline t fontified t) 432 473 (font-lock-multiline t fontified t) 473 578 (font-lock-multiline t fontified t) 578 583 (font-lock-multiline t face font-lock-keyword-face fontified t) 583 584 (font-lock-multiline t fontified t) 584 587 (face font-lock-variable-name-face font-lock-multiline t fontified t) 587 590 (font-lock-multiline t fontified t) 590 595 (font-lock-multiline t face font-lock-keyword-face fontified t) 595 596 (font-lock-multiline t fontified t) 596 608 (face font-lock-function-name-face font-lock-multiline t fontified t) 608 659 (font-lock-multiline t fontified t) 659 662 (font-lock-multiline t face font-lock-comment-delimiter-face fontified t) 662 673 (font-lock-multiline t face font-lock-comment-face fontified t) 673 684 (font-lock-multiline t fontified t) 684 691 (face font-lock-type-face font-lock-multiline t fontified t) 691 692 (font-lock-multiline t fontified t) 692 695 (face font-lock-function-name-face font-lock-multiline t fontified t) 695 719 (font-lock-multiline t fontified t) 719 724 (font-lock-multiline t face font-lock-keyword-face fontified t) 724 730 (font-lock-multiline t fontified t) 730 736 (face font-lock-function-name-face font-lock-multiline t fontified t) 736 747 (font-lock-multiline t fontified t) 747 753 (face font-lock-function-name-face font-lock-multiline t fontified t) 753 756 (font-lock-multiline t fontified t) 756 770 (font-lock-multiline t fontified t) 770 775 (face font-lock-function-name-face font-lock-multiline t fontified t) 775 776 (font-lock-multiline t fontified t) 776 779 (font-lock-multiline t face font-lock-string-face fontified t) 779 832 (font-lock-multiline t fontified t) 832 836 (font-lock-multiline t face font-lock-keyword-face fontified t) 836 843 (font-lock-multiline t fontified t) 843 867 (font-lock-multiline t fontified t) 867 876 (font-lock-multiline t face font-lock-constant-face fontified t) 876 885 (font-lock-multiline t fontified t) 885 890 (font-lock-multiline t face font-lock-keyword-face fontified t) 890 891 (font-lock-multiline t fontified t) 891 898 (face font-lock-variable-name-face font-lock-multiline t fontified t) 898 901 (font-lock-multiline t fontified t) 901 906 (font-lock-multiline t face font-lock-keyword-face fontified t) 906 910 (font-lock-multiline t fontified t) 910 916 (face font-lock-function-name-face font-lock-multiline t fontified t) 916 919 (font-lock-multiline t fontified t) 919 923 (font-lock-multiline t face font-lock-function-name-face fontified t) 923 924 (font-lock-multiline t fontified t) 924 930 (face font-lock-variable-name-face font-lock-multiline t fontified t) 930 941 (font-lock-multiline t fontified t) 941 947 (font-lock-multiline t face font-lock-keyword-face fontified t) 947 989 (font-lock-multiline t fontified t) 989 990 (fontified t)) . -3502) (undo-tree-id69 . -771) (undo-tree-id70 . -755) (undo-tree-id71 . -798) (undo-tree-id72 . -880) (undo-tree-id73 . -755) (undo-tree-id74 . -815) (undo-tree-id75 . -35) (undo-tree-id76 . -78) (undo-tree-id77 . -383) (undo-tree-id78 . -984) (undo-tree-id79 . -990) (undo-tree-id80 . -990) (undo-tree-id81 . -489) (undo-tree-id82 . -990) (undo-tree-id83 . -990) (undo-tree-id84 . -990) (undo-tree-id85 . -990) (undo-tree-id86 . -990) (undo-tree-id87 . -990) (undo-tree-id88 . -990) 4492 (t 26502 45082 106831 237000)) nil (26503 18349 957646 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 4508 . 4509) (nil fontified nil 3502 . 4509) (3502 . 4509)) nil (26503 18349 957621 0) 0 nil])
([nil nil ((#(" const image = await db.select().from(images).where(eq(images.url, url.split('?')[0])).first();" 0 1 (font-lock-multiline t fontified t) 1 6 (font-lock-multiline t face font-lock-keyword-face fontified t) 6 7 (font-lock-multiline t fontified t) 7 12 (face font-lock-variable-name-face font-lock-multiline t fontified t) 12 15 (font-lock-multiline t fontified t) 15 20 (font-lock-multiline t face font-lock-keyword-face fontified t) 20 24 (font-lock-multiline t fontified t) 24 30 (face font-lock-function-name-face font-lock-multiline t fontified t) 30 33 (font-lock-multiline t fontified t) 33 37 (font-lock-multiline t face font-lock-function-name-face fontified t) 37 38 (font-lock-multiline t fontified t) 38 44 (face font-lock-variable-name-face font-lock-multiline t fontified t) 44 46 (font-lock-multiline t fontified t) 46 51 (face font-lock-function-name-face font-lock-multiline t fontified t) 51 52 (font-lock-multiline t fontified t) 52 54 (face font-lock-function-name-face font-lock-multiline t fontified t) 54 62 (font-lock-multiline t fontified t) 62 65 (face font-lock-variable-name-face font-lock-multiline t fontified t) 65 71 (font-lock-multiline t fontified t) 71 76 (face font-lock-function-name-face font-lock-multiline t fontified t) 76 77 (font-lock-multiline t fontified t) 77 80 (font-lock-multiline t face font-lock-string-face fontified t) 80 87 (font-lock-multiline t fontified t) 87 92 (face font-lock-function-name-face font-lock-multiline t fontified t) 92 95 (font-lock-multiline t fontified t)) . 4364) (undo-tree-id125 . -95) (t 26503 18349 966506 453000)) nil (26503 18475 823345 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 4411 . 4412) (nil fontified nil 4366 . 4412) (4366 . 4412)) nil (26503 18475 823343 0) 0 nil])
([nil nil ((4419 . 4423) (#("    " 0 4 (font-lock-multiline t fontified nil)) . 4418) (undo-tree-id123 . -4) (4418 . 4423) (#("    " 0 4 (font-lock-multiline t fontified nil)) . 4417) (undo-tree-id124 . -4) (4419 . 4422) (4366 . 4370) (4412 . 4413)) nil (26503 18475 823342 0) 0 nil])
([nil nil ((#("
" 0 1 (font-lock-multiline t fontified t)) . -4361) (undo-tree-id89 . -1) (undo-tree-id90 . -1) (undo-tree-id91 . -1) (undo-tree-id92 . -1) (undo-tree-id93 . -1) (undo-tree-id94 . -1) (undo-tree-id95 . -1) (undo-tree-id96 . -1) (undo-tree-id97 . -1) (#("
" 0 1 (font-lock-multiline t fontified t)) . -4362) (undo-tree-id98 . -1) (undo-tree-id99 . -1) (undo-tree-id100 . -1) (undo-tree-id101 . -1) (undo-tree-id102 . -1) (undo-tree-id103 . -1) (undo-tree-id104 . -1) (undo-tree-id105 . -1) (undo-tree-id106 . -1) (#(" " 0 1 (font-lock-multiline t fontified t)) . -4363) (undo-tree-id107 . -1) (undo-tree-id108 . -1) (undo-tree-id109 . -1) (undo-tree-id110 . -1) (undo-tree-id111 . -1) (undo-tree-id112 . -1) (undo-tree-id113 . -1) (undo-tree-id114 . -1) (#("
" 0 1 (font-lock-multiline t fontified t)) . -4364) (undo-tree-id115 . -1) (undo-tree-id116 . -1) (undo-tree-id117 . -1) (undo-tree-id118 . -1) (undo-tree-id119 . -1) (undo-tree-id120 . -1) (undo-tree-id121 . -1) (undo-tree-id122 . -1) 4365) nil (26503 18475 823336 0) 0 nil])
([nil nil ((4361 . 4366)) nil (26503 18475 823302 0) 0 nil])
([nil nil ((#("i" 0 1 (font-lock-multiline t fontified t)) . -4453) (undo-tree-id129 . -1) (#("m" 0 1 (font-lock-multiline t fontified t)) . -4454) (undo-tree-id130 . -1) (#("a" 0 1 (font-lock-multiline t fontified t)) . -4455) (undo-tree-id131 . -1) (#("g" 0 1 (font-lock-multiline t fontified t)) . -4456) (undo-tree-id132 . -1) (#("e" 0 1 (font-lock-multiline t fontified t)) . -4457) (undo-tree-id133 . -1) 4458 (t 26503 18475 832811 367000)) nil (26503 18510 51329 0) 0 nil])
([nil nil ((4453 . 4458)) nil (26503 18510 51324 0) 0 nil])
([nil nil ((4453 . 4460) (#("resul" 0 5 (font-lock-multiline t fontified t)) . -4453) (undo-tree-id126 . -5) (undo-tree-id127 . -5) (undo-tree-id128 . -5) 4458) nil (26503 18510 51321 0) 0 nil])
([nil nil ((4461 . 4462) (4460 . 4462)) nil (26503 21142 158850 0) 0 nil])
([nil nil ((4215 . 4218) (t 26503 21144 822621 735000)) nil (26503 21424 951417 0) 0 nil] [nil nil ((#("  await db.insert(images).values({
    url: url.split('?')[0],
    width,
    height,
    name,
    type,
    productId: productId || null,
  });
    
    const results = await db.select().from(images)


    return { success: { url, id: results[0].id } };
};" 0 1 (fontified t) 1 2 (fontified t) 2 7 (face font-lock-keyword-face fontified t) 7 11 (fontified t) 11 17 (face font-lock-function-name-face fontified t) 17 26 (fontified t) 26 32 (face font-lock-function-name-face fontified t) 32 33 (fontified t) 33 48 (font-lock-multiline t fontified t) 48 53 (face font-lock-function-name-face font-lock-multiline t fontified t) 53 54 (font-lock-multiline t fontified t) 54 57 (font-lock-multiline t face font-lock-string-face fontified t) 57 100 (font-lock-multiline t fontified t) 100 104 (font-lock-multiline t face font-lock-keyword-face fontified t) 104 134 (font-lock-multiline t fontified t) 134 138 (font-lock-multiline t face font-lock-constant-face fontified t) 138 143 (font-lock-multiline t fontified t) 143 150 (fontified t) 150 155 (fontified t) 155 160 (face font-lock-keyword-face fontified t) 160 161 (fontified t) 161 168 (face font-lock-variable-name-face fontified t) 168 171 (fontified t) 171 176 (face font-lock-keyword-face fontified t) 176 180 (fontified t) 180 186 (face font-lock-function-name-face fontified t) 186 189 (fontified t) 189 193 (face font-lock-function-name-face fontified t) 193 194 (fontified t) 194 200 (face font-lock-variable-name-face fontified t) 200 201 (rear-nonsticky t fontified t) 201 202 (fontified t) 202 208 (fontified t) 208 214 (face font-lock-keyword-face fontified t) 214 217 (fontified t) 217 224 (fontified t) 224 233 (fontified t) 233 235 (fontified t) 235 237 (fontified t) 237 244 (fontified t) 244 247 (fontified t) 247 257 (fontified t) 257 258 (fontified t)) . 4216) (undo-tree-id145 . -258)) ((4216 . 4474)) (26503 21136 556161 0) 0 nil] [nil nil ((#(" await db.insert(images).values({
    url: url.split('?')[0],
    width,
    height,
    name,
    type,
    productId: productId || null,
  });
    
    const results = await db.select().from(images)


    return { success: { url, id: results[0].id } };
};" 0 1 (fontified t) 1 6 (face font-lock-keyword-face fontified t) 6 10 (fontified t) 10 16 (face font-lock-function-name-face fontified t) 16 25 (fontified t) 25 31 (face font-lock-function-name-face fontified t) 31 32 (fontified t) 32 47 (font-lock-multiline t fontified t) 47 52 (face font-lock-function-name-face font-lock-multiline t fontified t) 52 53 (font-lock-multiline t fontified t) 53 56 (font-lock-multiline t face font-lock-string-face fontified t) 56 99 (font-lock-multiline t fontified t) 99 103 (font-lock-multiline t face font-lock-keyword-face fontified t) 103 133 (font-lock-multiline t fontified t) 133 137 (font-lock-multiline t face font-lock-constant-face fontified t) 137 142 (font-lock-multiline t fontified t) 142 149 (fontified t) 149 154 (fontified t) 154 159 (face font-lock-keyword-face fontified t) 159 160 (fontified t) 160 167 (face font-lock-variable-name-face fontified t) 167 170 (fontified t) 170 175 (face font-lock-keyword-face fontified t) 175 179 (fontified t) 179 185 (face font-lock-function-name-face fontified t) 185 188 (fontified t) 188 192 (face font-lock-function-name-face fontified t) 192 193 (fontified t) 193 199 (face font-lock-variable-name-face fontified t) 199 200 (rear-nonsticky t fontified t) 200 201 (fontified t) 201 207 (fontified t) 207 213 (face font-lock-keyword-face fontified t) 213 216 (fontified t) 216 223 (fontified t) 223 232 (fontified t) 232 234 (fontified t) 234 236 (fontified t) 236 243 (fontified t) 243 246 (fontified t) 246 256 (fontified t) 256 257 (fontified t)) . 4217) (undo-tree-id152 . -257)) ((4217 . 4474)) (26503 21141 850404 0) 0 nil])
([nil nil ((4218 . 4229)) nil (26503 21424 951416 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 4601 . 4602) (nil fontified nil 4216 . 4602) (4216 . 4602)) ((#(" const [insertedImage] = await db
    .insert(images)
    .values({
      url: url.split('?')[0],
      width,
      height,
      name,
      type,
      productId: productId || null,
    })
    .returning();

  if (!insertedImage) {
    return { failure: 'Failed to save image details in the database' };
  }

  return { success: { url: insertedImage.url, id: insertedImage.id } };
};" 0 1 (fontified nil) 1 6 (face font-lock-keyword-face fontified nil) 6 7 (fontified nil) 7 8 (fontified nil) 8 21 (face font-lock-variable-name-face fontified nil) 21 22 (fontified nil) 22 25 (fontified nil) 25 30 (face font-lock-keyword-face fontified nil) 30 34 (fontified nil) 34 39 (fontified nil) 39 45 (face font-lock-function-name-face fontified nil) 45 59 (fontified nil) 59 65 (face font-lock-function-name-face fontified nil) 65 66 (fontified nil) 66 83 (font-lock-multiline t fontified nil) 83 88 (face font-lock-function-name-face font-lock-multiline t fontified nil) 88 89 (font-lock-multiline t fontified nil) 89 92 (font-lock-multiline t face font-lock-string-face fontified nil) 92 143 (font-lock-multiline t fontified nil) 143 147 (font-lock-multiline t face font-lock-keyword-face fontified nil) 147 179 (font-lock-multiline t fontified nil) 179 183 (font-lock-multiline t face font-lock-constant-face fontified nil) 183 190 (font-lock-multiline t fontified nil) 190 197 (fontified nil) 197 206 (face font-lock-function-name-face fontified nil) 206 213 (fontified nil) 213 215 (face font-lock-keyword-face fontified nil) 215 233 (fontified nil) 233 239 (font-lock-multiline t fontified nil) 239 245 (font-lock-multiline t face font-lock-keyword-face fontified nil) 245 257 (font-lock-multiline t fontified nil) 257 303 (font-lock-multiline t face font-lock-string-face fontified nil) 303 310 (font-lock-multiline t fontified nil) 310 314 (fontified nil) 314 320 (face font-lock-keyword-face fontified nil) 320 384 (fontified nil) 384 385 (fontified nil) 385 386 (fontified nil rear-nonsticky nil)) . 4216) (undo-tree-id146 . -22) (undo-tree-id147 . -22) (undo-tree-id148 . -8) (undo-tree-id149 . -386) (undo-tree-id150 . -8) (undo-tree-id151 . -22) (nil fontified t 4536 . 4600) (nil fontified t 4530 . 4536) (nil fontified t 4526 . 4530) (nil fontified t 4519 . 4526) (nil fontified t 4473 . 4519) (nil fontified t 4461 . 4473) (nil fontified t 4455 . 4461) (nil fontified t 4449 . 4455) (nil fontified t 4431 . 4449) (nil fontified t 4429 . 4431) (nil fontified t 4422 . 4429) (nil fontified t 4413 . 4422) (nil fontified t 4406 . 4413) (nil fontified t 4399 . 4406) (nil fontified t 4395 . 4399) (nil fontified t 4363 . 4395) (nil fontified t 4359 . 4363) (nil fontified t 4308 . 4359) (nil fontified t 4305 . 4308) (nil fontified t 4304 . 4305) (nil fontified t 4299 . 4304) (nil fontified t 4282 . 4299) (nil fontified t 4281 . 4282) (nil fontified t 4275 . 4281) (nil fontified t 4261 . 4275) (nil fontified t 4255 . 4261) (nil fontified t 4250 . 4255) (nil fontified t 4246 . 4250) (nil fontified t 4241 . 4246) (nil fontified t 4238 . 4241) (nil fontified t 4237 . 4238) (nil fontified t 4224 . 4237) (nil fontified t 4223 . 4224) (nil fontified t 4222 . 4223) (nil fontified t 4217 . 4222) (nil fontified t 4216 . 4217) (nil rear-nonsticky t 4601 . 4602)) (26503 21136 250598 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 4683 . 4684) (nil fontified nil 4217 . 4222) (nil fontified nil 4222 . 4223) (nil fontified nil 4223 . 4236) (nil fontified nil 4236 . 4239) (nil fontified nil 4239 . 4244) (nil fontified nil 4244 . 4253) (nil fontified nil 4253 . 4259) (nil fontified nil 4259 . 4273) (nil fontified nil 4273 . 4279) (nil fontified nil 4279 . 4280) (nil fontified nil 4280 . 4297) (nil fontified nil 4297 . 4302) (nil fontified nil 4302 . 4303) (nil fontified nil 4303 . 4306) (nil fontified nil 4306 . 4357) (nil fontified nil 4357 . 4361) (nil fontified nil 4361 . 4393) (nil fontified nil 4393 . 4397) (nil fontified nil 4397 . 4404) (nil fontified nil 4404 . 4411) (nil fontified nil 4411 . 4420) (nil fontified nil 4420 . 4427) (nil fontified nil 4427 . 4430) (nil fontified nil 4430 . 4472) (nil fontified nil 4472 . 4474) (nil fontified nil 4474 . 4476) (nil fontified nil 4476 . 4524) (nil fontified nil 4524 . 4530) (nil fontified nil 4530 . 4536) (nil fontified nil 4536 . 4548) (nil fontified nil 4548 . 4594) (nil fontified nil 4594 . 4601) (nil fontified nil 4601 . 4605) (nil fontified nil 4605 . 4610) (nil fontified nil 4610 . 4612) (nil fontified nil 4612 . 4617) (nil fontified nil 4617 . 4639) (nil fontified nil 4639 . 4645) (nil fontified nil 4645 . 4682) (4217 . 4684)) ((#("const insertedImage = await db
    .insert(images)
    .values({
      url: url.split('?')[0],
      width,
      height,
      name,
      type,
      productId: productId || null,
    })
    .returning();

  // Ensure the insertedImage is not undefined
  if (!insertedImage || insertedImage.length === 0) {
    return { failure: 'Failed to save image details in the database' };
  }

  const [image] = insertedImage;

  return { success: { url, id: image.id } };
};" 0 5 (face font-lock-keyword-face fontified nil) 5 6 (fontified nil) 6 19 (face font-lock-variable-name-face fontified nil) 19 22 (fontified nil) 22 27 (face font-lock-keyword-face fontified nil) 27 31 (fontified nil) 31 36 (fontified nil) 36 42 (face font-lock-function-name-face fontified nil) 42 51 (fontified nil) 51 56 (fontified nil) 56 62 (face font-lock-function-name-face fontified nil) 62 63 (fontified nil) 63 65 (font-lock-multiline t fontified nil) 65 80 (font-lock-multiline t fontified nil) 80 85 (face font-lock-function-name-face font-lock-multiline t fontified nil) 85 86 (font-lock-multiline t fontified nil) 86 89 (font-lock-multiline t face font-lock-string-face fontified nil) 89 140 (font-lock-multiline t fontified nil) 140 144 (font-lock-multiline t face font-lock-keyword-face fontified nil) 144 176 (font-lock-multiline t fontified nil) 176 180 (font-lock-multiline t face font-lock-constant-face fontified nil) 180 187 (font-lock-multiline t fontified nil) 187 189 (fontified nil) 189 194 (fontified nil) 194 203 (face font-lock-function-name-face fontified nil) 203 207 (fontified nil) 207 210 (fontified nil) 210 213 (face font-lock-comment-delimiter-face fontified nil) 213 255 (face font-lock-comment-face fontified nil) 255 257 (fontified nil) 257 259 (face font-lock-keyword-face fontified nil) 259 307 (fontified nil) 307 309 (font-lock-multiline t fontified nil) 309 313 (font-lock-multiline t fontified nil) 313 319 (font-lock-multiline t face font-lock-keyword-face fontified nil) 319 331 (font-lock-multiline t fontified nil) 331 377 (font-lock-multiline t face font-lock-string-face fontified nil) 377 384 (font-lock-multiline t fontified nil) 384 385 (fontified nil) 385 388 (fontified nil) 388 393 (face font-lock-keyword-face fontified nil) 393 395 (fontified nil) 395 400 (face font-lock-variable-name-face fontified nil) 400 419 (fontified nil) 419 422 (fontified nil) 422 428 (face font-lock-keyword-face fontified nil) 428 465 (fontified nil) 465 466 (fontified nil) 466 467 (rear-nonsticky nil fontified nil)) . 4217) (nil fontified t 4636 . 4639) (nil fontified t 4602 . 4605) (nil fontified t 4526 . 4530) (nil fontified t 4472 . 4474) (nil fontified t 4424 . 4427) (nil fontified t 4406 . 4411) (nil fontified t 4282 . 4297) (nil fontified t 4268 . 4273) (nil fontified t 4248 . 4253) (nil fontified t 4217 . 4222) (nil rear-nonsticky t 4683 . 4684) (t 26503 20698 30755 819000)) (26503 21140 130098 0) 0 nil])
([nil nil ((4229 . 4230)) nil (26503 21424 951415 0) 0 nil])
([nil nil ((#("]" 0 1 (fontified t)) . -4237) (undo-tree-id143 . -1) (undo-tree-id144 . -1) 4238) ((4237 . 4238)) (26503 21135 939999 0) 0 nil])
nil
([nil nil ((#("=" 0 1 (fontified t)) . -4229) (undo-tree-id226 . -1) 4230) nil (26503 21424 951414 0) 0 nil])
([nil nil ((#("[" 0 1 (fontified t)) . -4223) (undo-tree-id141 . -1) (undo-tree-id142 . -1) 4224) ((4223 . 4224)) (26503 21135 168161 0) 0 nil])
([nil nil ((4229 . 4230)) nil (26503 21424 951413 0) 0 nil])
nil
([nil nil ((#("
" 0 1 (fontified t)) . -4230) (undo-tree-id220 . -1) (undo-tree-id221 . -1) (undo-tree-id222 . -1) (undo-tree-id223 . -1) (#(" " 0 1 (fontified t)) . -4231) (undo-tree-id224 . -1) (#(" " 0 1 (fontified t)) . -4232) (undo-tree-id225 . -1) 4233) nil (26503 21424 951412 0) 0 nil])
([nil nil ((4230 . 4231)) nil (26503 21424 951407 0) 0 nil])
([nil nil ((4242 . 4245) (4215 . 4219) (4236 . 4237)) nil (26503 21424 951406 0) 0 nil])
([nil nil ((#("
" 0 1 (fontified t)) . -4240) (undo-tree-id215 . -1) (#(" " 0 1 (fontified t)) . -4241) (undo-tree-id216 . -1) (#(" " 0 1 (fontified t)) . -4242) (undo-tree-id217 . -1) (#(" " 0 1 (fontified t)) . -4243) (undo-tree-id218 . -1) (#(" " 0 1 (fontified t)) . -4244) (undo-tree-id219 . -1) 4245) nil (26503 21424 951405 0) 0 nil])
([nil nil ((4240 . 4241)) nil (26503 21424 951399 0) 0 nil])
([nil nil ((4243 . 4245)) nil (26503 21424 951398 0) 0 nil])
([nil nil ((#(";" 0 1 (fontified t)) . -4379) (undo-tree-id214 . -1) 4380) nil (26503 21424 951397 0) 0 nil])
([nil nil ((4379 . 4382)) nil (26503 21424 951396 0) 0 nil])
([nil nil ((4380 . 4389) (#("re" 0 2 (face font-lock-variable-name-face fontified t)) . -4380) (undo-tree-id211 . -2) (undo-tree-id212 . -2) (undo-tree-id213 . -2) 4382) nil (26503 21424 951395 0) 0 nil])
([nil nil ((4375 . 4376) (#("  " 0 2 (font-lock-multiline t fontified nil)) . 4375) (4389 . 4391)) nil (26503 21424 951392 0) 0 nil])
([nil nil ((#("    const results = await db.select().from(images)" 0 4 (fontified t) 4 9 (face font-lock-keyword-face fontified t) 9 10 (fontified t) 10 17 (face font-lock-variable-name-face fontified t) 17 20 (fontified t) 20 25 (face font-lock-keyword-face fontified t) 25 29 (fontified t) 29 35 (face font-lock-function-name-face fontified t) 35 38 (fontified t) 38 42 (face font-lock-function-name-face fontified t) 42 43 (fontified t) 43 49 (face font-lock-variable-name-face fontified t) 49 50 (fontified t rear-nonsticky t)) . 4396) (undo-tree-id208 . -50) (undo-tree-id209 . -50) (undo-tree-id210 . -50)) nil (26503 21424 951390 0) 0 nil])
([nil nil ((#("
" 0 1 (fontified t)) . -4390) (undo-tree-id153 . -1) (undo-tree-id154 . -1) (undo-tree-id155 . -1) (undo-tree-id156 . -1) (undo-tree-id157 . -1) (undo-tree-id158 . -1) (undo-tree-id159 . -1) (undo-tree-id160 . -1) (undo-tree-id161 . -1) (undo-tree-id162 . -1) (#(" " 0 1 (fontified t)) . -4391) (undo-tree-id163 . -1) (undo-tree-id164 . -1) (undo-tree-id165 . -1) (undo-tree-id166 . -1) (undo-tree-id167 . -1) (undo-tree-id168 . -1) (undo-tree-id169 . -1) (undo-tree-id170 . -1) (undo-tree-id171 . -1) (#(" " 0 1 (fontified t)) . -4392) (undo-tree-id172 . -1) (undo-tree-id173 . -1) (undo-tree-id174 . -1) (undo-tree-id175 . -1) (undo-tree-id176 . -1) (undo-tree-id177 . -1) (undo-tree-id178 . -1) (undo-tree-id179 . -1) (undo-tree-id180 . -1) (#(" " 0 1 (fontified t)) . -4393) (undo-tree-id181 . -1) (undo-tree-id182 . -1) (undo-tree-id183 . -1) (undo-tree-id184 . -1) (undo-tree-id185 . -1) (undo-tree-id186 . -1) (undo-tree-id187 . -1) (undo-tree-id188 . -1) (undo-tree-id189 . -1) (#(" " 0 1 (fontified t)) . -4394) (undo-tree-id190 . -1) (undo-tree-id191 . -1) (undo-tree-id192 . -1) (undo-tree-id193 . -1) (undo-tree-id194 . -1) (undo-tree-id195 . -1) (undo-tree-id196 . -1) (undo-tree-id197 . -1) (undo-tree-id198 . -1) (#("
" 0 1 (fontified t)) . -4395) (undo-tree-id199 . -1) (undo-tree-id200 . -1) (undo-tree-id201 . -1) (undo-tree-id202 . -1) (undo-tree-id203 . -1) (undo-tree-id204 . -1) (undo-tree-id205 . -1) (undo-tree-id206 . -1) (undo-tree-id207 . -1) 4396) nil (26503 21424 951382 0) 0 nil])
([nil nil ((4393 . 4397) (#("    " 0 4 (fontified nil)) . 4392) (4392 . 4396) (4392 . 4393) (t 26503 21424 961222 355000)) nil (26503 21513 117017 0) 0 nil])
([nil nil ((4392 . 4396)) nil (26503 21513 117015 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 4492 . 4493) (nil fontified nil 4396 . 4493) (4396 . 4493)) nil (26503 21513 117015 0) 0 nil])
([nil nil ((#("i" 0 1 (fontified t)) . -4401) (undo-tree-id227 . -1) (undo-tree-id228 . -1) (undo-tree-id229 . -1) (#("n" 0 1 (face font-lock-keyword-face fontified t)) . -4402) (undo-tree-id230 . -1) (undo-tree-id231 . -1) (undo-tree-id232 . -1) (#("s" 0 1 (fontified t)) . -4403) (undo-tree-id233 . -1) (undo-tree-id234 . -1) (undo-tree-id235 . -1) (#("e" 0 1 (fontified t)) . -4404) (undo-tree-id236 . -1) (undo-tree-id237 . -1) (undo-tree-id238 . -1) (#("r" 0 1 (fontified t)) . -4405) (undo-tree-id239 . -1) (undo-tree-id240 . -1) (undo-tree-id241 . -1) (#("t" 0 1 (fontified t)) . -4406) (undo-tree-id242 . -1) (undo-tree-id243 . -1) (undo-tree-id244 . -1) (#("e" 0 1 (fontified t)) . -4407) (undo-tree-id245 . -1) (undo-tree-id246 . -1) (undo-tree-id247 . -1) (#("d" 0 1 (fontified t)) . -4408) (undo-tree-id248 . -1) (undo-tree-id249 . -1) (undo-tree-id250 . -1) (#("I" 0 1 (fontified t)) . -4409) (undo-tree-id251 . -1) (undo-tree-id252 . -1) (undo-tree-id253 . -1) (#("m" 0 1 (fontified t)) . -4410) (undo-tree-id254 . -1) (undo-tree-id255 . -1) (undo-tree-id256 . -1) (#("a" 0 1 (fontified t)) . -4411) (undo-tree-id257 . -1) (undo-tree-id258 . -1) (undo-tree-id259 . -1) (#("g" 0 1 (fontified t)) . -4412) (undo-tree-id260 . -1) (undo-tree-id261 . -1) (undo-tree-id262 . -1) (#("e" 0 1 (fontified t)) . -4413) (undo-tree-id263 . -1) (undo-tree-id264 . -1) (undo-tree-id265 . -1) 4414) nil (26503 21513 117011 0) 0 nil])
([nil nil ((4401 . 4406)) nil (26503 21513 116976 0) 0 nil])
([nil nil ((4406 . 4408)) nil (26503 21513 116972 0) 0 nil])
([nil nil ((4217 . 4221) (4136 . 4138) (4214 . 4215) (t 26503 21513 126466 176000)) nil (26503 21799 697551 0) 0 nil])
([nil nil ((4525 . 4528)) nil (26503 21799 697550 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . -4525) (undo-tree-id266 . -1) (undo-tree-id267 . -1) (undo-tree-id268 . -1) (#("|" 0 1 (fontified t)) . -4526) (undo-tree-id269 . -1) (undo-tree-id270 . -1) (undo-tree-id271 . -1) (#("|" 0 1 (fontified t)) . -4527) (undo-tree-id272 . -1) 4528) nil (26503 21799 697548 0) 0 nil])
([nil nil ((4415 . 4419)) nil (26503 21799 697534 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 4438 . 4439) (nil fontified nil 4419 . 4439) (4419 . 4439)) nil (26503 21799 697530 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . -4418) (undo-tree-id288 . -1) (undo-tree-id289 . -1) (undo-tree-id290 . -1) (undo-tree-id291 . -1) (undo-tree-id292 . -1) (#("r" 0 1 (fontified t)) . -4419) (undo-tree-id293 . -1) (undo-tree-id294 . -1) (undo-tree-id295 . -1) (undo-tree-id296 . -1) (#("e" 0 1 (fontified t)) . -4420) (undo-tree-id297 . -1) (undo-tree-id298 . -1) (undo-tree-id299 . -1) (undo-tree-id300 . -1) (#("s" 0 1 (fontified t)) . -4421) (undo-tree-id301 . -1) (undo-tree-id302 . -1) (undo-tree-id303 . -1) (undo-tree-id304 . -1) (#("u" 0 1 (fontified t)) . -4422) (undo-tree-id305 . -1) (undo-tree-id306 . -1) (undo-tree-id307 . -1) (undo-tree-id308 . -1) (#("l" 0 1 (fontified t)) . -4423) (undo-tree-id309 . -1) (undo-tree-id310 . -1) (undo-tree-id311 . -1) (undo-tree-id312 . -1) (#("t" 0 1 (fontified t)) . -4424) (undo-tree-id313 . -1) (undo-tree-id314 . -1) (undo-tree-id315 . -1) (undo-tree-id316 . -1) (#("s" 0 1 (fontified t)) . -4425) (undo-tree-id317 . -1) (undo-tree-id318 . -1) (undo-tree-id319 . -1) (undo-tree-id320 . -1) (#("." 0 1 (fontified t)) . -4426) (undo-tree-id321 . -1) (undo-tree-id322 . -1) (undo-tree-id323 . -1) (undo-tree-id324 . -1) (#("l" 0 1 (fontified t)) . -4427) (undo-tree-id325 . -1) (undo-tree-id326 . -1) (undo-tree-id327 . -1) (undo-tree-id328 . -1) (#("e" 0 1 (fontified t)) . -4428) (undo-tree-id329 . -1) (undo-tree-id330 . -1) (undo-tree-id331 . -1) (undo-tree-id332 . -1) (#("n" 0 1 (fontified t)) . -4429) (undo-tree-id333 . -1) (undo-tree-id334 . -1) (undo-tree-id335 . -1) (undo-tree-id336 . -1) (#("g" 0 1 (fontified t)) . -4430) (undo-tree-id337 . -1) (undo-tree-id338 . -1) (undo-tree-id339 . -1) (undo-tree-id340 . -1) (#("t" 0 1 (fontified t)) . -4431) (undo-tree-id341 . -1) (undo-tree-id342 . -1) (undo-tree-id343 . -1) (undo-tree-id344 . -1) (#("h" 0 1 (fontified t)) . -4432) (undo-tree-id345 . -1) (undo-tree-id346 . -1) (undo-tree-id347 . -1) (undo-tree-id348 . -1) (#(" " 0 1 (fontified t)) . -4433) (undo-tree-id349 . -1) (undo-tree-id350 . -1) (undo-tree-id351 . -1) (undo-tree-id352 . -1) (#("=" 0 1 (fontified t)) . -4434) (undo-tree-id353 . -1) (undo-tree-id354 . -1) (undo-tree-id355 . -1) (undo-tree-id356 . -1) (#("=" 0 1 (fontified t)) . -4435) (undo-tree-id357 . -1) (undo-tree-id358 . -1) (undo-tree-id359 . -1) (undo-tree-id360 . -1) (#("=" 0 1 (fontified t)) . -4436) (undo-tree-id361 . -1) (undo-tree-id362 . -1) (undo-tree-id363 . -1) (undo-tree-id364 . -1) (#(" " 0 1 (fontified t)) . -4437) (undo-tree-id365 . -1) (undo-tree-id366 . -1) (undo-tree-id367 . -1) (undo-tree-id368 . -1) (#("0" 0 1 (rear-nonsticky t fontified t)) . -4438) (undo-tree-id369 . -1) (undo-tree-id370 . -1) (undo-tree-id371 . -1) 4439 (t 26503 21799 709798 951000)) nil (26503 55214 434356 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . -4415) (undo-tree-id273 . -1) (undo-tree-id274 . -1) (undo-tree-id275 . -1) (undo-tree-id276 . -1) (undo-tree-id277 . -1) (#("|" 0 1 (fontified t)) . -4416) (undo-tree-id278 . -1) (undo-tree-id279 . -1) (undo-tree-id280 . -1) (undo-tree-id281 . -1) (undo-tree-id282 . -1) (#("|" 0 1 (fontified t)) . -4417) (undo-tree-id283 . -1) (undo-tree-id284 . -1) (undo-tree-id285 . -1) (undo-tree-id286 . -1) (undo-tree-id287 . -1) 4418) nil (26503 55214 434287 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 1060 . 1061) (nil fontified nil 1059 . 1061) (nil fontified nil 1050 . 1059) (nil fontified nil 1028 . 1050) (nil fontified nil 1027 . 1028) (nil fontified nil 1022 . 1027) (nil fontified nil 1021 . 1022) (nil fontified nil 1018 . 1021) (nil fontified nil 1017 . 1018) (nil fontified nil 1012 . 1017) (nil fontified nil 995 . 1012) (nil fontified nil 969 . 995) (nil fontified nil 968 . 969) (nil fontified nil 963 . 968) (nil fontified nil 962 . 963) (nil fontified nil 955 . 962) (nil fontified nil 936 . 955) (nil fontified nil 931 . 936) (nil fontified nil 916 . 931) (nil fontified nil 910 . 916) (nil fontified nil 883 . 910) (nil fontified nil 879 . 883) (nil fontified nil 876 . 879) (nil fontified nil 870 . 876) (nil fontified nil 866 . 870) (nil fontified nil 861 . 866) (nil fontified nil 856 . 861) (nil fontified nil 849 . 856) (nil fontified nil 847 . 849) (nil fontified nil 840 . 847) (nil fontified nil 839 . 840) (nil fontified nil 834 . 839) (nil fontified nil 823 . 834) (nil fontified nil 820 . 823) (nil fontified nil 814 . 820) (nil fontified nil 813 . 814) (nil fontified nil 811 . 813) (nil fontified nil 807 . 811) (nil fontified nil 800 . 807) (nil fontified nil 799 . 800) (nil fontified nil 792 . 799) (nil fontified nil 787 . 792) (nil fontified nil 782 . 787) (nil fontified nil 781 . 782) (nil fontified nil 776 . 781) (nil fontified nil 773 . 776) (nil fontified nil 759 . 773) (nil fontified nil 758 . 759) (nil fontified nil 753 . 758) (nil fontified nil 752 . 753) (nil fontified nil 746 . 752) (746 . 1061) (t 26503 55214 443603 920000)) nil (26509 53384 330023 0) 0 nil])
([nil nil ((nil rear-nonsticky nil 575 . 576) (nil fontified nil 569 . 576) (nil fontified nil 568 . 569) (nil fontified nil 564 . 568) (nil fontified nil 553 . 564) (nil fontified nil 547 . 553) (547 . 576)) nil (26509 53384 330014 0) 0 nil])
([nil nil ((576 . 577)) nil (26509 53384 330009 0) 0 nil])
([nil nil ((484 . 489) (t 26509 53384 340451 606000)) nil (26509 53415 375732 0) 0 nil])
([nil nil ((486 . 493) (#("Pro" 0 3 (fontified t)) . -486) (undo-tree-id0 . -3) (undo-tree-id1 . -3) (undo-tree-id2 . -3) (undo-tree-id3 . -3) (undo-tree-id4 . -3) (undo-tree-id5 . -3) (undo-tree-id6 . -3) (undo-tree-id7 . -3) (undo-tree-id8 . -3) 489) nil (26509 53415 375727 0) 0 nil])
([nil nil ((784 . 785) (t 26509 53415 385308 102000)) nil (26513 9922 792791 0) 0 nil])
([nil nil ((#(" " 0 1 (fontified t)) . -784) (undo-tree-id10 . -1) (undo-tree-id11 . -1) 785) nil (26513 9922 792790 0) 0 nil])
([nil nil ((784 . 785)) nil (26513 9922 792787 0) 0 nil])
([nil nil ((#("" 0 1 (fontified t)) . -784) (undo-tree-id9 . -1) 785) nil (26513 9922 792783 0) 0 nil])
([nil nil ((478 . 479) (t 26513 9922 802293 845000)) nil (26538 19004 748981 0) 0 nil])
([nil current ((3246 . 3247) (t 26728 61925 87903 678000)) nil (26732 63748 839942 0) 0 nil])
nil
